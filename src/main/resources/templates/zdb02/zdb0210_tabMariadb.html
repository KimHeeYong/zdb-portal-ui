<div id="tabMariadb">
	<div class="Tabs">  
		<div>
			<div class="lay-item__box mt30">
				<div style="width:180px;" class="dtc" id="divMariaMenu">
					<ul class="dropmenu-list bbn">
<!-- 						<li data-menu="databaseStatus">서버상태</li> -->	  
					    <li class="selected"  data-menu="connection">클라이언트 커넥션</li>
						<li data-menu="userRole">사용자 및 권한관리</li>
						<li data-menu="database">Database</li>								
						<li data-menu="statusVariables">상태 변수</li>
						<li data-menu="systemVariables">시스템 변수</li>
						<li data-menu="myCnf">환경설정</li>
					</ul>
				</div>
				<div id="divMariaContent">
					<div style="padding-left:10px;padding-right:10px;">
<!-- 						<div data-menu="databaseStatus" class="hide">
							<h3 class="form-title2">Status Variables</h3>
							<table class="Table Form-type">
								<colgroup>
									<col width="200px"></col>
									<col width="*"></col>
								</colgroup>
								<tr>
									<th>Host:</th>
									<td data="hostname"></td>
								</tr>	
								<tr>
									<th>Socket:</th>
									<td data="socket"></td>
								</tr>	
								<tr>
									<th>Port:</th>
									<td data="port"></td>
								</tr>	
								<tr>
									<th>Version:</th>	
									<td data="version"></td>
								</tr>	
								<tr>
									<th>Compiled For:</th>
									<td data="compiled"></td>
								</tr>	
								<tr>
									<th>Running Since:</th>
									<td data="running"></td>
								</tr>	
							</table>
							<h3 class="form-title2">Server Directories</h3>
							<table class="Table Form-type">
								<colgroup>
									<col width="200px">
									<col width="*">
								</colgroup>
								<tr>
									<th>Base Directory:</th>
									<td data="basedir"></td>
								</tr>
								<tr>
									<th>Data Directory:</th>
									<td data="datadir"></td>
								</tr>
								<tr>
									<th>Plugin Directory:</th>
									<td data="plugin_dir"></td>
								</tr>
								<tr>
									<th>Tmp Directory:</th>
									<td data="tmpdir"></td>
								</tr>
								<tr>
									<th>Error Log:</th>
									<td data="log_error"></td>
								</tr>
								<tr>
									<th>General Log:</th>
									<td data="generalLog"></td>
								</tr>
								<tr>
									<th>Slow Query Log:</th>
									<td data="slowQueryLog"></td>
								</tr>
							</table>
						</div> -->
						<div data-menu="connection" class="accor-contents__wrap" >
							<h3 class="form-title2">클라이언트 커넥션
								<button class="Button btn fr" id="btnReloadConnection" style="margin-bottom: 3px;">새로고침</button>
							</h3>							
							<table class="Table Form-type" > 
								<colgroup>
									<col width="300px"></col>
									<col width="80px"></col>
									<col width="300px"></col>
									<col width="80px"></col>
									<col width="300px"></col>
									<col width="80px"></col>
								</colgroup>							
								<tr>
									<th>Threads Connected </th>
									<td data="Threads_connected"></td>
									<th>Threads running </th>
									<td data="Threads_running"></td>
									<th>Threads created </th>
									<td data="Threads_created"></td>
								</tr>
								<tr>
									<th>Threads cached </th>
									<td data="Threads_cached"></td>
									<th>Connection errors </th>
									<td data="Connection_errors_max_connections"></td>
									<th>Total Connections </th>
									<td data="Connections"></td>
								</tr>
								<tr>
									<th>Max connections </th>
									<td data="max_connections"></td>
									<th>Aborted clients </th>
									<td data="Aborted_clients"></td>
									<th>Aborted connects </th>
									<td data="Aborted_connects"></td>
								</tr>
							</table>
							<div id="gridConnection" class="mt30"></div>
						</div>
						<div data-menu="userRole" class="hide"  style=" min-width: 950px; ">
							<h3 class="form-title2">사용자 및 권한 관리
								<button class="Button btn fr" id="btnReloadUserRole" style="margin-bottom: 3px;">새로고침</button>
							</h3>
							<div class="mt20">
							<div class="fl" style="width:330px;">
								<div class="fr" style="margin-bottom: 3px;;margin-right:10px;">
									<button class="Button btn sm" th:if="${session.userInfo.clusterRole=='cluster-admin' || session.userInfo.zdbAdmin == true}" id="btnAddUser">추가</button>
									<button class="Button btn sm" th:if="${session.userInfo.clusterRole=='cluster-admin' || session.userInfo.zdbAdmin == true}" id="btnDeleteUser">삭제</button>
									<button class="Button btn sm" th:if="${session.userInfo.clusterRole=='cluster-admin' || session.userInfo.zdbAdmin == true}" id="btnDeletePrivileges">권한 회수</button>
								</div>
								<div id="gridUser" class="mt30"></div>
							</div>
							<div class="fl" style="width:300px;">
								<div id="gridUserSchema" class="mt30"></div>
							</div>
							<div style="width:280px;margin-top:25px;overflow: hidden">
								<form name="formUserRole">
								Object 권한변경
								<div class="item-wrap2" style="height:155px;">
									<ul>
										<li><input class="Checkbox" type="checkbox" name="select" value="Y">SELECT</li>
										<li><input class="Checkbox" type="checkbox" name="insert" value="Y">INSERT</li>
										<li><input class="Checkbox" type="checkbox" name="update" value="Y">UPDATE</li>
										<li><input class="Checkbox" type="checkbox" name="delete" value="Y">DELETE</li>
										<li><input class="Checkbox" type="checkbox" name="execute" value="Y">EXECUTE</li>
										<li><input class="Checkbox" type="checkbox" name="showView" value="Y">SHOW VIEW</li>
									</ul>
								</div>
								DDL 권한변경
								<div class="item-wrap2" style="height:250px;">
									<ul>
										<li><input class="Checkbox" type="checkbox" name="create" value="Y">CREATE</li>
										<li><input class="Checkbox" type="checkbox" name="alter" value="Y">ALTER</li>
										<li><input class="Checkbox" type="checkbox" name="references" value="Y">REFERENCES</li>
										<li><input class="Checkbox" type="checkbox" name="index" value="Y">INDEX</li>
										<li><input class="Checkbox" type="checkbox" name="createView" value="Y">CREATE VIEW</li>
										<li><input class="Checkbox" type="checkbox" name="createRoutine" value="Y">CREATE ROUTINE</li>
										<li><input class="Checkbox" type="checkbox" name="alterRoutine" value="Y">ALTER ROUTINE</li>
										<li><input class="Checkbox" type="checkbox" name="event" value="Y">EVENT</li>
										<li><input class="Checkbox" type="checkbox" name="drop" value="Y">DROP</li>
										<li><input class="Checkbox" type="checkbox" name="trigger" value="Y">TRIGGER</li>
									</ul>
								</div>
								Other 권한변경
								<div class="item-wrap2" style="height:90px">
									<ul>
 										<li><input class="Checkbox" type="checkbox" name="grantOption" value="Y">GRANT OPTION</li>
										<li><input class="Checkbox" type="checkbox" name="createTemporaryTables" value="Y">CREATE TEMPORARY TABLES</li>
										<li><input class="Checkbox" type="checkbox" name="lockTables" value="Y">LOCK TABLES</li>
									</ul>
								</div>
								</form>
								<div class="fr mt10" style="margin-bottom: 3px;margin-right:30px;">
									<button class="Button btn sm" th:if="${session.userInfo.clusterRole=='cluster-admin' || session.userInfo.zdbAdmin == true}"  id="btnSavePrivileges">적용</button>
								</div>																 	
							 </div>
							</div>
						</div>
						<div data-menu="statusVariables" class="hide">
							<h3 class="form-title2" >상태 변수
								<button class="Button btn fr" id="btnReloadStatusVariables" style="margin-bottom: 3px;">새로고침</button>
							</h3>
							<div class="search-wrap tr fi mt20">
								<input id="txtStatusVariablesFilter" name="txtStatusVariablesFilter" class="Textinput srcinput" placeholder="검색어를 입력하세요.">
							</div>
							<div id="gridStatusVariables"></div>
						</div>
						<div data-menu="systemVariables" class="hide">
							<h3 class="form-title2" >시스템 변수
								<button class="Button btn fr" id="btnReloadSystemVariables" style="margin-bottom: 3px;">새로고침</button>
							</h3>						
							<div class="search-wrap tr fi mt20" >
								<input id="txtSystemVariablesFilter" name="txtSystemVariablesFilter" class="Textinput srcinput" placeholder="검색어를 입력하세요.">
							</div>
							<div id="gridSystemVariables"></div>
						</div>
						<div data-menu="myCnf" class="hide">
							<h3 class="form-title2">환경설정
								<button class="Button btn fr" id="btnReloadMyCnf" style="margin-bottom: 3px;">새로고침</button>
							</h3>
							<div class="btn-wrap">
								<div class="btn-right">
									<div class="Divselect" id="selCategory" name="selCategory">
										<select>
											<option value="">전체</option>
										</select>
										<span></span>
									</div>
									<button class="Button btn bg-red" id="btnSaveMyCnf" style="margin-bottom: 3px;" th:if="${session.userInfo.clusterRole=='cluster-admin' || session.userInfo.zdbAdmin == true}" >저장</button>
								</div>
							</div>								
							<div id="gridMyCnf"></div>
						</div>
						<div data-menu="database" class="hide"  style=" min-width: 950px; ">
							<h3 class="form-title2">Database 목록
								<button class="Button btn fr" id="btnReloadDatabase" style="margin-bottom: 3px;">새로고침</button>
							</h3>
							<div class="mt20">
							<div class="fl" style="width:330px;">
								<div class="fr" style="margin-bottom: 3px;;margin-right:10px;">
									<button class="Button btn sm" th:if="${session.userInfo.clusterRole=='cluster-admin' || session.userInfo.zdbAdmin == true}" id="btnAddDatabase">추가</button>
									<button class="Button btn sm" th:if="${session.userInfo.clusterRole=='cluster-admin' || session.userInfo.zdbAdmin == true}" id="btnDeleteDatabase">삭제</button>
									<button class="Button btn sm" th:if="${session.userInfo.clusterRole=='cluster-admin' || session.userInfo.zdbAdmin == true}" id="btnSaveDatabase">저장</button>
								</div>
								<div id="gridDatabase" class="mt30"></div>
							</div>													
						</div>						
					</div>
				</div>
			</div>		
		</div>
	</div>
</div>
<script type="text/javascript">
/*
gService = {
	podName :"zdb-test-mat-mariadb-0"
}
*/

let validExcepArr = ["innodb_fast_shutdown","no-auto-rehash","quick"]; 
let sIdx = 0 ;
let scIdx = 0 ;
let newUserId = "" ; 
let userRoleList ;
let userPriMap ; 
let selCategory  = $('#selCategory');
let categorySort ={ mysqld:10, mysql:20, mysqld_safe:30, mysqldump:40,client:50 };
let selCategoryVal  = '';

let appMariadb = {
	selectedMenu:null,	
	data : {},	
	init : function(){
		this.tabMariadb = $('#tabMariadb');
		this.mariaMenu = this.tabMariadb.find('#divMariaMenu');
		this.mariaContent = this.tabMariadb.find('#divMariaContent');
		
		this.mariaMenu.find('li').on('click',function(e){
			let ob = $(e.currentTarget)
			ob.parent().find('li').removeClass('selected');
			ob.addClass('selected');
			let menuName = $(ob).data('menu');
			if(gService.status == 'red' && menuName !='myCnf'){
				gCommon.alert('서비스가 동작중이지 않아 사용할 수 없습니다.');
				return;
			}
			appMariadb.initMenu(menuName);
		})

		// 각 메뉴별 새로고침 버튼 추가 (2019-08-21)
		$('#btnReloadConnection').on('click',function(){
			appMariadb.getProcesses();
			appMariadb.getDatabaseConnection();
		})
		
		$('#btnReloadUserRole').on('click',function(){
			appMariadb.getUserRoleList();
		})
		
		$('#btnReloadStatusVariables').on('click',function(){
			appMariadb.getStatusVariables();
		})
		
		$('#btnReloadSystemVariables').on('click',function(){
			appMariadb.getSystemVariables();
		})
		
		$('#btnReloadMyCnf').on('click',function(){
			appMariadb.gridMyCnf.alopexGrid('dataEmpty');
			appMariadb.getMyCnfList();
		})
		appMariadb.getDatabaseVariables();
		if(gService.status != 'red'){
			appMariadb.selectedMenu = appMariadb.mariaContent.find('[data-menu]:eq(0)').data('menu'); 
		}else{
			appMariadb.selectedMenu = 'myCnf';
		}
		function fn_isSystemProcess(data){
			let exIds = ['system user','replicator']; 
			return exIds.indexOf(data.User) > -1; 
		}			
		this.gridConnection = $('#gridConnection').alopexGrid({
			rowOption : { 
				styleclass : function(data, rowOption){
					let re = '';
					let state = (data.State||'').toLowerCase();
					let time = (data.Time || 0);

				//	if(!fn_isSystemProcess(data)){  // 2019-08-06 클라이언트 커넥션 하이라이트 적용 (2019-08-06)
						if( state.indexOf('waiting for') > -1 || 
								   (state.indexOf('sending data') > -1 && time >= 10) ||
								   (state.indexOf('updating') > -1 && time >= 10) ||
								   (state == 'copying to tmp table on disk')){
							re = 'warning-color';
						}
				//	}
					
					return re;
				}
			},				
			message: { nodata: gMessage.gridNodata },
			autoColumnIndex : true,
			columnMapping : [
					{ key : 'Id', title : 'Id', width : '50px', align : 'center',tooltip:false},
					{ key : 'User', title : 'User', width : '80px', align : 'left',tooltip:false },
					{ key : 'Host', title : 'Host', width : '150px', align : 'center' ,tooltip:false},
					{ key : 'db', title : 'DB', width : '100px', align : 'center',tooltip:false },
					{ key : 'Command', title : 'Command', width : '100px', align : 'center',tooltip:false },
					{ key : 'Time', title : 'Time', width : '100px', align : 'center',tooltip:false},
					{ key : 'State', title : 'State', width : '250px', align : 'center',tooltip:true },  
					{ key : 'Info', title : 'Info', width : '100px', align : 'left' ,tooltip:true},
					{ key : '', title : '', width : '50px', align : 'center',tooltip:false,render:function(value,data){
						let disabled = '';
						if(fn_isSystemProcess(data) == true){
							disabled = 'Disabled';
						}

						if(data.User != "system user" &&  data.Host != "local" ){   //User: system user 등일 경우 종료버튼 지우기 & Host: local 일때 종료버튼 지우기 적용
							return $('<button class="Button sm '+disabled+'">종료</button>').on('click',function(){
								if($(this).hasClass('Disabled')){
									return;
								}
								gCommon.credentialConfirm({
							        data:{credential:$("#credential").val(),msg:'프로세스를 종료하시려면',okBtnMsg:'종료'},
							        callback : function(res){
										$a.ajax({
											url: '/zdbapi/killProcess',
											data:$.extend({},gParam,{pid:data.Id,podName:gService.podName}),
											success: function(res){
												if(res.result.code == '0'){
												//	appMariadb.getConnection();
													appMariadb.getProcesses();
													appMariadb.getDatabaseConnection();
												}
											}
										})
							        }
							    });
							});
						}else{
							return false;
						}
					}}
				],
			});
		
		/* 사용자 및 권한관리 시작 */
		this.formUserRole = appMariadb.mariaContent.find('form[name=formUserRole]');
		
		let tabUser = appMariadb.mariaContent.find('[data-menu=userRole]');
		let renderCheckbox = function(value){
			if(value == 'Y')return $('<img src="/styles/images/ico-checkmark.png" style="float:initial;width:20px"></img>');
		};
		let allowEditCheck = function(value,data){
			return data.state == 'A' || (data.user != 'admin');
		}
		let editTypeYn = {type:"checkbox",rule:[{value:"Y", checked:true},{value:"N", checked:false}]};
		let gridUser = this.gridUser = appMariadb.mariaContent.find('#gridUser').alopexGrid({
			autoColumnIndex: true,
			autoResize:true,
			rowInlineEdit:true,
			rowSelectOption:{
				clickSelect : true,
				singleSelect : true,
				endAllEditing : false,allowSingleUnselect: false
			},
			cellSelectable:false,
			//restoreFocusOnInvalidInlineEdit :true,
			leaveDeleted:true,
			width:320,
			height: 530,
			columnMapping : [  
				{ title:'state',key:'state',width:'50px',align:'center',editable:false,hidden:true,excludeFitWidth:true,render:function(value,data){
					if (data._state.added){data.state = 'A'}
					else if (data._state.deleted){data.state='D'}
					else if (data._state.edited){data.state='E'}
					else {data.state=''}
					return data.state;
				}},
				{ title:'USER', key : 'user' , width: '100px', align: 'left' ,editable:true	,allowEdit:function(value,data){
					return data._state.added == true;
				},editable: function(value, data) {
					return '<div><input type="text" class="alopexgrid-default-renderer" maxlength="15" value="'+value+'"/></div>'; 
				},editedValue: function(cell, data, render, mapping, grid) {
					return $(cell).find('input').val();
				}},
				{ title:'Password', key :'password' , width: '100px', align: 'left' ,editable:{type:'text'}
					,editable: function(value, data) {

						return '<div><input type="password" class="alopexgrid-default-renderer" value="'+ (value||'') +'" maxlength="15"/></div>'; 
					},editedValue: function(cell, data, render, mapping, grid) {
						return $(cell).find('input').val();
					},render:function(value,data){
						return (value||'').replace(/./g,'*');
					}
				},
				{ title:'접근 HOST', key : 'host' , width: '120px', align: 'left' ,editable:true,allowEdit:function(value,data){
					return data._state.added == true;
				}}
			], message: { nodata: gMessage.gridNodata }
		}).on('click','.bodycell',function(e){
			let evObj = AlopexGrid.parseEvent(e); //선택된 ROW 데이터 
			/* 선택된 사용자의 변경 사항 체크 로직 변경 (2019-09-25) */
			
			let schemaName = gridUserSchema.alopexGrid('dataGet', {_index:{row:scIdx}})[0].name; 
			let userName = evObj.data.user;
			let hostName = evObj.data.host;

			if(sIdx != evObj.data._index.row){
				let fData = gridUser.alopexGrid('dataGet', {_index:{row:sIdx}})[0]; 
				let msg = '변경 중인 내용은 취소 됩니다. 계속 하시겠습니까?' ;
				if(fData._state.edited || fData._state.added){
					gCommon.confirmYn(msg,function(yn){
						if(yn == "N"){
							// confirm 에서 반환한 값이 N 일때는 원래 ROW 를 그대로 선택만 해준다.			
							gridUser.alopexGrid('rowSelect', {_index:{row:sIdx}}, true);
						}else{
							// confirm 에서 반환한 값이 Y일때 원래 ROW 의 데이터 값을 원래대로 돌려놓고 권한 정보를 조회해온다. 
							if(fData._state.added){
								appMariadb.gridUser.alopexGrid('dataDelete',fData);
							}else if(fData._state.edited){
								appMariadb.gridUser.alopexGrid('updateOption', {defaultState: {}});
								appMariadb.gridUser.alopexGrid('dataRestore');									
							}
							sIdx = evObj.data._index.row;
							appMariadb.getUserPrivileges(userName,hostName,schemaName);
						}
					});
				}else{
					sIdx = evObj.data._index.row;
					appMariadb.getUserPrivileges(userName,hostName,schemaName); 
				}
			}
		}).on('focusout',function(e){
			let r = e.relatedTarget;
			if(!r|| !$(r).hasClass('alopexgrid-default-renderer')){
				gridUser.alopexGrid('endRowInlineEdit');
			}
		});
		let gridUserSchema = this.gridUserSchema = appMariadb.mariaContent.find('#gridUserSchema').alopexGrid({		
			autoColumnIndex: true,
			autoResize:true,
			rowInlineEdit:true,
			rowSelectOption:{
				clickSelect : true,
				singleSelect : true,allowSingleUnselect: false
			},
			width:280,
			height: 530,
			columnMapping : [  
				{ title:'state',key:'state',width:'50px',align:'center',editable:false,hidden:true,excludeFitWidth:true,render:function(value,data){
					if (data._state.added){data.state = 'A'}
					else if (data._state.deleted){data.state='D'}
					else if (data._state.edited){data.state='E'}
					else {data.state=''}
					return data.state;
				}},
				{ title:'Schema', key : 'name' , width: '200px', align: 'left' ,editable:true	,allowEdit:function(value,data){
					return data._state.added == true;
				},editable: function(value, data) {
					return '<div><input type="text" class="alopexgrid-default-renderer" maxlength="15" value="'+value+'"/></div>'; 
				},editedValue: function(cell, data, render, mapping, grid) {
					return $(cell).find('input').val();
				}}
			], message: { nodata: gMessage.gridNodata }				
		}).on('dataSelectEnd',function(e){
		
/* 			let eObj = appMariadb['data']['editPrivileges']  ;
			if(eObj != undefined){
				appMariadb.setUserPrivilegesUi();
			} */
		}).on('click','.bodycell',function(e){
			let evObj = AlopexGrid.parseEvent(e); //선택된 ROW 데이터 
			
			
			let schemaName =  evObj.data.name;
			let userName = gridUser.alopexGrid('dataGet', {_index:{row:sIdx}})[0].user; 
			let hostName = gridUser.alopexGrid('dataGet', {_index:{row:sIdx}})[0].host; 
			
			/* 선택된 스키마의 변경 사항 체크 로직 변경 (2019-09-25) */
			if(scIdx != evObj.data._index.row){
				let fData = gridUserSchema.alopexGrid('dataGet', {_index:{row:scIdx}})[0]; 
				let msg = '변경 중인 내용은 취소 됩니다. 계속 하시겠습니까?' ;
				let vEdited = false;

				// 1. 변경된 권한 정보가 있는지 체크 한다. 
				appMariadb.mariaContent.find('form[name=formUserRole] input:checkbox').each(function(){
					let ob = $(this);
					let obVal = ob.is(':checked')?'Y':'N';
					let obName = ob.attr('name');
					
					if(cloudUtil.isEmpty(userPriMap)){
						if(obVal == "Y"){
							vEdited = true ;
						}
					}else{
						for(let mapName in userPriMap){
							if(mapName == obName && obVal != userPriMap[mapName]){
								vEdited = true ;
							}
						}
					}
				});
				// 수정건이 있을 경우 처리 
				if(vEdited){
					gCommon.confirmYn(msg,function(yn){
						if(yn == "N"){
							gridUserSchema.alopexGrid('rowSelect', {_index:{row:scIdx}}, true);
						}else{
							scIdx = evObj.data._index.row;
							appMariadb.getUserPrivileges(userName,hostName,schemaName);
						}
					});
				}else{
					scIdx = evObj.data._index.row;
					appMariadb.getUserPrivileges(userName,hostName,schemaName);
				}
			}
		});
		/* 사용자및 권한 관리 - 사용자 추가 버튼  */
		tabUser.find('#btnAddUser').on('click', function(e){
			gridUser.alopexGrid('endRowInlineEdit');
			let dt = gridUser.alopexGrid('dataGet'); // gridUser 의 모든 data를 가지고 온다. 
			if(dt[0] && dt[0]._state.added == true){
				return;
			}

			let vEdited = false;
			let msg = '변경 중인 내용은 취소 됩니다. 계속 하시겠습니까?' ;

			for(let m in dt){
				let data = dt[m];
				if(data._state.edited == true)	vEdited = true; 
			}
				
			// 1. 변경된 권한 정보가 있는지 체크 한다. 
			appMariadb.mariaContent.find('form[name=formUserRole] input:checkbox').each(function(){

				let ob = $(this);
				let obVal = ob.is(':checked')?'Y':'N';
				let obName = ob.attr('name');
				
				for(let mapName in userPriMap){
					
					if(mapName == obName && obVal != userPriMap[mapName]){
						vEdited = true ;
					}
				}
			});
				
			if(vEdited == true){ // 수정 상태의 데이터가 있을 경우 처리 
				gCommon.confirm(msg,function(yn){
					
					appMariadb.gridUser.alopexGrid('updateOption', {defaultState: {}});
					appMariadb.gridUser.alopexGrid('dataRestore');
					
					sIdx = 0;
				
					let opt = {_index :{row:0,column:1,data:0,target:0}};
					let defUserDt = {};
					gridUser.alopexGrid('dataAdd', defUserDt, opt);
					gridUser.alopexGrid('startRowInlineEdit',opt);
					setTimeout(function(){
						gridUser.alopexGrid('rowSelect', opt, true)
						gridUser.find('.bodycell[data-alopexgrid-rowindex=0][data-alopexgrid-columnindex=1] input').focus();
						//appMariadb.setUserPrivilegesUi();
						appMariadb['data']['editPrivileges'].id = gridUser.alopexGrid('dataGet',{_index:{row:0}})[0]._index.id;
						appMariadb.mariaContent.find('form[name=formUserRole] input:checkbox').prop('checked',false);
					},100)
				});
			}else{
				let opt = {_index :{row:0,column:1,data:0,target:0}};
				let defUserDt = {};
				gridUser.alopexGrid('dataAdd', defUserDt, opt);
				gridUser.alopexGrid('startRowInlineEdit',opt);
				setTimeout(function(){
					gridUser.alopexGrid('rowSelect', opt, true)
					gridUser.find('.bodycell[data-alopexgrid-rowindex=0][data-alopexgrid-columnindex=1] input').focus();
					//appMariadb.setUserPrivilegesUi();
					appMariadb['data']['editPrivileges'].id = gridUser.alopexGrid('dataGet',{_index:{row:0}})[0]._index.id;
					appMariadb.mariaContent.find('form[name=formUserRole] input:checkbox').prop('checked',false);
				},100)
			}
				
			setTimeout(function(){   // gCommon.confirm 처리시 시간적인 차이가 필요 함 
				if(vEdited == true){
					gridUser.alopexGrid('rowSelect', {_index:{row:sIdx}}, true);
				}
			},100)
		});
		/* 사용자및 권한 관리 - 사용자 삭제 버튼  */
		tabUser.find('#btnDeleteUser').on('click',function(e){
			let dg = gridUser.alopexGrid( 'dataGet' , {_state:{selected:true}});
			if(dg.length == 0){
				gCommon.alert('선택된 행이 없습니다.');return;
			};
			let dt = dg[0];
			if(dt && dt._state.added == true){
				gridUser.alopexGrid('dataDelete',dg);
				appMariadb.resetEditPrivileges();
				gridUser.alopexGrid('rowSelect',{_index:{row:0}},true);
				return;
			}
			if(dt.user == 'admin' && dt.host == '%'){
				gCommon.alert('admin 계정은 삭제 할 수 없습니다.');return;
			}
			appMariadb.deleteDbUser();
		});

		tabUser.find('input:checkbox').on('click',function(e){ 		//  Privileges check click event 
			//appMariadb.updateUserPrivilegesData($(this).attr('name'),$(this).is(':checked')?'Y':'N');
		});
		tabUser.find('#btnSavePrivileges').on('click',function(){
			appMariadb.saveUserPrivileges();
		});
		tabUser.find('#btnDeletePrivileges').on('click',function(){
			appMariadb.deleteUserPrivileges();
		});
		
		/* 사용자 및 권한관리 끝 */
		
		/* database 시작  */
		let tabDatabase = appMariadb.mariaContent.find('[data-menu=database]');
		this.gridDatabase = appMariadb.mariaContent.find('#gridDatabase').alopexGrid({
		
			autoColumnIndex: true,
			autoResize:true,
			rowInlineEdit:true,
			rowSelectOption:{
				clickSelect : true,
				singleSelect : true
			},
			cellSelectable:true,
			restoreFocusOnInvalidInlineEdit :true,
			leaveDeleted:true,
			width:320,			
			height: 400,
			columnMapping : [  
				{ title:'state',key:'state',width:'0px',editable:false,hidden:false,render:function(value,data){
					if (data._state.added){data.state = 'A'}
					else if (data._state.deleted){data.state='D'}
					else if (data._state.edited){data.state='E'}
					else {data.state=''}
					return data.state;
				}},
				{ title:'NAME', key : 'name' , width: '320px', align: 'left' ,editable:true	,allowEdit:function(value,data){
					return data._state.added == true;
				},editable: function(value, data) {
					return '<div><input type="text" class="alopexgrid-default-renderer" maxlength="15" value="'+value+'"/></div>'; 
				},editedValue: function(cell) {
					return $(cell).find('input').val();
				},valid : function(value, data) {
					if(value=='') {
						return false;
					}
					return true;
				}}
			], message: { nodata: gMessage.gridNodata }
		}).on('cellEditInvalid ', function(e){
			setTimeout(function(evt){
				let evObj = AlopexGrid.parseEvent(e);
				let opt = evObj.data;
				let mapping = evObj.mapping;
				let col = mapping.columnIndex;
				let invalidValue = evObj.value;
				
				if(opt._state.deleted == true){
					return;
				}
 				if(col == 1){
 					gCommon.alert('DATABASE명을 입력하세요');
				} 
				appMariadb.gridDatabase.alopexGrid('focusCell', opt);
				setTimeout(function(){
					appMariadb.gridDatabase.alopexGrid('rowSelect', opt, true)
					appMariadb.gridDatabase.find('.bodycell[data-alopexgrid-rowindex='+(opt._index.row)+'][data-alopexgrid-columnindex='+(opt._index.column)+'] input').focus();
				},100)
			},100)
		}).on('dataChanged',function(e){
			let isEnalbed = AlopexGrid.trimData(appMariadb.gridDatabase.alopexGrid('dataGet',{state:'E'},{state:'A'},{state:'D'})).length > 0;
			tabDatabase.find('#btnSaveDatabase').setEnabled(isEnalbed);
		});
		tabDatabase.find('#btnAddDatabase').on('click', function(e){
			appMariadb.gridDatabase.alopexGrid('endRowInlineEdit');
			let dt = appMariadb.gridDatabase.alopexGrid('dataGet');
			
			if(dt[0]._state.added == true && dt[0]._state.editing != false){ return; } 
			let opt = {_index :{row:0,column:1,data:0,target:0}};
			appMariadb.gridDatabase.alopexGrid('dataAdd', {}, opt);
			appMariadb.gridDatabase.alopexGrid('startRowInlineEdit',opt);
			setTimeout(function(){
				appMariadb.gridDatabase.alopexGrid('rowSelect', opt, true)
				appMariadb.gridDatabase.find('.bodycell[data-alopexgrid-rowindex=0][data-alopexgrid-columnindex=1] input').focus();
			},100)
		});
		tabDatabase.find('#btnDeleteDatabase').on('click',function(e){
			appMariadb.gridDatabase.alopexGrid('endRowInlineEdit');
			let dg = appMariadb.gridDatabase.alopexGrid( 'dataGet' , {_state:{selected:true}});
			if(dg.length == 0){
				gCommon.alert('선택된 행이 없습니다.');return;
			};
			let dt = dg[0];
			if(false){
				gCommon.alert('삭제 할 수 없습니다.');return;
			}
			let d = dt._state.deleted ? 'dataUndelete' : 'dataDelete'; 
			appMariadb.gridDatabase.alopexGrid(d,{_state: {selected:true}}); 
		});
		tabDatabase.find('#btnReloadDatabase').on('click',function(e){
			appMariadb.getDatabase(); 
		});
		tabDatabase.find('#btnSaveDatabase').on('click',function(e){
			appMariadb.saveDatabase();
		});
		
		/* database 끝  */	
		
		this.gridStatusVariables = $('#gridStatusVariables').alopexGrid({
			height:450,
			message: { nodata: gMessage.gridNodata },
			autoColumnIndex : true,
			columnMapping : [
				{ key : 'name', title : '변수명', width : '500px', align : 'left',excludeFitWidth:true },
				{ key : 'value', title : '값', width : '200px', align : 'right',excludeFitWidth:true},
				{ key:''}
			]
		});			
		appMariadb.tabMariadb.find('[data-menu=statusVariables] input[name=txtStatusVariablesFilter]').on('input propertychange',function(){
			appMariadb.setStatusVariablesFilter();
		});
		
		this.gridSystemVariables = $('#gridSystemVariables').alopexGrid({
			height:450,
			message: { nodata: gMessage.gridNodata },
			autoColumnIndex : true,
			columnMapping : [
				{ key : 'name', title : '변수명', width : '500px', align : 'left',excludeFitWidth:true },
				{ key : 'value', title : '값', width : '200px', align : 'left',excludeFitWidth:true },
				{ key:''}
			]
		});				
		appMariadb.tabMariadb.find('[data-menu=systemVariables] input[name=txtSystemVariablesFilter]').on('input propertychange',function(){
			appMariadb.setSystemVariablesFilter();
		});	

		let renderValue = function(value,data){
			let re = '';
			if(!cloudUtil.isEmpty(data.enumValueList)){
				re = data.enumValueList;
			}else if(!cloudUtil.isEmpty(data.numericMinValue)){
				re = data.numericMinValue + ' ~ ' + data.numericMaxValue;
			}	
			return re;
		}
		
		let renderDefaultValue = function(value,data){
			let re = '';
			
			if(!cloudUtil.isEmpty(data.defaultValue)){
				re = 'Default Value : ' + data.defaultValue;
			}
			return re;
		}
		this.gridMyCnf = $('#gridMyCnf').alopexGrid({
			rowInlineEdit:true,
			rowSelectOption:{
				clickSelect : true,
				singleSelect : true
			},
			rowOption : { 
				styleclass : function(data, rowOption){
					if(data.categoryColumn==true){
						return 'header-row';
					}

					if(data._state.edited || data._state.added){
						return 'check-color';
					}
				}
			},			
			restoreFocusOnInvalidInlineEdit :true,
			cellSelectable:true,
			leaveDeleted:true,			
			readonlyRender:false,
			tree : {
				 useTree : true
				,idKey : 'name' //노드를 지시하는 유일한 값이 저장된 키값
				,parentIdKey : 'category' //자신의 상위(parent) 노드를 지시하는 ID가 저장된 키값
				,expandedKey : 'expandedCategory'
			},			
			height:450,
			message: { nodata: gMessage.gridNodata },
			autoColumnIndex : true,
			columnMapping : [
				{ key : 'status' , title : '', width:'50px',excludeFitWidth:true,hidden:true},
				{ key : 'proc', title : '', width : '70px', align : 'left',render: mycnfRender,excludeFitWidth:true },
				{ key : 'category', title : 'category', width : '200px', align : 'left',hidden:true,excludeFitWidth:true },
				{ key : 'name', title : '변수명', width : '300px', align : 'left',tooltip:renderDefaultValue ,treeColumn : false ,render:mycnfRender ,editable:mycnfEditable,excludeFitWidth:true},
				{ key : 'value', title : '값', width : '300px', align : 'left',render:mycnfRender,editable:mycnfEditable,editedValue: function(cell, data, render, mapping, grid) {
//					$(cell).find('select,input').css('color','black');
					
					let re = $(cell).find('select,input').val();
					return re;
				},valid : function(value, data) {
					
					let re = true;
					if(!appMariadb.validMyCnf(value,data)){
						re = false;
						value = data.value;
					}				
					data.valid = re;
					return re;
				},excludeFitWidth:true},
				{ key : '', title : '범위', width : '250px', align : 'left',render:renderValue,tooltip:renderValue},				
				//{ key : 'defaultValue', title : '기본값', width : '200px', align : 'left' },
				//{ key : 'variableComment', title : '설명', width : '300px', align : 'left' },
				{ key : 'sort',hidden:true}
			]
		}).on('cellEditInvalid ', function(e){
			setTimeout(function(evt){
				var evObj = AlopexGrid.parseEvent(e);
				var opt = evObj.data;
				var mapping = evObj.mapping;
				var col = mapping.columnIndex;
				var msg = '입력값을 확인하세요.';

				if(opt._state.deleted == true){
					return;
				}
				//alert('입력값을 확인하세요.');
				appMariadb.gridMyCnf.alopexGrid('focusCell', opt);
				
				setTimeout(function(){
					appMariadb.gridMyCnf.alopexGrid('rowSelect', opt, true)
					let input = appMariadb.gridMyCnf.find('.bodycell[data-alopexgrid-rowindex='+(opt._index.row)+'][data-alopexgrid-columnindex='+(opt._index.column)+'] input');
					input.val(msg);
					input.css('color','red');
					input.focus().trigger('click');
				},100)
			},100)
		});	
		
		$('#btnSaveMyCnf').on('click',function(){
			appMariadb.saveGridMyCnf();
		})
		//mycnf grid의 보여주는 컬럼 설정
		function mycnfRender(){
			let re = '';
			let value = arguments[0];
			let data = arguments[1];
			let column = arguments[3];
			let grid = arguments[4];
			let arg = arguments;
			let isAddVariableColumn = data.addVariableColumn == true;
			
			switch(column.key){
				case 'name':
					if(data.categoryColumn==true){
						re = '<span style="font-size:1.3em;color:black">['+value+']</span>';
					} else if(isAddVariableColumn){
						re = getAddVariableColumn(data);
					} else re = data.alias;
					
					break;
				case 'value':
					re = value;	
					break;
				case 'proc':
					if(isAddVariableColumn){
						re = $('<button class="Button btn sm">추가</button>').on('click',function(e){
							appMariadb.gridMyCnf.alopexGrid('endRowInlineEdit');
							appMariadb.gridMyCnf.alopexGrid('dataGet');
							let evt = AlopexGrid.parseEvent(e);
							let dt = AlopexGrid.trimData(evt.data);
							
							let data = evt.data;
							
							if(dt.valid == false)return;
							let newList = AlopexGrid.trimData(appMariadb.gridMyCnf.alopexGrid('dataGet',{dataColumn:true}));
							
							if(cloudUtil.isEmpty(dt.name)||cloudUtil.isEmpty(dt.value) || dt.name == gMessage.selectAddColumn){
								gCommon.alert(gMessage.selectAddColumn);return;
							}
					
							newList.push({
								category:dt.category, name:dt.name, value:dt.value, dataColumn:true
							});
							appMariadb.setGridMyCnf(newList);
							appMariadb.gridMyCnf.alopexGrid('focusCell',{category:dt.category,name:dt.name});
						});
					} else if(!cloudUtil.isEmpty(data.category)){
						re = $('<button class="Button btn sm">삭제</button>').on('click',function(e){
							appMariadb.gridMyCnf.alopexGrid('endRowInlineEdit');
							let evt = AlopexGrid.parseEvent(e);
							let dt = evt.data;
							if(dt.serverData==true){
								let d = dt._state.deleted ? 'dataUndelete' : 'dataDelete';
								/* 삭제처리 표시 유지 하는 로직 추가 -(2019-07-10)  */
 								dt.deleted = d ;
								appMariadb.gridMyCnf.alopexGrid(d,evt.data);
							}else{
								let gridList = AlopexGrid.trimData(appMariadb.gridMyCnf.alopexGrid('dataGet',{dataColumn:true}));
								let l = gridList.filter(function(o){
									return !(o.category == dt.category && o.name == dt.name)  
								});
								appMariadb.setGridMyCnf(l); 
							}
						});
					}
					break;
				default :	
					re = value;
					break;
			}
			return re;			
		}
		/* myCnf 그리드에서 variableType 이 SET 일경우 처리를 위한 function : popup 처리(예정) */
		function mycnfTypeSetPopup(enumValueList,value,name){


		}	
		
		//mycnf grid 수정 상태일때 보여주는 컬럼 설정
		function mycnfEditable(){
			let re = '';
			let value = arguments[0];
			let data = arguments[1];
			let column = arguments[3];
			let isAddVariableColumn = data.addVariableColumn == true;
			
			// port 일경우에 값이 변경 할 수 없도록 수정 & 그로인해 값이 사라지는 현상 수정 적용 (2019-07-19)
			if(data.name=='port' && column.key == 'value'  ){
				re = '<input type="text" class="Textinput" value="'+(value||'')+'" style="top:-5px;height:32px; width:80%" readonly="readonly">';
				return re;
			}
			
			switch(column.key){
				case 'name':
					if(data.categoryColumn==true)re = '<span style="font-size:1.3em;color:black">['+value+']</span>';
					else if(isAddVariableColumn){
						re = getAddVariableColumn(data);
					} else re = data.alias;
					break;
				case 'value':
					if(!data.dataColumn && !isAddVariableColumn)return;
					let dbv = appMariadb['data']['databaseVariables'];
					let d = dbv[data.category][data.name]||{};
					let setVal = "";
					// data.name 과 일치하는 데이터가 없을 경우 로직 추가 (2019.07.15)
					if(!d.name){
						d = dbv[data.category][String(data.name).replaceAll('_','-')]||{};
					}
					
					if(d.name == "innodb_undo_tablespaces")return;
					
					if(d && d.editable == true){
						let enumValueList = d.enumValueList|| ''; 
						//if(d.variableType == 'ENUM' || d.variableType == 'BOOLEAN'){
						if(d.variableType == 'ENUM' || d.variableType == 'BOOLEAN'){
							//select box 선언
							re = $('<div class="Divselect wd250" style="top:-5px;height:32px;"><select></select><span></div>');
							
							if(!d.enumValueList){
								re.find('select').append($('<option/>',{text:'OFF',value:'0'}));
								re.find('select').append($('<option/>',{text:'ON',value:'1'}));
							}else{
								let l = enumValueList.split(',');

								for(let i = 0; i < l.length;i++){
									re.find('select').append($('<option/>',{text:l[i],value:l[i]}));
								}
							}
							$a.convert(re);

 							if(isAddVariableColumn){
								let firstValue = re.find('select option:eq(0)').val();

								setTimeout(function(){
									re.setSelected(firstValue);
								},100);
							}else{
								re.setSelected(data.value);
							} 
						}else if(d.variableType == 'SET'||d.variableType == 'FLAGSET'){ 
							//variableType [SET] 추가 (2019-07-16) : 다건의 내용을 선택할 수 있어야 한다.
							//팝업을 이용하여 처리 (2019-07-18) 
 							re = $('<input type="text" class="Textinput" value="'+(data.value||'')+'" style="top:-5px;height:32px; width:80%" readonly="readonly" >').on('click',function(){
								let t = $(this);
 								
 								$a.popup({
 							        url: "/zdb02/zdb0200p09",
 							        data:$.extend({},gParam,{enumValueList:enumValueList ,value:t.val(),name:d.name}),
 							        iframe: false,
 							        width: 910,
 							        height: 300,
 							        title : '',
 							        callback : function(res){
 							        	if(res.result == 'Y'){
 							        		t.val(res.value);
 											appMariadb.gridMyCnf.alopexGrid('cellEdit', res.value, {_state :{selected:true}}, 'value');
 							        	}
 							        }
 							    });
							}); 
						}else{
							re = '<input type="text" class="Textinput" value="'+(data.value||'')+'" style="top:-5px;height:32px; width:80%">';
						}
					}else{
						re = '';
					}
				break;
			}

			return re;
		}
		//mycnf grid 추가 컬럼 설정
		function getAddVariableColumn(data){
		
			let dbv = appMariadb['data']['databaseVariables'];
			let comboList = dbv[data.category].comboList;
			let re = $('<div class="Divselect wd250" style="top:-5px;height:32px;"><select><option value="">'+gMessage.selectAddColumn+'</option></select><span></div>');
			for(let i = 0 ; i < comboList.length;i++){
				let o = comboList[i];
				re.find('select').append($('<option/>',{text:o.alias,value:o.name}));
			}
			$a.convert(re);
			re.setSelected(data.name).find('select').on('change',function(evt){

				let name = $(evt.currentTarget).val();
				let o = dbv[data.category][name];
				let d = $.extend({},o,{value:''});
				
				appMariadb.gridMyCnf.alopexGrid('dataEdit', d,data).alopexGrid('rowSelect', data, true).alopexGrid('startRowInlineEdit',data);
			});
			return re
		}
		
		for(let n in categorySort){
			selCategory.find('select').append($('<option>',{value:n,text:n}));
		}
		
		selCategory.on('change',function(e){
			selCategoryVal = e.target.value;
			appMariadb.getMyCnfList();
			//0806
		});
		
		/* 사용자 권한일 경우 gridMyCnf의 수정 옵션을 false로 변경한다.  */
		if(!gIsClusterAdmin && !gIsZdbAdmin ){
			$('#gridMyCnf').alopexGrid('updateOption',	{
				rowInlineEdit: false
			});
		}
		

		},initMenu : function(menuName){
			appMariadb.mariaContent.find('[data-menu]').hide().filter('[data-menu='+menuName+']').show();
			switch(menuName){
				case 'connection':
					appMariadb.getProcesses();
					appMariadb.getDatabaseConnection();
					break;
				case 'userRole':
					//appMariadb.getUserPrivileges();
					appMariadb.getUserRoleList();
					break;
				case 'database':
					appMariadb.getDatabase();
					break;							
				case 'statusVariables':
					appMariadb.getStatusVariables();
					break;
				case 'systemVariables':
					appMariadb.getSystemVariables();
					break;
				case 'myCnf':
					appMariadb.gridMyCnf.alopexGrid('dataEmpty');
					appMariadb.getMyCnfList();
					break;
/*  				case 'databaseStatus':
					appMariadb.getDatabaseStatus();
					break; 		 */			
			}
			appMariadb.mariaContent.find('[data-menu]:visible .alopexgrid').alopexGrid('viewUpdate')
		},getDatabaseStatus : function(){
			
			let d = $.extend({},gParam,{podName:gService.podName});
			$a.ajax({
				url:'/zdbapi/getDatabaseStatus',
				data:d,
				success:function(res){
					ds = res.databaseStatus;
					
					let onOffBtn = {
						ON : '<span class="state green vm"></span> ',
						OFF : '<span class="state inactive vm"></span> '
					}

					if(ds){  // && ds.compiled
						ds.compiled = ds.version_compile_os + '('+ds.version_compile_machine+')';
						ds.running = moment(ds.timestamp * 1000).format('ddd MMM D HH:mm:ss YYYY');
						BigNumber.config({ ROUNDING_MODE: BigNumber.ROUND_DOWN });
						let ut = new BigNumber(ds.Uptime);
						let utStr = '';
						let day = ut.div(86400).integerValue();
						if(day.isGreaterThan(0)){
							ut = ut.minus(day.times(86400)); 
						}
						let hour = ut.div(3600).integerValue();
						if(hour.isGreaterThan(0)){
							ut = ut.minus(hour.times(3600));
						}
						let minute = ut.div(60).integerValue();
						utStr += day.toNumber() + ' days ' + hour.toNumber()+ ' : ' +minute.toNumber();
						
						ds.running += ' ( ' + utStr + ' )' 
						ds.generalLog = onOffBtn[ds.general_log] + ds.general_log;
						ds.slowQueryLog = onOffBtn[ds.slow_query_log] + ds.slow_query_log + ' ' + ds.slow_query_log_file;
						
						appMariadb.tabMariadb.find('[data-menu=databaseStatus]').zdbui_setContents(ds);
					}
				}
			});
		}, getDatabaseConnection :function(){
			$a.ajax({
				url:'/zdbapi/getDatabaseConnection',
				data:$.extend({},gParam,{podName:gService.podName}),
				success:function(res){
					let d = res.databaseConnection;
					appMariadb.tabMariadb.find('[data-menu=connection]').zdbui_setContents(d);
				}
			});			
		}, getProcesses : function(){
			$a.ajax({
				url:'/zdbapi/getProcesses',
				data:$.extend({},gParam,{podName:gService.podName}),
				success:function(res){
					let list = res.processes;
					// 데이터 sort 추가 (2019-08-21)
					list.sort(function(a,b){
						return parseInt(a.Id) < parseInt(b.Id)?-1 : parseInt(a.Id) > parseInt(b.Id)?1 : 0 ;
					});
					
					appMariadb.gridConnection.alopexGrid('dataSet',list);
				}
			});
		}, getStatusVariables : function(){
			
			/* getStatusVariables */
			$('#txtStatusVariablesFilter').val(''); // 메뉴 클릭시 검색 창 초기화 
			
			$a.ajax({
				url:'/zdbapi/getDatabaseStatusVariables',
				data:$.extend({},gParam,{podName:gService.podName}),
				success:function(res){
					let d = res.databaseStatusVariables;

					let list = [];
					for(let k in d){
						list.push({name:k,value:d[k]});
					}
					appMariadb.gridStatusVariables.alopexGrid('dataSet',list);
					appMariadb.gridStatusVariables.alopexGrid('dataSort', [ {sortingColumn : 'name', sortingDirection: "asc"} ]);
				}
			});
		}, setStatusVariablesFilter:function(){

			
			let v = appMariadb.tabMariadb.find('[data-menu=statusVariables] input[name=txtStatusVariablesFilter]').val();
			if(cloudUtil.isEmpty(v)){
				appMariadb.gridStatusVariables.alopexGrid('clearFilter');
			}else{
				v = v.toLowerCase();
				appMariadb.gridStatusVariables.alopexGrid('setFilter','statusVariablesFilter',function(dt){
					return dt.name.toLowerCase().indexOf(v) > -1 || dt.value.toLowerCase().indexOf(v) > -1   
				});
			}
		}, getSystemVariables : function(){
			
			$('#txtSystemVariablesFilter').val(''); // 메뉴 클릭시 검색 창 초기화 
		
			$a.ajax({
				url:'/zdbapi/getDatabaseSystemVariables',
				data:$.extend({},gParam,{podName:gService.podName}),
				success:function(res){
					let d = res.databaseSystemVariables;
					let list = [];
					for(let k in d){
						list.push({name:k,value:d[k]});
					}
					appMariadb.gridSystemVariables.alopexGrid('dataSet',list);
					appMariadb.gridSystemVariables.alopexGrid('dataSort', [ {sortingColumn : 'name', sortingDirection: "asc"} ]);
				}
			});
		}, setSystemVariablesFilter:function(){
			let v = appMariadb.tabMariadb.find('[data-menu=systemVariables] input[name=txtSystemVariablesFilter]').val();
			if(cloudUtil.isEmpty(v)){
				appMariadb.gridSystemVariables.alopexGrid('clearFilter');
			}else{
				v = v.toLowerCase();
				appMariadb.gridSystemVariables.alopexGrid('setFilter','systemVariablesFilter',function(dt){
					return dt.name.toLowerCase().indexOf(v) > -1 || dt.value.toLowerCase().indexOf(v) > -1   
				});
			}			
		}, getDatabaseVariables:function(){ 
			appMariadb.data.databaseVariables = {};//mycnf 환경 변수
			$a.ajax({
				url:'/zdbapi/getDatabaseVariables',
				data:gParam,
				success:function(res){
					let dt = {};
					let list = res.databaseVariables||[];
					for(let i = 0; i < list.length;i++){
						let o = list[i];
						if(!dt[o.category]){
							dt[o.category]= {};
						}
						dt[o.category][o.name] = o;
					}
					appMariadb['data']['databaseVariables'] = dt;
				}
			});			
		},getDatabases:function(){
			var deferred = $.Deferred();
			$a.ajax({
				url: '/zdbapi/getDatabases',
				method:'get',
				data: gParam,
				complete:function(res){
					deferred.resolve(res.responseJSON);
				}
			});
			return deferred.promise();
		}
		, getUserRoleList:function(pUser , pSchema){
			var deferred = $.Deferred();
			appMariadb.getDatabases().done(function(resDatabases){
				$a.ajax({
					url: '/zdbapi/getUserGrants',
					method:'get',
					data: gParam,
					success: function(res){

						let bl = ['information_schema','mysql','performance_schema']; //나타내지 않을 DB 목록 
						let databases = resDatabases.databases||[];
						let list = res.userGrants;
						userRoleList = list; //origin data setting
						let dl = [{name:'*'}].concat(databases)//.push({name:'mmmmmm'});
						
						// 나타내지 않을 DB 목록  Filtering 
						dl = dl.filter(function(ob){
							return bl.indexOf(ob.name)==-1
						});
						
						appMariadb.gridUserSchema.alopexGrid('dataSet',dl);// schema list setting
						appMariadb.gridUser.alopexGrid('dataSet',list);// user list setting 
						
						deferred.resolve(list,dl);

						if(newUserId != ""){
							
							appMariadb.gridUser.alopexGrid('rowSelect',{user:newUserId},true); //최초 선택 처리 - griduser
							newUserId = "";
						}else{
							
							if(cloudUtil.isEmpty(pUser)){
								appMariadb.gridUser.alopexGrid('rowSelect',{_index:{row:0}},true); //최초 선택 처리 - griduser	
							}else{
								appMariadb.gridUser.alopexGrid('rowSelect',{user:pUser},true); //선택 처리 - griduser
							}
						}
						if(cloudUtil.isEmpty(pSchema)){
							appMariadb.gridUserSchema.alopexGrid('rowSelect',{_index:{row:0}},true);//최초 선택 처리 - griduserSchema							
						}else{ 
							appMariadb.gridUserSchema.alopexGrid('rowSelect',{name:pSchema},true);//선택 처리 - griduserSchema					
						}
						
						
						//수정 처리를 위한 공간 생성 - 추후 삭제 예정 
						appMariadb['data']['userPrivileges'] = {};
						appMariadb['data']['editPrivileges'] = {};//변경중인 데이터 저장
					
						//host 정보는 선택된 user 그리드 정보에서 추출 하여 조회한다. 
						let pHost = appMariadb.gridUser.alopexGrid('dataGet',{_state :{selected:true}})[0].host;
						
						appMariadb.getUserPrivileges(pUser , pHost ,pSchema); // User Privileges 조회 실행
					}
				});				
			})
			return deferred.promise();
		} ,getMyCnfList : function(){
			//서버에 설정된 mycnf 내용 조회
			$a.ajax({
				url:'/zdbapi/getUseDatabaseVariables',
				data:gParam,
				success:function(res){
					let myCnfList = res.databaseVariables||[];
					//0806
					if(selCategoryVal !=''){
						myCnfList = myCnfList.filter(function(o){
							return (o.category == selCategoryVal)  
						});	
					}
					
					let l = myCnfList.map(function(ob){
						return $.extend({},ob,{serverData:true});
					});
				
					appMariadb.setGridMyCnf(l);					
				}
			})
		}, 
		getUserPrivileges: function(pUser ,pHost , pSchema){
		
			/* UserRoleList 조회 성공시 셋팅 -> 함수 호출시 조회로 변경   */
			let d = (appMariadb.gridUser.alopexGrid('dataGet',{_state :{selected:true}})[0]||{});
			let user = d.user||'';
			let host = d.host||'';
			let schema = (appMariadb.gridUserSchema.alopexGrid('dataGet',{_state :{selected:true}})[0]||{}).name;		
		
			if(!cloudUtil.isEmpty(pUser))user = pUser ;
			if(!cloudUtil.isEmpty(pHost))host = pHost ;
			if(!cloudUtil.isEmpty(pSchema))schema = pSchema;
			
			$a.ajax({
				url:'/zdbapi/getUserPrivileges',
		        data:$.extend({},gParam,{user:user ,host:host,schema:schema}),
				success:function(res){
					if(res){
						let list = res.userPrivilegesForSchema||[];
						let privilegesMap = list[0] ;	
						userPriMap = privilegesMap;  
						
						if(list.length > 0){						
							appMariadb.mariaContent.find('form[name=formUserRole] input:checkbox').prop('checked',false);
							appMariadb.mariaContent.find('form[name=formUserRole]').zdbui_setContents(privilegesMap);
						}else{
							appMariadb.mariaContent.find('form[name=formUserRole] input:checkbox').prop('checked',false);
						}
					}	
				}
			})	 		
		},
		getSelectUserSchema: function(){
			let re = null;
			let d = (appMariadb.gridUser.alopexGrid('dataGet',{_state :{selected:true}})[0]||{});
			let user = d.user||'';
			let host = d.host||'';
			let schema = (appMariadb.gridUserSchema.alopexGrid('dataGet',{_state :{selected:true}})[0]||{}).name;
			re = {
				id: d._index.id,
				user : user,
				host : host,
				schema : schema,
				password: d.password,
				grantee : ('\''+user+'\'@\''+host+'\''),
				state: (d._state.added == true ? 'I':'U')					
			}
			return re;
		},
		updateUserPrivilegesData(name,isValue){
			
			/* 			let su = appMariadb.getSelectUserSchema();
			if(su ==null)return;
			
			let g = appMariadb['data']['userPrivileges'];
			if(!g[su.id]){
				g[su.id] = {};
			};
			let s = g[su.id];
			if(!s[su.schema]){
				s[su.schema] = {};
			}
			let o = s[su.schema];
			o.isUpdate = true;
			o[name] = isValue;

			appMariadb['data']['editPrivileges'].id = su.id; */
		},
		setUserPrivilegesUi:function(){

		
		/* 			
 
		//	 let su = appMariadb.getSelectUserSchema();
		//	appMariadb.mariaContent.find('form[name=formUserRole] input:checkbox').prop('checked',false);
		//	if(su!=null){
		//		let up = ((appMariadb['data']['userPrivileges'][su.id]||{})[su.schema]||{});
		//		appMariadb.mariaContent.find('form[name=formUserRole]').zdbui_setContents(up);
		//	}
			*/
		},
		resetEditPrivileges:function(){
			appMariadb['data']['editPrivileges'] = {};
			
			if(JSON.stringify(appMariadb['data']['userPrivileges']) != "{}" && !cloudUtil.isEmpty(appMariadb['data']['userPrivileges'])){
				appMariadb['data']['userPrivileges'] = JSON.parse(JSON.stringify(appMariadb['data']['userPrivilegesOrg']));//원본 데이터 저장
			}
		},
		saveUserPrivileges:function(){
			// grid user data 
			let d = (appMariadb.gridUser.alopexGrid('dataGet',{_state :{selected:true}})[0]||{});
 			let dg = appMariadb.gridUser.alopexGrid( 'dataGet' , {_state:{selected:true}});
			if(dg.length == 0){
				gCommon.alert('선택된 사용자가 없습니다.');return;
			}; 			
			
			let user = d.user||'';
			let host = d.host||'';
			let password = d.password||'';
			let state = d._state.added == true ? 'I':'U' ;	
			
 			let dsc = appMariadb.gridUserSchema.alopexGrid( 'dataGet' , {_state:{selected:true}});
			if(dsc.length == 0){
				gCommon.alert('선택된 스키마가 없습니다.');return;
			}; 	
			
			let schema = (appMariadb.gridUserSchema.alopexGrid('dataGet',{_state :{selected:true}})[0]||{}).name;
			let grantee = ('\''+user+'\'@\''+host+'\'');
			
			// 1. 변경된 권한 정보가 있는지 체크 한다. 
			let editChk = false;				
			let o = {};
			
			if(state == 'I' ){
				newUserId = user;
				editChk = true ;
			}else{
				newUserId = '';	
			}
			
			appMariadb.gridUser.alopexGrid('endRowInlineEdit');
			
			// 1. 변경된 권한 정보가 있는지 체크 한다. 
			appMariadb.mariaContent.find('form[name=formUserRole] input:checkbox').each(function(){
				let ob = $(this);
				let obVal = ob.is(':checked')?'Y':'N';
				let obName = ob.attr('name');
				
				o[obName] = obVal ;
				
				if(cloudUtil.isEmpty(userPriMap)){
					if(obVal == "Y"){
						editChk = true ;
					}
				}else{
					for(let mapName in userPriMap){
						if(mapName == obName && obVal != userPriMap[mapName]){
							editChk = true ;
						}
					}
				}
			});

			if(editChk){
				if(cloudUtil.isEmpty(user)){
					gCommon.alert('USER를 입력하세요.');
					appMariadb.gridUser.alopexGrid('startRowInlineEdit')
					appMariadb.gridUser.find('.bodycell[data-alopexgrid-rowindex=0][data-alopexgrid-columnindex=1] input').focus().trigger('click');;
					return;
				}

				if(state == 'I' && cloudUtil.isEmpty(password)){
					gCommon.alert('PASSWORD를 입력하세요.');
					appMariadb.gridUser.alopexGrid('startRowInlineEdit')
					appMariadb.gridUser.find('.bodycell[data-alopexgrid-rowindex=0][data-alopexgrid-columnindex=2] input').focus().trigger('click');;
					return;
				}
				
				if(cloudUtil.isEmpty(host)){
					gCommon.alert('HOST를 입력하세요.');
					appMariadb.gridUser.alopexGrid('startRowInlineEdit')
					appMariadb.gridUser.find('.bodycell[data-alopexgrid-rowindex=0][data-alopexgrid-columnindex=3] input').focus().trigger('click');;
					return;
				}			
			}else{
				if(cloudUtil.isEmpty(password)){ // 2-1 선택된 user의 패스워드가 있는지 여부를 체크 한다.   
					gCommon.alert('저장 할 데이터가 없습니다.');
					return;
				} 
			}

			gCommon.confirm('저장 하시 겠습니까?',function(){
				let param = $.extend({},gParam,{
					userPrivileges : {
						grantee:grantee,
						password:password
					},
					state:state
				});
				
				let l = [];
				o.schema = schema;
				l.push(o);		

				param.userPrivileges.privileges = l;
				param.userPrivileges = JSON.stringify(param.userPrivileges);
				
				$a.ajax({
					url:'/zdbapi/saveUserPrivileges',
					method:'put',
					data:param,
					success:function(res){
						appMariadb.gridUser.alopexGrid('cellEdit', "", {_index: {row: true}}, 'password');
						appMariadb.gridUser.alopexGrid('updateOption', {defaultState: {}});
						appMariadb.gridUser.alopexGrid('dataRestore');	
						
						appMariadb.getUserRoleList(user,schema);
					}
				});			
			});
		},
		deleteUserPrivileges:function(){
			appMariadb.gridUser.alopexGrid('endRowInlineEdit');
			//let su = appMariadb.getSelectUserSchema();
			
			let d = (appMariadb.gridUser.alopexGrid('dataGet',{_state :{selected:true}})[0]||{});
			let user = d.user||'';
			let host = d.host||'';
			let password = d.password||'';
			let state = d._state.added == true ? 'I':'U' ;	
	
			let schema = (appMariadb.gridUserSchema.alopexGrid('dataGet',{_state :{selected:true}})[0]||{}).name;
			let grantee = ('\''+user+'\'@\''+host+'\'');
			
			gCommon.confirm('선택된 사용자의 권한을 삭제 하시 겠습니까?',function(){
				let param = $.extend({},gParam,{
					userPrivileges : {
						grantee:grantee
					},
					state:'D'
				});
				let l = [];
				let dt = appMariadb.gridUserSchema.alopexGrid('dataGet');
				
				for(let i = 0 ; i < dt.length;i++){
					let o = {schema:dt[i].name};
					l.push(o);
				}
				param.userPrivileges.privileges = l;
				param.userPrivileges = JSON.stringify(param.userPrivileges);
				$a.ajax({
					url:'/zdbapi/saveUserPrivileges',
					method:'put',
					data:param,
					success:function(res){
					//	appMariadb.getUserRoleList();	
						appMariadb.getUserPrivileges(user,host,schema);
					}
				});			
			});			
		},
		deleteDbUser:function(){
			appMariadb.gridUser.alopexGrid('endRowInlineEdit');

			let d = (appMariadb.gridUser.alopexGrid('dataGet',{_state :{selected:true}})[0]||{});
			let user = d.user||'';
			let host = d.host||'';
		
			gCommon.confirm('선택된 사용자를 삭제 하시 겠습니까?',function(){
				let param = $.extend({},gParam,{
					state:'D',
					user : user,
					host : host,
					accountId : user
				});
				$a.ajax({
					url:'/zdbapi/saveDBUser',
					method:'put',
					data:{data:JSON.stringify([param])},
					success:function(res){
						//appMariadb.getUserPrivileges();
						appMariadb.getUserRoleList();		
					}
				});			
			});			
		},
		/*
			mycnfgrid 에 데이터 설정  : serverData(true,false)컬럼으로 실제 데이터 판별 ,dataColumn(true,false)으로 데이터 여부 판별
			category 데이터,실데이터,추가콤보 리스트 순으로 생성( 파라미터는 실데이터)		
		*/
		setGridMyCnf : function(paramList){
			

			let categoryList = [{name:'mysqld'},{name:'mysql'},{name:'mysqld_safe'},{name:'mysqldump'},{name:'client'}];
			categoryList = categoryList.map(function(ob){
				return $.extend({},ob,{serverData:false,dataColumn:false,categoryColumn:true,sort:categorySort[ob.name]});
			});
			let gridList = categoryList.slice(); //마지막에 보여줄 전체 grid 리스트
			let comboList = {}; //카테고리별 추가 데이터
			// 카테고리 selectbox 생성 
			
			let dbv = appMariadb['data']['databaseVariables'];
			
			// 콤보박스에 들어가는 값 
			for(let cg in dbv){
				let ds = dbv[cg];
				for(let name in ds){
					if(name == "") continue;
					
					let o = ds[name];
					o.sort = categorySort[o.category];
					if(!o.category)continue;
					
					let _catname1  = String(o.category+o.name).replaceAll('-','_');
					let _catalias = String(o.category+o.alias).replaceAll('-','_');
					
					let existFlag = false;
					for(let i = 0; i < paramList.length; i++) {
						let mc = paramList[i];
						let _catname2 = String(mc.category+mc.name).replaceAll('-','_');
						
						if(_catname1 == _catname2 || _catalias == _catname2) {
							existFlag = true;
							break;
						}
					}
					
					if(!existFlag) {
						if(!comboList[o.category]){
							comboList[o.category] = [];
						}
						comboList[o.category].push(o);
					}
				}
			}			
			// category 구분을 위한 변수 선언 
			let tempCategory = "";
			
			// grid 에 담는 로직...(my.cnf 파싱된 값)
			for(let i = 0; i < paramList.length; i++) {
				let mc = paramList[i];
				mc.dataColumn = true;
				let ds = dbv[mc.category];

				let key = mc.name;
				if(key == "transaction-isolation") {
					key = "tx_isolation";
				} else if(key == "default-time-zone") {
					key = "time_zone";
				}
				
				let o = ds[key];
				
				if(!o) {
					o = ds[String(key).replaceAll('-','_')];
					if(!o) {
						o = [];
						//console.log(mc.category +" / "+ key);
						o.name = mc.name;
						o.alias = mc.name;
						o.category = mc.category;
						/* sort 컬럼 추가하여 sorting 에러문제 해결 (2019-07-10) */
						o.sort = categorySort[mc.category];
						
					}
				}
				
				/* innodb_fast_shutdown 항목의 value 값이 없을 경우 defaultValue 로 셋팅한다. (2019-07-15) */
 				if(o.name == "innodb_fast_shutdown"){
					if(!mc.value && mc.defaultValue ){
						mc.value = 	mc.defaultValue ;
					}else if(!mc.value && o.defaultValue ){
						mc.value = 	o.defaultValue ;	
					}
				} 
				
				/* variableType == 'BOOLEAN' 인 데이터중  ON 인데 화면에 OFF 로 표시되는 현상 수정 적용(2019-07-15) */
				//variable Type Check
				let variableType  =  mc.variableType;
				if(!mc.variableType) variableType  = o.variableType ;
				
				if(!variableType && o.name == "skip_external_locking"){
					variableType = 'BOOLEAN'; //skip_external_locking 일 경우 type을 못찾을수 있다.
					if(!mc.defaultValue) mc.defaultValue = '1' ;
				}else if(!variableType && o.name == "skip_name_resolve"){
					variableType = 'BOOLEAN'; //skip_external_locking 일 경우 type을 못찾을수 있다.
					if(!mc.defaultValue) mc.defaultValue = '0' ;
				}
								
				//variableType == 'BOOLEAN' : value check
 				if(variableType && variableType == 'BOOLEAN'){
				 	//defaultValue check
					if(mc.defaultValue && (mc.defaultValue == 'ON' || mc.defaultValue == 'OFF') ){
						mc.defaultValue = (mc.defaultValue == 'ON'?'1':'0');
					}else if(o.defaultValue && (o.defaultValue == 'ON' || o.defaultValue == 'OFF')){
						mc.defaultValue = (mc.defaultValue == 'ON'?'1':'0');
					}
					// value check 					
					if(mc.value  && (mc.value == '1' || mc.value == '0')){
						mc.value = (mc.value == '1'?'ON':'OFF');
					}
				}
				
				if(tempCategory != mc.category){
					/* select box 중복생성 현상 수정 - 조건식 추가 (2019-07-10)  */
					if(cloudUtil.isEmpty(tempCategory) || categorySort[tempCategory] < categorySort[mc.category]){
						// 콤보박스 셋팅 부부 수정 (22019-07-10)
						for(let k in comboList){
							if(mc.category == k){
								let o = comboList[k];
								gridList.push({category:k, name:'' ,addVariableColumn:true ,dataColumn:false,serverData:false,sort:(categorySort[k])});
								dbv[k].comboList = o;
							}
						}
						tempCategory =  mc.category
					}
				}
				
				gridList.push($.extend({},mc,o,{value:mc.value}));
				
			}
			/* 변경 된 데이터의 하이라이트 처리 추가 (2019-08-08) */
			let oldDt = appMariadb.gridMyCnf.alopexGrid('dataGet',{_state:{edited:true}}); //기존 데이터를 가져온다.

			//appMariadb.gridMyCnf.alopexGrid
			appMariadb.gridMyCnf.alopexGrid('dataSet',gridList).alopexGrid('expandTreeNode');
			appMariadb.gridMyCnf.alopexGrid('dataSort', [
				{sortingColumn : 'sort', sortingDirection: "asc"},
				{sortingColumn : 'name', sortingDirection: "asc"}
			]);
			/* 변경 된 데이터의 하이라이트 처리 추가 (2019-08-08) */
			if(oldDt.length > 0){
				for(let m in oldDt){
					let data = oldDt[m];
					appMariadb.gridMyCnf.alopexGrid('dataEdit', {_state : {edited : true}}, {category:data.category ,name:data.name});
				}
			}
			
			/* 삭제처리 표시 유지 하는 로직 추가 - (2019-07-10)   */
			appMariadb.gridMyCnf.alopexGrid('dataDelete', {deleted: "dataDelete"});
		},saveGridMyCnf : function(){
			
			appMariadb.gridMyCnf.alopexGrid('endRowInlineEdit');
			
			let dt = AlopexGrid.trimData(appMariadb.gridMyCnf.alopexGrid('dataGet',function(data) {
				if(data.name == "tx_isolation" || data.name == "time_zone" )data.name = data.alias ;
				
			    return data.dataColumn == true && data._state.deleted != true;
			}));

			if(gCommon.findObjectByKeyOb(dt,{valid:false}) !=null){
				return;
			};
			

			
			gCommon.confirm("설정을 변경하시겠습니까?",function(){
				let param = $.extend({},gParam,{databaseVariables:JSON.stringify(dt)});
		
				$a.ajax({
					url:'/zdbapi/updateUseDatabaseVariables',
					method:'put',
					data:param,
					success:function(res){
						if(res.result.code == 0){
							gCommon.alert('설정이 변경되었습니다.');
							appMariadb.getMyCnfList();
						}
					}
				});
			})
		},validMyCnf:function(value,data){
			let re = true;
			if(!data.editable)return re;
			// 체크하는 Type의 수를 array로 정리하여 추가함 (201-07-17)
			let validTypeArr = ["BIGINT UNSIGNED","INT UNSIGNED","INT","BIGINT","DOUBLE"]; 

			for(let t in validTypeArr){
				let typeVal = validTypeArr[t];
				if(data.variableType == typeVal ){
					let numericMinValue = data.numericMinValue || '';
					let numericMaxValue = data.numericMaxValue || '';
					
					if(!cloudUtil.isEmpty(numericMinValue)||!cloudUtil.isEmpty(numericMaxValue)){
						let val = (value||'').toUpperCase();
						
						let reg = /^([\-\d]+)([K|M|G]{0,1})$/gi.exec(val); //INT UNSIGNED , INT형일 경우 ,소수점 단위 처리 추가  (2019-07-17)
						if(typeVal == 'DOUBLE'){
							reg = /^([\d\.?]+)([K|M|G]{0,1})$/gi.exec(val);  //DOUBLE 형일 경우 ,소수점 단위 처리 추가  (2019-07-17)
						}
						
						/*
						//BIGINT type 에서도 음수 사용이 되어야 하기 때문에 기본 정규식을 음수 포함으로 변경 
						else if(typeVal == 'INT UNSIGNED' || typeVal =="INT"){
							reg = /^([\d]+)([K|M|G]{0,1})$/gi.exec(val);  //G 단위 추가 (2019-07-17) 
								
						} */

						if(reg==null){
							for(let v in validExcepArr){
								let excepVal = validExcepArr[v];
								if(data.name == excepVal ){
									return re;
								}							
							}
							return false;
						}
						let n = new BigNumber(reg[1]);
						let unit = 1;
						if(reg[2] == 'K'){
							unit = 1024;
						}else if(reg[2] == 'M'){
							unit = 1024 * 1024
						}else if(reg[2] == 'G'){ // giga  단위에 대한 계산식 추가 (2019-07-17)
							unit = 1024 * 1024 * 1024
						}
						let r = n.times(unit);
						let min = new BigNumber(numericMinValue);
						let max = new BigNumber(numericMaxValue);
					    re = (min.isNaN()|| r.gte(min)) && (max.isNaN() || r.lte(max));
					}
				}							
			}
			return re;
		},getDatabase : function(){
			$a.ajax({
				url: '/zdbapi/getDatabases',
				method:'get',
				data: gParam,
				success: function(res){
					let bl = ['information_schema','mysql','performance_schema'];
					let list = res.databases||[];
					let filterList = list.filter(function(ob){
						return bl.indexOf(ob.name)==-1
					});
					appMariadb.gridDatabase.alopexGrid('dataSet',filterList);
				}
			});		
		},saveDatabase : function(){
			appMariadb.gridDatabase.alopexGrid('endRowInlineEdit');
			let data = AlopexGrid.trimData(appMariadb.gridDatabase.alopexGrid('dataGet',{state:'E'},{state:'A'},{state:'D'}));
			if(data.length > 0){
				for(let i in data){
					let d = $.extend(data[i],gParam);
					d.databaseName = d.name;
					if(cloudUtil.isEmpty(d.name)){
						return;
					}
				}
				gCommon.confirm('변경된 정보를 저장하시겠습니까?',function(){
					$a.ajax({
						url: '/zdbapi/saveDatabase',
						method:'put',
						data: {data:JSON.stringify(data)},
						success: function(res){
							appMariadb.getDatabase();
						}
					});	
									
				});
			}
		}
	}
/*
$a.page(function() {
	this.init = function() {
		appMariadb.init();		
	}
});*/
</script>
