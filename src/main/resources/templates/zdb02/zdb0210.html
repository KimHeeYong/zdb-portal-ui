<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="layout/content_layout">
<th:block layout:fragment="page_head">
    <title>서비스 상세</title>
</th:block>
<th:block layout:fragment="page_css">
	<link rel="stylesheet" href="/styles/css/nouislider.min.css">
	<style type="text/css">
		#restartService{
			width:38px;
			height:38px;
			padding-bottom: 6px;
			border: 1px solid #cccccc;
			background-position: -25px -173px; 
		}
		.TooltipEvt{
			font-size:1.0em;
		}
	</style>  
</th:block>
<th:block layout:fragment="page_js">
	<script type="text/javascript" th:inline="javascript">
		/*<![CDATA[*/
		var gApiServerUrl = [[${@environment.getProperty('zdb-api-server.url')}]];
		var gGrafanaUrl = [[${@environment.getProperty('grafana.url')}]];
		/*]]>*/
	</script>
	<script type="text/javascript" src="/script/app/common/cloudzdb-ui-z0200.js"></script>
	<script type="text/javascript" src="/script/libs/etc/nouislider.min.js"></script>
	<script src="/script/libs/sockjs/sockjs.js"></script>
	<script src="/script/libs/sockjs/stomp.js"></script>
	<script src="/script/app/common/cloudzdb-ui-sock.js"></script>	
	
</th:block>
<th:block layout:fragment="content">
<!-- location -->
<div class="locations-area">
	<div class="prj-list">
		<strong>Namespace : </strong>
		<button id="namespaces" class="Dropdownbutton namespace"></button>
		<ul class="dropmenu-list hide">
		</ul>
	</div>
	<div class="back-list" id="backServices">
		<a href="#"><span>목록으로 돌아가기</span></a>
	</div>
</div>
<div class="contents-box info-box">
	<!-- contents-titie-->
	<div class="top-area info-area">
		<!-- service 각 항목에 대한 상세 panel-->
		<div class="Panel service-panel" id="divService">

		</div>
		<div class="Panel service-panel">
			<div class="Panel-content">
				<div style="float: left;word-break:break-all;font-size: 14px;" id="divInfoMsg"></div>
				<div class="config-wrap" th:if="${session.userInfo.accessRole=='cluster-admin'}" >
					<button class="btn-ico btn-refresh" id="restartService" title="재시작">재시작 </button>
					<button class="Button btn-ico__typeb btn-trash" id="deleteService" title="삭제">삭제</button>
				</div>
			</div>
			<div class="Panel-content">
				<ul class="config-info" id="configInfo">
					<li>
						<strong>할당 CPU : </strong>
						<span data="cpu"></span>
					</li>
					<li>
						<strong>할당 메모리 : </strong>
						<span data="memory"></span>
					</li>
					<li>
						<strong>스토리지 : </strong>
						<span data="disk"></span>
					</li>
					<li th:if="${#request.getParameter('serviceType')=='mariadb'}">
						<strong>스토리지 QoS : 	</strong>
						<span data="storageClass"></span>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<!-- tab wrap -->
	<div class="Tabs db-tabs" id="zdbServiceTabs">
		<ul>
			<li data-content="#tabService">서비스 정보</li>
			<li data-content="#tabScale">스케일</li>
			<li data-content="#tabMonitor">모니터링</li>
			<li data-content="#tabBackup">백업</li>
			<li data-content="#tabEvent">이벤트</li>
			<li data-content="#tabUser">사용자</li>
			<li data-content="#tabSystem">환경설정</li>
		</ul>
		<!-- 서비스 정보 PageID: ZDB-02-10R -->
		<div id="tabService">
			<!-- accordion wrap-->
			<ul class="cp-accordion">
				<li>
					<h3 class="form-title">Connection</h3>
					<div class="accor-contents__wrap">
						<form name="formService">
						<table id="connectionInfoTable" class="Table Form-type">
							<colgroup>
								<col style="width: 200px;"> </col>
								<col></col>
							</colgroup>
							<tbody>
								<tr>
									<th>Credential</th>
									<td>
										<input id="credential" name="credential" class="Textinput" type="password" autocomplete="off"/>
										<span class="input-pw"></span>
										<button class="Button line-btn" id="togglePwd">보기</button>
										<button class="Button line-btn" id="credentialCopy">복사</button>
										<button class="Button line-btn" id="credentialUpdate">변경</button>
										<span class="Color-warning hide connectionInfoCopyed">복사되었습니다.</span>
									</td>	
								</tr>
								<tr>
									<th> 접속포트</th>
									<td data="port" th:if="${#request.getParameter('serviceType')} == 'redis'"> </td>
									<td th:if="${#request.getParameter('serviceType')} != 'redis'">
										<input type="text" class="Textinput" name="port" id="port">
										<button class="Button line-btn" id="portUpdate">변경</button>
										<p data-for="port" class="warn-text"></p>
									</td>
								</tr>
								<tr>                                                                                                 
					               	<th rowspan="2">Private Network</th>      
					               	<td>                                                                 
										<span class="info-cnt__title">Master</span>
										<div class="info-radio__wrap">
											<label class="ImageRadio"> <input class="Radio" name="con1" value="connectionString" checked="checked">Connection String </label>
											<label class="ImageRadio"> <input class="Radio" name="con1" value="connectionLine">Command Line </label>
										</div>
										<div class="info-input__wrap connectionString">	
						               		<input class="Textinput" name="privatemasterConnectionString" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>
						               	</div>
						               	<div class="info-input__wrap connectionLine hide">	
						               		<input type="text" class="Textinput" name="privatemasterConnectionLine" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>                         
						               	</div>
						               	<div class="fl hide" id="divFailoverArea">
            				           		<div id="divFailoverBtn" class="hide">
							               		<button class="Button btn">Failover</button>
						               			<span class="Tooltip hide">Master DB가 장애로 서비스가 불가능한 상태가 되면,<br/> failover를 수행하여 slave DB를 master DB로 승격시켜<br/> 서비스 다운타임을 최소화 합니다.</span>
						               		</div>
						               		<div id="divFailbackBtn" class="hide">
						               			<button class="Button btn">Failback</button>
						               		</div>
						               	</div>	
						               	<span class="Color-warning hide connectionInfoCopyed">복사되었습니다.</span>
					               	</td>                                                                                         
				                </tr>
				                <tr class="slaveConnection">
					               	<td>
					               		<span class="info-cnt__title">Slave</span>
										<div class="info-radio__wrap">
											<label class="ImageRadio"> <input class="Radio" name="con2" value="connectionString" checked="checked">Connection String </label>
											<label class="ImageRadio"> <input class="Radio" name="con2" value="connectionLine">Command Line </label>
										</div>					               		
					               		<div class="info-input__wrap connectionString">                                                                                                  
						               		<input class="Textinput" name="privateslaveConnectionString" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>                          
						               	</div>
						               	<div class="info-input__wrap connectionLine hide">
						               		<input type="text" class="Textinput" name="privateslaveConnectionLine" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>                          
						               	</div>	
					               		<span class="Color-warning hide connectionInfoCopyed">복사되었습니다.</span>                                                                                      
					               	</td>                  
				                </tr>
			                </tbody>
			                <tbody class="publicConnectionInfo publicNetworkTbody hide">
								<tr>                                                                                                 
					               	<th rowspan="2">Public Network</th>                                                                       
					               	<td>       
					               	    <span class="info-cnt__title">Master</span>
										<div class="info-radio__wrap">
											<label class="ImageRadio"> <input class="Radio" name="con3" value="connectionString" checked="checked">Connection String </label>
											<label class="ImageRadio"> <input class="Radio" name="con3" value="connectionLine">Command Line </label>
										</div>
        						   		<div class="info-input__wrap connectionString">                                                                                                  
						               		<input class="Textinput" name="publicmasterConnectionString" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>                          
						               	</div>
						               	<div class="info-input__wrap connectionLine hide">                                                                   
						               		<input type="text" class="Textinput" name="publicmasterConnectionLine" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>                         
						               	</div>	
						               	<button class="Button btn-ico__typeb btn-trash" id="publicNetworkDelete" title="Public Network 삭제">삭제</button>
					               		<span class="Color-warning hide connectionInfoCopyed">복사되었습니다.</span>                                                                                      
					               	</td>                                                                                         
				                </tr>
				                <tr class="slaveConnection">
					               	<td>
					               	    <span class="info-cnt__title">Slave</span>
										<div class="info-radio__wrap">
											<label class="ImageRadio"> <input class="Radio" name="con4" value="connectionString" checked="checked">Connection String </label>
											<label class="ImageRadio"> <input class="Radio" name="con4" value="connectionLine">Command Line </label>
										</div>					               	
		               	           		<div class="info-input__wrap connectionString">                                                                                                  
						               		<input class="Textinput" name="publicslaveConnectionString" readonly="readonly"></input>      
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>                          
						               	</div> 
						               	<div class="info-input__wrap connectionLine hide">                                                                                              
						               		<input type="text" class="Textinput" name="publicslaveConnectionLine" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>
						               	</div>	                          
					               		<span class="Color-warning hide connectionInfoCopyed">복사되었습니다.</span>                                                                                      
					               	</td>                  
				                </tr>
			                </tbody>
			                <tbody class="publicConnectionInfoNone publicNetworkTbody hide">
								<tr>                                                                                                 
					               	<th>Public Network</th>                                                                       
					               	<td>       
					               	    <button class="Button btn" id="publicNetworkCreate">Public Network생성</button>                                                                                 
					               	</td>                                                                                         
				                </tr>
			                </tbody>
						</table>
						</form>
					</div>
				</li>
				<li id="divFailover" class="hide">
					<h3 class="form-title">Failover</h3>
					<div class="accor-contents__wrap">
						<table id="connectionInfoTable" class="Table Form-type">
							<colgroup>
								<col style="width: 200px;"> </col>
								<col></col>
							</colgroup>
							<tbody>
								<tr>
									<th>Auto Failover</th>
									<td>
										<div class="onoff-wrap fl mr30"><button class="Button btn-off" data-target="failOverEnable">OFF</button></div>
										<div class="hide">
											<select name="failOverEnable"> <option value="Y">Y</option> <option value="N">N</option> </select>
										</div>
										<div class="Icon ico-cloudz alarm fl mt5 mr5"></div>
										<div class="fl">
										Master 노드 장애발생시 임계 시간동안 서비스가 복구되지 않을 경우 
										자동으로 Slave 노드로 서비스를 전환합니다.(최초 설정 변경시 서비스가 재시작 됩니다.)
										</div>  
									</td>
								</tr>
							</tbody>
						</table>										
					</div>
				</li>
				<li>
					<h3 class="form-title">Resource</h3>
					<div class="accor-contents__wrap">
						<div id="gridResource" class="grid"></div>
					</div>
				</li>
			</ul>
		</div>
		<!--스케일 PageID: ZDB-02-20R -->
		<div id="tabScale">
			<!-- accordion wrap-->
			<ul>
				<li>
					<h3 class="form-title">Scale Up/Down</h3>
					<div class="accor-contents__wrap">
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 200px;">
								<col>
							</colgroup>
							<tbody>
								<tr>
									<th class="Valign-top">리소스</th>
									<td class="overflow-hidden">
										<div class="info-wrap">
											<div class="info-radio__wrap">
												<label class="ImageRadio"> <input class="Radio" name="scaleType" value="progress" checked="checked">리소스선택</label>
												<label class="ImageRadio"> <input class="Radio" name="scaleType" value="custom">사용자입력</label>
											</div>
											<p class="memory-title">&nbsp;</p>
											<div class="info-wrap ht60">
												<div id="divScaleProgress">
													<div class="memory-info" id="memoryInfo">1GB</div>
													<div class="progress-wrap">
														<div class="memory-bar" id="memorySlider"></div>
													</div>
												</div>
												<div id="divScaleCustom" class="hide">
													<form id="scaleForm" name="scaleForm">
													<div class="wd200 fl">
														CPU : <input type="text" class="Textinput wd100" id="scaleCpu" name="scaleCpu"/> m
														<p data-for="scaleCpu" class="warn-text"></p>
													</div>
													<div>
														Memory : <input type="text" class="Textinput wd100" id="scaleMemory" name="scaleMemory"/> Mi
														<p data-for="scaleMemory" class="warn-text"></p>
													</div>
													</form>
												</div>
											</div>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="btn-wrap__right">
							<button class="Button btn bg-red" id="updateScaleUp">적용하기</button>
						</div>
					</div>
				</li>
				<li th:if="${#request.getParameter('serviceType')} == 'redis'" id="divScaleOut">
					<h3 class="form-title">Scale In/Out</h3>
					<div class="accor-contents__wrap">
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 200px;">
								<col>
							</colgroup>
							<tbody>
								<tr>
									<th class="Valign-top" >Read-Only Slave 수</th>
									<td>
										<div id="clusterSlaveCountSpinner" class="Spinner" data-min="1" data-max="1" data-step="1">
										    <input id="clusterSlaveCount" name="clusterSlaveCount" value="1">
										    <a class="Up"></a>
										    <a class="Down"></a>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="btn-wrap__right">
							<button class="Button btn bg-red" id="updateScaleOut">적용하기</button>
						</div>	
					</div>		
				</li>
			</ul>
		</div>
		
		<!--모니터링 PageID: ZDB-02-40R -->
		<div id="tabMonitor">
			<ul>
				<li th:if="${#request.getParameter('serviceType')=='mariadb'}">
					<div align="right">
						<a id="advancedMonitoring" target="_sub">
							<button class="Button btn" style="margin-top: 1px;margin-bottom: 1px;">Advanced Monitoring</button>
						</a>
					</div>
					<h3 class="form-title" style="margin-top: 0px;">System Resources</h3>
					<div class="tabs-contents">
                         <table class="Table Monitoring">
							  <tbody>
								  <tr>
								      <td> <div class="panel-cpu" id="panelCpu"><iframe id="monitoringPanel"></iframe></div> </td>
									  <td> <div class="panel-memory" id="panelMemory"><iframe id="monitoringPanel"></iframe></div> </td>
									  <td> <div class="panel-network" id="panelNetwork"><iframe id="monitoringPanel"></iframe></div> </td>
								  </tr>
							  </tbody>
						</table>
		            </div>
					<h3 class="form-title">Connections & Table</h3>
					<div class="tabs-contents">
                         <table class="Table Monitoring">
							<tbody>
								<tr>
									<td> <div class="panel-connections" id="panelConnections"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-thread" id="panelThread"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-tablelack" id="panelTablelack"><iframe id="monitoringPanel"></iframe></div> </td>
								</tr>
							</tbody>
						</table>
		            </div>
					<h3 class="form-title">Query & Replication</h3>
					<div class="tabs-contents">
                         <table class="Table Monitoring">
							<tbody>
								<tr>
									<td> <div class="panel-qps" id="panelQps"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-replicationdelay" id="panelReplicationdelay"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-sqlthread" id="panelSqlthread"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-iothread" id="panelIothread"><iframe id="monitoringPanel"></iframe></div> </td>
								</tr>
							</tbody>
						</table>
		            </div>
				</li>
			</ul>
			<ul>
				<li th:if="${#request.getParameter('serviceType')=='redis'}">
					<div align="right">
						<a id="advancedMonitoring" target="_sub">
							<button class="Button btn" style="margin-top: 1px;margin-bottom: 1px;">Advanced Monitoring</button>
						</a>
					</div>
					<h3 class="form-title" style="margin-top: 0px;">System Resources</h3>
					<div class="tabs-contents">
                         <table class="Table Monitoring">
							<tbody>
								<tr>
									<td> <div class="panel-cpu" id="panelCpu"> <iframe id="monitoringPanel"></iframe> </div> </td>
									<td> <div class="panel-memory" id="panelMemory"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-network" id="panelNetwork"><iframe id="monitoringPanel"></iframe></div> </td>
								</tr>
							</tbody>
						</table>
		            </div>
					<h3 class="form-title">Keys</h3>
					<div class="tabs-contents">
                         <table class="Table Monitoring">
							<tbody>
								<tr>
									<td> <div class="panel-items" id="panelItems"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-expiringvsnot" id="panelExpiringvsnot"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-expired" id="panelExpired"><iframe id="monitoringPanel"></iframe></div> </td>
								</tr>
							</tbody>
						</table>
		            </div>
					<h3 class="form-title">Commands</h3>
					<div class="tabs-contents">
                         <table class="Table Monitoring">
							<tbody>
								<tr>
									<td> <div class="panel-executed" id="panelExecuted"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-hits" id="panelHits"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-calls" id="panelCalls"><iframe id="monitoringPanel"></iframe></div> </td>
								</tr>
							</tbody>
						</table>
		            </div>
				</li>
			</ul>
		</div>
		<div id="tabBackup">
			<h3 class="form-title">백업</h3>
           	<!-- tab contents info detail-->
         	<form name="backupForm" method="post">
           	<div class="ctn-info__wrap">
         		<div class="mr30 info-list">
         			<span class="config-title">백업설정 :</span>
					<div class="onoff-wrap"><button class="Button btn-off" data-target="useYn">OFF</button></div>
					<div class="hide">
						<select name="useYn"> <option value="Y">Y</option> <option value="N">N</option> </select>
					</div>									
				</div>
				<div class="mr30 info-list"><span class="config-title">보관기간:</span> 
					<div class="Spinner" data-min="0" data-max="60" data-step="1" id="storePeriodSpinner">
					    <input id="storePeriod" name="storePeriod" value="1" style="width:80px;">
					    <a class="Up"></a>
					    <a class="Down"></a>
					</div>
					<span class="fr">일</span>
				</div>
				<div class="mr30 info-list">
					<span class="config-title">전체 백업 시간:</span>
					<div class="Spinner Time" data-locale="en" id="startTime" data-hours="24H" data-bind="time:date">
					    <input data-hour>
					    <span data-seperator>:</span>
					    <input data-minute>
					    <input data-ampm>
					    <a class="Up"></a>
					    <a class="Down"></a>
					</div>
				</div>
				<div class="mr30 info-list">
					<span class="config-title">증분 백업:</span>
					<div class="Divselect" id="incrementPeriod" name="incrementPeriod">
						<select>
							<option value="0">미사용</option>
							<option value="1">1시간</option>
							<option value="2">2시간</option>
							<option value="6">6시간</option>
							<option value="12">12시간</option>
						</select>
						<span></span>
					</div>
					<button class="Button btn bg-red Disabled" id="saveSchedule">수정</button>
				</div>
				<div class="info-list__select">	
					<button class="Button btn" id="updateBackup">지금 백업하기</button>
					<button class="Button btn" id="searchBackup">조회</button>
				</div>	
          	</div>					
           	<div class="info-list__select mt10" >
           		<input class="Checkbox" type="checkbox" id="backupSearchType" checked="checked"/>증분백업포함
				<!-- button class="Button btn-search" id="searchBackup">검색</button-->
           	</div>
          	</form>
           	<!-- grid -->
            <div id="gridBackup" class="grid grid-line__wrap dash"></div>
		</div>
		<div id="tabEvent">
			<h3 class="form-title">이벤트</h3>
           		<form name="eventForm" method="post">
           		<div class="ctn-info__wrap">
					<div class="info-list select-date Daterange" data-selectyear="true" data-selectmonth="true">
						<div class="Startdate Dateinput">
						    <input id="eventStartDate" name="eventStartDate" type="text" readonly="readonly">
						    <div class="Calendar" id="eventStartDate"></div>
						</div>
						<div class="Spinner Time" data-locale="en" id="eventStartTime" name="eventStartTime" data-hours="24H" data-bind="time:date">
						    <input data-hour>
						    <span data-seperator>:</span>
						    <input data-minute>
						    <input data-ampm>
						    <a class="Up"></a>
						    <a class="Down"></a>
						</div>
						<span class="date-line">~</span>
						<div class="Enddate Dateinput">
						    <input id="eventEndDate" name="eventEndDate" type="text" readonly="readonly">
						    <div class="Calendar" id="eventEndDate"></div>
						</div>
						<div class="Spinner Time" data-locale="en" id="eventEndTime" name="eventEndTime" data-hours="24H" data-bind="time:date">
						    <input data-hour>
						    <span data-seperator>:</span>
						    <input data-minute>
						    <input data-ampm>
						    <a class="Up"></a>
						    <a class="Down"></a>
						</div>
					</div>
					<div class="info-list__select">
						<input name="keyword" class="Textinput srcinput" placeholder="검색어를 입력하세요."/><button class="Button btn-search" id="searchEvent">검색</button>
					</div>
           		</div>
           		</form>
           	<!-- grid -->
            <div id="gridEvent" class="grid grid-line__wrap dash"></div>
            <div class="Tooltip" id="evtTooltip" data-position="bottom|left"></div>
		</div>
		<div id="tabUser">
			<h3 class="form-title">사용자 목록 및 권한</h3>
			<div class="tabs-contents">
   				<div id="gridUser" class="grid grid-line__wrap"></div>
   			</div>
		</div>		
		<div id="tabSystem">
			<form name="dbConfig" method="post">
			<ul>
				<li th:if="${#request.getParameter('serviceType')=='redis'}">
					<div class="accor-contents__wrap">
					<h3 class="form-title">Network  <span class="fr"><button class="Button btn" style="margin-top:-4px;" id="popVariables">설정 보기</button></span></h3>
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 250px;"> </col>
								<col> </col>
							</colgroup>
							<tbody>
								<tr>
									<th>timeout <span class="ico_title" id="iconTimeout"></span></th>
									<td> 
										<input type="text" id="timeout" name="timeout" class="Textinput"/>
										<span class="info-text">범위 : 0 ~ 3,600</span>
										<p data-for="timeout" class="warn-text"></p>
									</td>
								</tr>
								<tr>
									<th>tcp-keepalive<span class="ico_title" id="iconTcpKeepalive"></span></th>
									<td> 
										<input type="text" id="tcp-keepalive" name="tcp-keepalive" class="Textinput"/>
										<span class="info-text">범위 : 0 ~ 3,600</span>
										<p data-for="tcp-keepalive" class="warn-text"></p>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="Tooltip" data-base="#iconTimeout" data-position="right" data-animation="fade">
							Redis 서버에 연결된 Client가 timeout 시간(초) 동안 아무 명령이 없으면 접속을 끊습니다.
							<br>timeout 값이 0인 경우, 아무 명령이 없어도 접속을 끊지 않습니다.
						</div>
						<div class="Tooltip" data-base="#iconTcpKeepalive" data-position="right" data-animation="fade">
							Redis 서버가 tcp-keepalive 시간(초)마다 Client의 상태를 확인하여 아무 응답이 없으면 접속을 끊습니다.
							<br>tcp-keepalive 값이 0인 경우, 아무 응답이 없어도 접속을 끊지 않습니다.
						</div>
						<h3 class="form-title">Memory Management</h3>
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 250px;"> </col>
								<col> </col>
							</colgroup>
							<tbody>
								<tr>
									<th>maxmemory-policy<span class="ico_title" id="iconMaxmemoryPolicy"></span></th>
									<td> 
										<div class="Divselect" style="width: 150px">
										<select id="maxmemory-policy" name="maxmemory-policy">
											<option value="noeviction">noeviction</option>
											<option value="allkeys-lru">allkeys-lru</option>
											<option value="volatile-lru">volatile-lru</option>
											<option value="allkeys-random">allkeys-random</option>
											<option value="volatile-random">volatile-random</option>
											<option value="volatile-ttl">volatile-ttl</option>
										</select>
										<span></span>
										</div>
									</td>
								</tr>
								<tr>
									<th>maxmemory-samples<span class="ico_title" id="iconMaxmemorySamples"></span></th>
									<td>
										<input type="text" id="maxmemory-samples" name="maxmemory-samples" class="Textinput"/>
										<span class="info-text">범위 : 1 ~ 10</span>
										<p data-for="maxmemory-samples" class="warn-text"></p>
									</td>
								</tr>	
							</tbody>
						</table>
						<div class="Tooltip" data-base="#iconMaxmemoryPolicy" data-position="right" data-animation="fade">
							메모리 관리에 대한 정책을 선택합니다.
							<br>‣ noeviction: 기존 데이터를 삭제하지 않습니다. 메모리 한계에 도달하면 OOM 오류 반환하며, 새 데이터가 저장되지 않습니다.
							<br>‣ allkeys-lru: 전체 키에 대하여 LRU 알고리즘으로 데이터를 삭제하여 공간을 확보하고, 새 데이터를 저장합니다.
							<br>‣ volatile-lru: expire set을 가진 키에 대하여 LRU 알고리즘으로 데이터를 삭제하여 공간을 확보하고, 새 데이터를 저장합니다.
							<br>‣ allkeys-random: 전체 키에 대하여 랜덤으로 데이터를 삭제하여 공간을 확보하고, 새 데이터를 저장합니다.
							<br>‣ volatile-random: expire set을 가진 키에 대하여 랜덤으로 데이터를 삭제하여 공간을 확보하고, 새 데이터를 저장합니다.
							<br>‣ volatile-ttl: expire set을 가진 키에 대하여 TTL이 짧은 것부터 데이터를 삭제하여 공간을 확보하고, 새 데이터를 저장합니다.
						</div>
						<div class="Tooltip" data-base="#iconMaxmemorySamples" data-position="right" data-animation="fade">
							메모리를 절약하기 위해서, LRU 알고리즘 수행 시 검사를 위한 샘플의 크기를 선택합니다.
							<br>낮을 수록 메모리를 절약 할 수 있습니다.
						</div>
					    <h3 class="form-title">Slow Log</h3>
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 250px;"> </col>
								<col> </col>
							</colgroup>
							<tbody>	
								<tr>
									<th>slowlog-log-slower-than<span class="ico_title" id="iconSlowlogLST"></span></th>
									<td>
										<input type="text" id="slowlog-log-slower-than" name="slowlog-log-slower-than" class="Textinput"/>
										<span class="info-text">범위 : -1 ~ 12000</span>
										<p data-for="slowlog-log-slower-than" class="warn-text"></p>
									</td>
								</tr>
								<tr>
									<th>slowlog-max-len<span class="ico_title" id="iconSlowlogMaxLen"></span></th>
									<td>
										<input type="text" id="slowlog-max-len" name="slowlog-max-len" class="Textinput"/>
										<span class="info-text">범위 : 1 ~ 256</span>
										<p data-for="slowlog-max-len" class="warn-text"></p>
									</td>
								</tr>	
							</tbody>
						</table>
						<div class="Tooltip" data-base="#iconSlowlogLST" data-position="right" data-animation="fade">
							slowlog-log-slower-than 값으로 설정된 시간(밀리초) 이상 소요되는 명령을 Slowlog로 기록합니다.
							<br>값이 0인 경우 모든 명령을 기록합니다.
							<br>값이 음수인 경우 아무런 명령을 기록하지 않습니다.
						</div>
						<div class="Tooltip" data-base="#iconSlowlogMaxLen" data-position="right" data-animation="fade">
							slowlog의 최대 개수를 지정합니다.
						</div>
					    <h3 class="form-title">Event Notification</h3>
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 250px;"> </col>
								<col> </col>
							</colgroup>
							<tbody>									
								<tr>
									<th>notify-keyspace-events<span class="ico_title" id="iconNotifyKeyspaceEvents"></span></th>
									<td>
										<input type="text" id="notify-keyspace-events" name="notify-keyspace-events" class="Textinput"/>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="Tooltip" data-base="#iconNotifyKeyspaceEvents" data-position="right" data-animation="fade">
							Redis의 Keyspace Event에 대한 Notification 기능을 설정합니다.
							<br>‣ " ": notification 비활성화
							<br>‣ K: Keyspace 이벤트, published with __keyspace@__ prefix.
							<br>‣ E: Keyevent 이벤트, published with __keyevent@__ prefix.
							<br>‣ g: 데이터 타입이 지정돼 있지 않은 일반 명령어(예: DEL, EXPIRE, RENAME 등)
							<br>‣ $: String 명령어
							<br>‣ l: List 명령어
							<br>‣ s: Set 명령어
							<br>‣ h: Hash 명령어
							<br>‣ z: Sorted set 명령어
							<br>‣ x: Expired 이벤트 (events generated every time a key expires)
							<br>‣ e: Evicted 이벤트 (events generated when a key is evicted for maxmemory)
							<br>‣ A: 혼합 옵션 (예: "AKE"는 모든 이벤트를 의미함)
						</div>
						<div id="divAdvancedConfig">
							<h3 class="form-title">Advanced Config</h3>
							<table class="Table Form-type">
								<colgroup>
									<col style="width: 250px;"> </col>
									<col> </col>
								</colgroup>
								<tbody>		
									<tr>
										<th>hash-max-ziplist-entries<span class="ico_title" id="iconHashMZE"></span></th>
										<td>	
											<input type="text" id="hash-max-ziplist-entries" name="hash-max-ziplist-entries" class="Textinput"/>
											<span class="info-text">범위 : 0 ~ 65536</span>
											<p data-for="hash-max-ziplist-entries" class="warn-text"></p>
										</td>
									</tr>
									<tr>	
										<th>hash-max-ziplist-value<span class="ico_title" id="iconHashMZV"></span></th>
										<td>
											<input type="text" id="hash-max-ziplist-value" name="hash-max-ziplist-value" class="Textinput"/>
											<span class="info-text">범위 : 0 ~ 65535</span>
											<p data-for="hash-max-ziplist-value" class="warn-text"></p>
										</td>
									</tr>	
									<tr>	
										<th>list-max-ziplist-size<span class="ico_title" id="iconListMZS"></span></th>
										<td>
											<input type="text" id="list-max-ziplist-size" name="list-max-ziplist-size" class="Textinput"/>
											<span class="info-text">범위 : -5 ~ 5</span>
											<p data-for="list-max-ziplist-size" class="warn-text"></p>
										</td>
									</tr>	
									<tr>	
										<th>zset-max-ziplist-entries<span class="ico_title" id="iconZsetMZE"></span></th>
										<td>
											<input type="text" id="zset-max-ziplist-entries" name="zset-max-ziplist-entries" class="Textinput"/>
											<span class="info-text">범위 : 0 ~ 65536</span>
											<p data-for="zset-max-ziplist-entries" class="warn-text"></p>
										</td>
									</tr>	
									<tr>	
										<th>zset-max-ziplist-value<span class="ico_title" id="iconZsetMZV"></span></th>
										<td>
											<input type="text" id="zset-max-ziplist-value" name="zset-max-ziplist-value" class="Textinput"/>
											<span class="info-text">범위 : 0 ~ 65536</span>
											<p data-for="zset-max-ziplist-value" class="warn-text"></p>
										</td>
									</tr>	
								</tbody>
							</table>
							<div class="Tooltip" data-base="#iconHashMZE" data-position="right" data-animation="fade">
								Hash의 Field 개수를 설정합니다. 값이 512일 때, Filed 수가 512개 이하이면 Zip list로 저장됩니다.
							</div>
							<div class="Tooltip" data-base="#iconHashMZV" data-position="right" data-animation="fade">
								값(String)의 크기를 설정합니다. 값이 64일 때, 값의 크기가 64Byte 이하이면 Zip list로 저장됩니다.
							</div>
							<div class="Tooltip" data-base="#iconListMZS" data-position="right" data-animation="fade">
								Zip list의 크기를 설정합니다.
								<br>‣ -5 : max size 64 kb
								<br>‣ -4 : max size 32 kb
								<br>‣ -3 : max size 16 kb
								<br>‣ -2 : max size  8 kb (default)
								<br>‣ -1 : max size  4 kb
								<br>‣ 1 : entry 1
								<br>‣ 2 : entries 2
								<br>‣ n : entries n
							</div>
							<div class="Tooltip" data-base="#iconZsetMZE" data-position="right" data-animation="fade">
								Sorted Set에 포함된 멤버의 개수 기준을 설정합니다.
								<br>값이 128일 때, Sorted Set에 포함된 멤버의 개수가 128보다 크면 Skip list로,
								<br>아니면 Zip list로 인코딩 됩니다.
							</div>
							<div class="Tooltip" data-base="#iconZsetMZV" data-position="right" data-animation="fade">
								Sorted Set의 사이즈의 기준을 설정합니다.
								<br>값이 64일 때, Sorted Set에 포함된 요소 중 가장 긴 요소의 길이가 이 값보다 크면 Skip list로, 
								<br>아니면 Zip list로 인코딩 됩니다.
							</div>
						</div>
			            <div class="btn-wrap__right">
				        	<button class="Button btn bg-red" id="saveVariables">적용하기</button>
				        </div>
					</div>
				</li>
				
				<li th:if="${#request.getParameter('serviceType')=='mariadb'}">
					<h3 class="form-title">Parameter <span class="fr"><button class="Button btn" style="margin-top:-4px;" id="popVariables">설정 보기</button></span></h3>
					<div class="accor-contents__wrap">	
						<table id="serviceConfigTable" class="Table Form-type">
							<colgroup>
								<col style="width: 280px;"> </col>
								<col> </col>
							</colgroup>							
							<tbody> </tbody>
						</table>
			            <div class="btn-wrap__right">
				        	<button class="Button btn bg-red" id="saveVariables">적용하기</button>
				        </div>						
					</div>
				</li>
			</ul>
			</form>
		</div>
		
	</div>
</div>
<script type="text/javascript">
	var gCurrentNamespace = '';
	var gNamespaces = null;
	var gService = null;
	var gTagList = [];
	var gServiceScale = {};//scaleUp value
	var gConfigData = null;
	$a.page(function() {
		
		this.init = function() {
			//namespace 변경시 이벤트
			gNamespaces = gCommon.getNamespaceCombo($('#namespaces'))
								 .select({id:gSelectedNamespace})
								 .addHandler(function(e) {
									  gCommon.setSelectedNamespace(e.currentTarget.id);
									  gCommon.movePage('/zdb02/zdb0200',{selectedNamespace:gSelectedNamespace});
		   						  });
			$('.Accordion').expandAll();
			gConfigData = gCommon.getConfigData();
			var data = {
					namespace:gParam.namespace,
					serviceType:gParam.serviceType,
					serviceName:gParam.serviceName
				};

			//탭 변경 시 조회
			$('#zdbServiceTabs').on('tabchange', function(e, index, index2){
				fn_displayTabs(index);
			});
		
			function fn_displayTabs(index){
				var tabId = $('#zdbServiceTabs').getTabContentByIndex(index).id;
				fn_setSelected2010Tab(tabId);
				//탭 모니터내의 스크립트 실행이 많아서 iframe들을 초기화
				$('#tabMonitor').find('iframe').attr('src','');
				
				switch(tabId){
					case "tabService":
						$("#gridResource").alopexGrid( "viewUpdate" );
						fn_getConnectionInfo();
						break;
					case "tabScale":
						break;
					case "tabMonitor":
						fn_getMonitoring();
						break;
					case "tabBackup":
						$("#gridBackup").alopexGrid( "viewUpdate" );
						fn_getBackupScheduleInfo();
						fn_getBackupInfo();
						break;						
					case "tabEvent":
						$("#gridEvent").alopexGrid( "viewUpdate" );
						fn_getEventInfo();
						break;
					case "tabUser":
						$("#gridUser").alopexGrid( "viewUpdate" );
						fn_getUserGrants();
						break;
					case "tabSystem":
						fn_getConfigurationInfo();
						break;
				}
			}
			$('#backServices').on('click',function(){
				gCommon.movePage('/zdb02/zdb0200',{selectedNamespace:gSelectedNamespace});
			});			
			$('#deleteService').on('click',function(){
				gCommon.credentialConfirm({
			        data:{credential:$("#credential").val(),msg:'서비스를 삭제하시려면',okBtnMsg:'삭제'},
			        callback : function(res){
						$a.ajax({
							url: '/zdbapi/deleteServiceInstance',
							data:gParam,
							success: function(res){
								gCommon.alert('삭제 요청이 완료 되었습니다.');
								gCommon.movePage('/zdb02/zdb0200',{selectedNamespace:gSelectedNamespace});
							}
						})
			        }
			    });
			});
			$('#restartService').on('click',function(){
				gCommon.credentialConfirm({
			        data:{credential:$("#credential").val(),msg:'서비스를 재시작 하시려면',okBtnMsg:'재시작'},
			        callback : function(res){
						$a.ajax({
							url: '/zdbapi/restartService',
							data:data,
							success: function(res){
								gCommon.alert('재시작 요청이 완료 되었습니다.');
							}
						})
			        }
			    });		
			});
			//서비스 목록내 태그 삭제
			$('body').on('click','button.tagDel',function(){
				var ob = $(this).prev();
				gCommon.confirm('선택한 태그를 삭제하시겠습니까?',function(){
					var data = gCommon.findObjectByKeyOb(gTagList,{id:ob.data('id')});
					data = $.extend({},data,{serviceName:data.releaseName});
					$a.ajax({
						url: '/zdbapi/deleteTag',
						data: data, 
						success: function(res){
							//fn_getService();
						}
					});
				})
			});		
			//서비스 목록내 태그 추가
			$('body').on('click','button.tagAdd',function(e){
				e.preventDefault();
				$(this).next().show().find('input').focus();
			});
			$('body').on('keypress','input.tagAddInput',function(evt){
				if(evt.which == '13'){
		    		var data = {namespace:gService.namespace,serviceName:gService.serviceName,releaseName:gService.serviceName,tagName:$(this).val()};
					$a.ajax({
						url: '/zdbapi/createTag',
						data: data, 
						success: function(res){
				    		//fn_getService();
						}
					});
				};
			}).on('focusout','input.tagAddInput',function(){
				$(this).val('').parent().hide();
			});			
			/* tabService start */
			let tabService = $('#tabService');
			let formService = $('form[name=formService]');
			formService.validator({
			    elements :{ 
			        'port': {rule:{required:true}}
			    }
			});						
			$('#togglePwd').on('click',function(){
				var isShowPwd = $('#credential').attr('type')=='password';
				if(isShowPwd){
					$('#credential').attr('type','text');
					$('#connectionInfoTable').find('input[data-origin]').each(function(){
						var ob = $(this);
						ob.val(ob.val().replace('[password]',$('#credential').val()));
					});
				}else{
					$('#credential').attr('type','password');
					$('#connectionInfoTable').find('input[data-origin]').each(function(){
						var ob = $(this);
						ob.val(ob.data('origin'));
					});
				}
			});
			$('#credentialUpdate').on('click',function(){
				var param = $.extend({},gParam);
				param.newPassword  = $('#credential').val();
				
			    $a.popup({
			        url: "/zdb02/zdb0200p01",
			        data:gParam,
			        iframe: false,
			        width: 500,
			        height: 300,
			        title : '',
			        callback : function(res){
			        	if(res == "Y"){
			        		$('#zdbServiceTabs').setTabByContent('#tabService');
			        	};
			        }
			    });
			});
			$('#portUpdate').on('click',function(){
				if(!formService.validate())return;
				gCommon.credentialConfirm({
			        data:{credential:$("#credential").val(),msg:'port를 변경 하시려면',okBtnMsg:'변경'},
			        callback : function(res){
						$a.ajax({
							url: '/zdbapi/changePort',
							method:'PUT',
							data:$.extend({},gParam,{port:$('#port').val()}),
							success: function(res){
								gCommon.alert('포트가 변경 되었습니다.');
							}
						})
			        }
			    });	
			});
			var isSlowLogHidden = gParam.serviceType != G_SERVICE_TYPE_MARIA;
			
			$('#gridResource').alopexGrid({
				enableDefaultContextMenu:false,
				enableContextMenu:true,
				autoColumnIndex: true,
				autoResize:true,
				fitTableWidth :true,
				height: 400,
				contextMenu : [
					{
						title: "START" ,
						processor: function(data, $cell, grid) {
							gCommon.credentialConfirm({
						        data:{credential:$("#credential").val(), msg:'서비스 시작 하시려면', okBtnMsg:'서비스 시작'},
						        callback : function(res){
									$a.ajax({
										url: '/zdbapi/serviceOn',
										method:'PUT', data:($.extend({},gParam,{stsName:data.name})),
										success: function(res){
											console.log(res)
											if(res.result.code == '4'){
												gCommon.alert(res.result.message);
											}else{
												gCommon.alert('잠시후 서비스가 시작됩니다.');
											}
										}
									})
						        }
						    });
						},
						use: function(data, $cell, grid) {
							return data.status == 'red';
						}
					},
					{
						title: "Shutdown" ,
						processor: function(data, $cell, grid) {
							gCommon.credentialConfirm({
						        data:{credential:$("#credential").val(), msg:'서비스를 종료 하시려면', okBtnMsg:'서비스 종료'},
						        callback : function(res){
									$a.ajax({
										url: '/zdbapi/serviceOff',
										method:'PUT', data:($.extend({},gParam,{stsName:data.stName})),
										success: function(res){
											console.log(res)
											if(res.result.code == '4'){
												gCommon.alert(res.result.message);
											}else{
												gCommon.alert('잠시후 서비스가 종료됩니다.');
											}
										}
									})
						        }
						    });
						},
						use: function(data, $cell, grid) {
							return data.status == 'green';
						}
					}
				],
				columnMapping : [
					{ title:'', key : 'status' , width: '40px', align: 'center',render : function( value, data, render, mapping) {
						var re = '';
						if(data.status == 'green'){
							re = '<button class="Button btn-ico btn-config__save" title=""></button>';
						}else if(data.status == 'red'){
							re = '<button class="btn-ico del" title=""></button>';
						}
						return re;
					}},
					{ title:'Name', key : 'name', width : '300px', align: 'left', colspanTo : function(value, data, mapping) {
						if(data.colspanCol){
							return isSlowLogHidden ? 'log' : 'slowLog';
						};
					},render: function(value,data){
						var re = '';
						if (data.colspanCol == true) {
							re = '<span class="warn-text"> Message : '+data.condition.reason+":"+data.condition.message+'</span>';
						}else{
							re = (data.isPod?'':'')+value;
						};
						return re;
					}},
					{ title:'Replicas', key : 'replicas' , width: '65px', align: 'center'},
					{ title:'Role', key : 'role' , width: '90px', align: 'center'},
					{ title:'Service LB', key : '' , width: '100px', align: 'center', render : function(value, data){
						if(data.svc != '') {
							if(data.serviceType == 'redis') {
								return data.svc.spec.selector.role;
							} else if(data.serviceType == 'mariadb') {
								return data.svc.spec.selector.component;
							}
						} 
						return '';
					}},
					{ title:'Node', key : 'node' , width: '130px', align: 'center'},
					{ title:'CPU(m)', key : 'cpu' , width: '120px', align: 'center'},
					{ title:'Memory(Mi)', key : 'memory' , width: '120px', align: 'center'},
					{ title:'Disk(Gi)', key : 'disk' , width: '140px', align: 'center',tooltip : function(value, data, mapping){
						if(data.diskUpdateTime){
							var isValid = moment(data.diskUpdateTime,'YYYYMMDDHHmmss').isValid();
							return 'Update Time : '+moment(data.diskUpdateTime,'YYYYMMDDHHmmss').format('YYYY-MM-DD HH:mm:ss');
						};
					}},
					{ title:'Last Uptime', key : 'lastTransitionTime' , width: '150px', align: 'center', render: function(value,data){
						var lt = data.condition? data.condition.lastTransitionTime : '';
						if(lt){
							var isValid = moment(lt).isValid(); 
							return moment(lt).format('YYYY-MM-DD HH:mm:ss');
						}
					}}, 
					{ title:'Restart',key:'restart',width:'60px', align: 'center',hidden:(!gIsAdmin),render: function( value, data, render, mapping){
						if(!data.isPod)return'';
						var re = $('<button class="btn-ico btn-refresh">재시작</button>').on('click',function(){
							fn_restartPod(data);
						});
						return re;
					}},
					{ title:'Log',key:'log',width:'50px', align: 'center',render: function( value, data, render, mapping){
						if(!data.isPod)return'';
						var re = $('<button class="btn-ico btn-log">로그</button>').on('click',function(){
							if(data.condition && data.condition.status == 'True'){
								window.open("/zdb02/zdb0200p02?namespace="+gService.namespace+"&serviceName="+gService.serviceName+"&podname="+data.name);
							}else{
								gCommon.alert('서비스 이용이 가능할 때 조회할 수 있습니다');
							}
						});
						return re;
					}},
					{ title:'Slow Log',key:'slowLog',width:'80px', align: 'center',render: function( value, data, render, mapping){
						if(!data.isPod)return'';
						var re = $('<button class="btn-ico btn-log">로그</button>').on('click',function(){
							if(data.condition && data.condition.status == 'True'){
								window.open("/zdb02/zdb0200p04?namespace="+gService.namespace+"&serviceName="+gService.serviceName+"&podname="+data.name);
							}else{
								gCommon.alert('서비스 이용이 가능할 때 조회할 수 있습니다');
							}
						});
						return re;
					},hidden:isSlowLogHidden}
				],
			});
			
			function fn_restartPod(data){
			    $a.popup({
			        url: "/zdb02/zdb0200p03",
			        data:{credential:$("#credential").val(),msg:'재시작 하시려면',okBtnMsg:'재시작'},
			        iframe: false,
			        width: 500,
			        height: 300,
			        movable:true,
			        title : '',
			        callback : function(res){
			        	if(res == "Y"){
							var param = {
									serviceType:gService.serviceType,
									namespace:gService.namespace,
									serviceName:gService.serviceName,
									podName:data.name
							}
							$a.ajax({
								url: '/zdbapi/restartPod',
								data:param,
								success: function(res){
									if(res.result.code=='4'){
										gCommon.alert(res.result.message);
										return;
									};
									gCommon.alert('재시작 요청 하였습니다.');
								}
							});
			        	};
			        }
			    });				
			}
			function fn_viewLog(data){
				window.open("/zdb02/zdb0200p02?namespace="+gService.namespace+"&serviceName="+gService.serviceName+"&podname="+data.name);
			}
			//서비스 정보 조회
			function fn_getServiceFirst(){
				var deferred = $.Deferred();
				$a.ajax({
					url: '/zdbapi/getServiceoverview',
					data:gParam,
					success: function(res){
						if(!res.serviceoverview){
							console.log('no data');
							return;
						};
						var service = gfn_convertServiceData(res.serviceoverview);
						gCurrentNamespace = service.namespace;
						gService = service;
						gTagList = service.tags;
						fn_displayService();
						fn_getServiceCallback();

						fn_getService();
					},complete:function(res){
						deferred.resolve(res.responseJSON);
					}
				});
				return deferred.promise();
			};
			//서비스 정보 조회
			var gClient = null;
			function fn_getService(){
				if(gClient!= null)return;
				var gClient = gZdbsocket.getConnect();
				gClient.connect({}, function(frame){
					gClient.subscribe('/service/'+gService.serviceName, function(res) {
						var re = JSON.parse(res.body);
						var service = gfn_convertServiceData(re.result.serviceoverview);
						gCurrentNamespace = service.namespace;
						gService = service;
						gTagList = service.tags;
						fn_displayService();
						fn_getServiceCallback();
					});
				});
			}
			function fn_getConnectionInfo(){
				$a.ajax({
					url: '/zdbapi/getConnectionInfo',
					data:gParam,
					success: function(res){
						var connectionInfo = res.connectionInfo || {};
						connectionInfo.credential = atob(connectionInfo.credetial);
						connectionList = connectionInfo.connectionList;
						
						$('#connectionInfoTable').zdbui_setContents(connectionInfo);
						if(connectionList && connectionList.length>0){
							for(var i=0; i < connectionList.length ;i++){
								var ob = connectionList[i];
								$('input[name='+ob.connectionType+ob.role+'ConnectionString]').val(ob.connectionString).attr('data-origin',ob.connectionString);
								$('input[name='+ob.connectionType+ob.role+'ConnectionLine]').val(ob.connectionLine).attr('data-origin',ob.connectionLine);
							};
						};

						if(gConfigData.public_network_enabled == 'false'){
							$('tbody.publicNetworkTbody').hide();
						}else if(gService.publicEnabled != true){
							$('.publicConnectionInfo').hide();
							$('.publicConnectionInfoNone').show();
						}else{
							$('.publicConnectionInfo').show();
							$('.publicConnectionInfoNone').hide();
						};
						
						if(gService.clusterEnabled != true){
							$('#connectionInfoTable').find('tr.slaveConnection').hide();
							$('#connectionInfoTable').find('th[rowspan]').attr('rowspan',1);
						}else{
							$('#connectionInfoTable').find('th[rowspan]').attr('rowspan',2);
						};
					}
				});
			};

			function fn_getServiceCallback(){
				if(gService.status != 'green'){
					let infoMsg = $('#divInfoMsg');
					let msg = gService.statusMessage||'';
					let t = $('<div class="Tooltip"></div>').html(msg);
					infoMsg.after(t);
					$a.convert(t);
					let m = msg.split('</br>');
					if(m && m.length > 1){
						msg = m[0]+'</br>'+m[1];
					}
					infoMsg.html(msg);
				}
				//service 상태가 GREEN이 아니면 탭이동 불가(스케일, 백업, 사용자, 환경설정)설정
				var tabDisList = ['tabScale','tabBackup','tabUser','tabSystem']; 
				if(gService.serviceType == G_SERVICE_TYPE_MARIA){ //mariadb 면 tabSystem 이동되도록
					tabDisList.splice(tabDisList.indexOf('tabSystem'),1);
				};
				var isStatusGreen = gService.status == 'green'; 
				for(var ti = 0; ti < $('#zdbServiceTabs').getLength(); ti++ ){
					if(isStatusGreen || tabDisList.indexOf($('#zdbServiceTabs').getTabContentByIndex(ti).id) < 0){
						$('#zdbServiceTabs').setEnabled(true,ti);
					}else{
						$('#zdbServiceTabs').setEnabled(false,ti);
					}
				};
				//service 상태가 green이 아니고 현재 탭이 disable탭에 속하면 서비스 탭으로 이동
				if(!isStatusGreen && tabDisList.indexOf($('#zdbServiceTabs').getCurrentTabContent().replace('#','')) > 0){  
					$('#zdbServiceTabs').setTabByContent('#tabService');
				};
				 //redis - user탭 삭제, purpose - data가 아니면 백업탭 삭제, 환경설정의 AdvancedConfig 숨김
				if(gService.serviceType == G_SERVICE_TYPE_REDIS){
					
					let delTab = ['tabUser'];
					if(gService.purpose != 'DATA'){
						$('#tabSystem #divAdvancedConfig').hide();
						delTab.push('tabBackup');
					};
					for(var ti = 0; ti < $('#zdbServiceTabs').getLength(); ti++ ){
						if(delTab.indexOf($('#zdbServiceTabs').getTabContentByIndex(ti).id) > -1){
							$('#zdbServiceTabs').removeTab(ti);
						};
					};
					
					if(gService.clusterEnabled != true){
						$('li#divScaleOut').hide();
					};
				};
				
				var rsSpec = gCommon.getObjectByIdx(gService.resourceSpecOfPodMap,0)||{};
				var psSpec = gCommon.getObjectByIdx(gService.persistenceSpecOfPodMap,0)||{};
				var pvSpec = gCommon.getObjectByIdx(gService.persistentVolumeClaims,0)||{};
				gServiceScale.cpu = rsSpec.cpu;
				gServiceScale.memory = rsSpec.memory;
				gServiceScale.cpuVal = cloudUtil.parseInt(gServiceScale.cpu);
				gServiceScale.memoryVal = cloudUtil.parseInt(gServiceScale.memory);
				gServiceScale.disk = psSpec.size;
				gServiceScale.storageClass = '';
				if(pvSpec.spec){
					gServiceScale.storageClass = gStorageClassConstants[pvSpec.spec.storageClassName];
				}
				
				$('#configInfo').zdbui_setContents(
						{ cpu:gServiceScale.cpu
						 ,memory:gServiceScale.memory
						 ,disk:gService.persistentVolumeClaims.length==0?'사용안함':gServiceScale.disk
						 ,storageClass:gServiceScale.storageClass
						}
					);
				var podData = (function(){
					var list = [];					
					var pods = gService.pods;
					for(var i = 0 ; i < pods.length; i++){
						var pod = pods[i];
						var condition = gfn_getReadyCondition(pod);
						var role = ""; 
						if(gService.serviceType == 'redis'){
							if(pod.metadata.labels.role == "metrics")continue;
							else if(pod.metadata.labels.role == 'slave'){
								role = 'slave(readOnly)'; 
							}else{
								role = pod.metadata.labels.role;
							}
						}else{
							role = pod.metadata.labels.component;
						};
						list.push({
							isPod:true,
							name: pod.metadata.name,
							condition: condition,
							node: pod.spec.nodeName,
							colspanCol: false,
							stName: pod.metadata.name.replace(/(\-[\d]+)/g,'')
						});	
					}
					return list; 
				}());
				
				//cpu,memory,disk resource 셋팅  
				podData = (function(data){
					var list = [];
					for(var i = 0 ; i < data.length;i++){
						var ob = data[i];
						try{
							var cl = gService.cpuUsageOfPodMap;
							var ml = gService.memoryUsageOfPodMap;
							var dl = gService.diskUsageOfPodMap;
							if(cl && cl[ob.name]){
								var cpuUsage = cl[ob.name];
								ob.cpu = (cpuUsage.length ? cpuUsage[cpuUsage.length-1].value:'') / 1000 + ' / ' + gService.resourceSpecOfPodMap[ob.name].cpu;
							};
							if(ml && ml[ob.name]){
								var memUsage = ml[ob.name];
								ob.memory = cloudUtil.truncDecimal(((memUsage.length? memUsage[memUsage.length-1].value:'') / (1024*1000)),2) + ' / ' + gService.resourceSpecOfPodMap[ob.name].memory;
							};
							if(gService.serviceType == 'redis' && (ob.role != 'master' || gService.persistentVolumeClaims.length == 0)){
								ob.disk = '사용안함';
							}else if(dl && dl[ob.name]){
								var hasUseRate = dl[ob.name].useRate?true:false;
								ob.disk = cloudUtil.truncDecimal((dl[ob.name].used / (1024*1000)),2) + ' / ' + (hasUseRate? cloudUtil.convertSize(dl[ob.name].size) :(gServiceScale.disk||'N/A')) 
								        + (hasUseRate? ' ('+dl[ob.name].useRate+')' : '' ) ;
								ob.diskUpdateTime = dl[ob.name].updateTime; 
							};
						}catch(e){ 
							
						}
						list.push(ob);
					};
					return list;
				}(podData));
				//error row 임의 생성
				var tList = [];
				
				var services = gService.services;
				var statefulSets = gService.statefulSets;
				
				for(var i = 0 ; i < statefulSets.length; i++){
					var statefulSet = statefulSets[i];
					var replicas = statefulSet.spec.replicas;
					var role = ""; 
					var svc = "";
					if(gService.serviceType == 'redis'){
						if(statefulSet.metadata.labels.role == "metrics")continue;
						else if(statefulSet.metadata.labels.role == 'slave'){
							role = 'slave(readOnly)'; 
						}else{
							role = statefulSet.spec.selector.matchLabels.role;
						}
					}else{
						role = statefulSet.metadata.labels.component;
					};		

					for(var j = 0 ; j < services.length; j++){
						var service = services[j];
						var svc_role = '';
						if(gService.serviceType == 'redis'){
							if( service.metadata.name.endsWith('master') ) {
								svc_role = 'master';
							} else if( service.metadata.name.endsWith('slave') ) {
								svc_role = 'slave';
							}
						} else if(gService.serviceType == 'mariadb'){
							svc_role = service.metadata.labels.component
						}
						
						if(role == svc_role) {
							svc = service;
							break;
						}
					}
					
					var pod = null;
					var dt = {
							isPod:false,
							status: (replicas > 0 && replicas == statefulSet.status.readyReplicas ? 'green' : 'red'),
							name:statefulSet.metadata.name,
							replicas:replicas,
							role: role,
							svc: svc,
							serviceType: gService.serviceType,
							cpu:gServiceScale.cpu,
							memory:gServiceScale.memory,
							colspanCol:false
						};

					if(dt.status == 'green') {
						pod = gCommon.findObjectByKeyOb(podData,{stName:dt.name});
					}
					
					if(pod != null){
						pod.status = dt.status;
						pod.role = dt.role;
						pod.svc = dt.svc;
						pod.replicas=dt.replicas;
						pod.serviceType = gService.serviceType;
						tList.push(pod);
						if(pod.condition && pod.condition.status != 'True'){ 
							var tPod = $.extend({},pod,{colspanCol:true})
							tList.push(tPod);
						};
					} else {
						tList.push(dt);
					}
				};
				let deployments = gService.deployments;
				let isMasterRed = false;
				for(var i = 0 ; i < deployments.length; i++){
					var deployment = deployments[i];
					var replicas = deployment.spec.replicas;
					var role = ""; 
					var svc = "";
					if(gService.serviceType == 'redis'){
						if(deployment.metadata.labels.role == "metrics")continue;
						else if(deployment.metadata.labels.role == 'slave'){
							role = 'slave(readOnly)'; 
						}else{
							role = deployment.spec.selector.matchLabels.role;
						}
					}		

					for(var j = 0 ; j < services.length; j++){
						var service = services[j];
						var svc_role = '';
						if(gService.serviceType == 'redis'){
							if( service.metadata.name.endsWith('master') ) {
								svc_role = 'master';
							} else if( service.metadata.name.endsWith('slave') ) {
								svc_role = 'slave';
							}
						} 
						
						if(role == svc_role) {
							svc = service;
							break;
						}
					}
					
					var pod = null;
					var dt = {
							isPod: false,
							status: (replicas > 0 && replicas == deployment.status.readyReplicas ? 'green' : 'red'),
							name: deployment.metadata.name,
							replicas: replicas,
							role: role,
							svc: svc,
							serviceType: gService.serviceType,
							cpu: gServiceScale.cpu,
							memory: gServiceScale.memory,
							colspanCol:false
						};

					if(dt.status == 'green') {
						for(var k = 0 ; k < podData.length; k++){
							var p = podData[k];
							if(p.name.startsWith(dt.name)) {
								pod = p;
								break;
							}
						}
					}
					
					if(dt.status == 'red' && svc == 'master'){
						isMasterRed = true;
					}
					
					if(pod != null){
						pod.status = dt.status;
						pod.role = dt.role;
						pod.svc = dt.svc;
						pod.replicas=dt.replicas;
						pod.serviceType = gService.serviceType;
						tList.push(pod);
						if(pod.condition && pod.condition.status != 'True'){ 
							var tPod = $.extend({},pod,{colspanCol:true})
							tList.push(tPod);
						};
					} else {
						tList.push(dt);
					}
				};
				$('#gridResource').alopexGrid('dataSet',tList);//dataset
				//auto failover 설정
				if(gParam.serviceType == G_SERVICE_TYPE_MARIA && gConfigData.auto_failover_enabled=='true' && gService.statefulSets.length > 1){
					setOnOffButton('failOverEnable',(gService.failoverEnabled==true?'Y':'N'));
					$('#divFailover').show();
					if(isMasterRed){
						$('#divFailoverArea').show();
						$a.ajax({
							url:'/zdbapi/serviceFailOverStatus',
							method:'get',
							data:gParam,
							success:function(res){
								if(res.result.status == 'MasterToMaster'){
									$('#divFailoverBtn').show();
									$('#divFailbackBtn').hide();
								}else{
									$('#divFailoverBtn').hide();
									$('#divFailbackBtn').show();
								}							
							}
						});
					}
				}else{
					$('#divFailover').hide();
				}
				//tabService end
				
				//tabScale 스케일
				if($('#zdbServiceTabs').getCurrentTabContent()!= '#tabScale'){
					fn_setSlider('memory',gServiceScale.memoryVal);
					$('#tabScale').find('input[name="scaleCpu"]').val(gServiceScale.cpuVal);
					$('#tabScale').find('input[name="scaleMemory"]').val(gServiceScale.memoryVal);
					$('#clusterSlaveCount').val(gService.clusterSlaveCount);
					//todo temp
					var isCustom = gSliderConstants[gParam.serviceType].cpu.value.indexOf(gServiceScale.cpuVal) < 0
								 ||gSliderConstants[gParam.serviceType].memory.value.indexOf(gServiceScale.memoryVal) < 0;
					if(isCustom){
						$('#tabScale input[name=scaleType][value=custom]').trigger('click');
					}else{
						$('#tabScale input[name=scaleType][value=progress]').trigger('click');
					};
					
					//setScaleButton();
				}
			}
			//서비스 display
			function fn_displayService(){
				var ob = gService;
				var serviceDiv = $('#divService');
				
				serviceDiv.html('');
				serviceDiv.html(gfn_getServiceDetailTemplate({
					namespace:ob.namespace,
					serviceType:ob.serviceType,
					serviceName:ob.serviceName,
					status:ob.status.toLowerCase(),
					statusMessage:ob.statusMessage||'',
					version:ob.version,
					crtTime:ob.crtTime,
					elapsedTime:ob.elapsedTime,
					tagList:ob.tags
				}));
			};
			
			$('#connectionInfoTable').find(':radio[name^=con]').on('change',function(){
				$(this).parent().parent().parent().find('div.info-input__wrap').hide().filter('div.'+$(this).val()).show();
			});
			$(document).on('click','.connectionStringCopy,.connectionLineCopy,#credentialCopy',function(e){
				var target = e.target.id == "credentialCopy" ? $('#credential') : $(this).prev();
				var msg = '';
				if(target.val() == ''){
					msg = '복사할 내용이 없습니다.';	
				}else{
					gCommon.copyToClipboard(target);
					if(target.get(0).id == 'credential'){
						msg = 'Credential이 복사되었습니다';
					}else if(target.get(0).name.indexOf('ConnectionString')>-1){
					    msg = 'Connection String이 복사되었습니다.';
					}else{
					    msg = 'Connection Line이 복사되었습니다.';
					}
				}
				var ob = $(this).parent().parent().find(".connectionInfoCopyed").html(msg).show();
				setTimeout(function(){
					ob.hide(1000);
				},1000);
			})			
			tabService.find('#publicNetworkDelete').on('click',function(){
				if(gCommon.confirm('Public Network 서비스 삭제시 </br> 외부연동이 단절됩니다. <br/> 삭제하시겠습니까?',function(){
					$a.ajax({
						url: '/zdbapi/deletePublicService',
						data:gService,
						success: function(res){
							fn_getServiceFirst().done(function(){
								fn_getConnectionInfo(); 
							});
						}
					});
				},{okBtnMsg:"삭제"}));
			});
			tabService.find('#publicNetworkCreate').on('click',function(){
				if(gCommon.confirm('Public Network를 추가 하시겠습니까?',function(){
					$a.ajax({
						url: '/zdbapi/createPublicService',
						data:gService,
						success: function(res){
							fn_getServiceFirst().done(function(){
								fn_getConnectionInfo(); 
							}); 
						}
					});
				},{okBtnMsg:"추가"}));
			});
			tabService.find('.onoff-wrap > button').click(function(e){
				e.preventDefault();
				let isEnable = 'Y';
				if($(this).hasClass('btn-on')) {
					isEnable = 'N';
				};				
				let param = $.extend({},gParam,{enable:isEnable == 'Y'});
				gCommon.credentialConfirm({
			        data:{credential:$("#credential").val(), msg:'설정을 변경하시려면', okBtnMsg:'변경'},
			        callback : function(res){
						$a.ajax({
							url: '/zdbapi/updateAutoFailoverEnable',
							method:'PUT',
							data:param,
							success: function(res){
								if(res.result.code == '4'){
									gCommon.alert(res.result.message);
								}else{
									gCommon.alert('설정이 변경 되었습니다.');
									if($(this).hasClass('btn-on')) {
										setOnOffButton('failOverEnable','N');
									} else {
										setOnOffButton('failOverEnable','Y');
									}
									gConfigData = gCommon.getConfigData();
								}
							}
						})
			        }
			    });		
			});
			tabService.find('#divFailoverBtn button').on('click',function(e){
				e.preventDefault();
				gCommon.credentialConfirm({
					data:{credential:$("#credential").val(), msg:'failover 수행을 하시려면', okBtnMsg:'변경'},
					callback : function(res){
						$a.ajax({
							url: '/zdbapi/serviceChangeMasterToSlave',
							method:'PUT',
							data:gParam,
							success: function(res){
								if(res.result.code == '4'){
									gCommon.alert(res.result.message);
								}else{
									gCommon.alert('설정이 변경 되었습니다.');
								}
							}
						})	
					}
				});
			})
			/*tabService end*/
			
			/*tabScale start 스케일 */
			var memorySlider = document.getElementById('memorySlider');
			var sliderConstants = gSliderConstants[gParam.serviceType];
			noUiSlider.create(memorySlider, {
				start:[1],
				snap: true,
				connect: [true,false],
				range: sliderConstants.memory.range,
				pips: {
					mode: 'steps',
					density: 100,
					format: {
					  to: function ( value ) {
					      return sliderConstants.memory.getValue(value);
					  },
					  from: function ( value ) {
					      return value;
					  }
					}
				}
			}).on('slide', function ( values, handle ) {
				fn_setSliderText('memory',parseInt(values[handle]));
			});
			//set슬라이더 값 
			function fn_setSlider(type,value){
				var slider = $('#'+type+'Slider')[0];
				var idx = sliderConstants[type].getIndex(value);
				
				slider.noUiSlider.set(idx);
				fn_setSliderText(type,idx)
			};
			//set슬라이더 값 텍스트
			function fn_setSliderText(type,idx){
				$('#'+type+'Info').html(sliderConstants[type].getValue(idx));
				setScaleButton();
			};
			
			$('#updateScaleUp').on('click',function(){
				if($(this).hasClass('Disabled'))return;
				
				if(gCommon.confirm('Scale Up/Down이 수행되면 서비스가 재시작됩니다. 계속 진행하시겠습니까?',function(){
					var data = $.extend({},gParam,{});
					var scaleType = $('#tabScale').find('input[name=scaleType]:checked').val();
					if(scaleType == 'custom'){
						data.cpu = cloudUtil.parseInt($('#tabScale').find('input[name=scaleCpu]').val());
						data.memory = cloudUtil.parseInt($('#tabScale').find('input[name=scaleMemory]').val());
					}else if(scaleType == 'progress'){
						data.cpu = gSliderConstants[gParam.serviceType].cpu.value[parseInt(memorySlider.noUiSlider.get())],
						data.memory = gSliderConstants[gParam.serviceType].memory.value[parseInt(memorySlider.noUiSlider.get())]
					};
					$a.ajax({
						url: '/zdbapi/updateScaleUp',
						data:data,
						success: function(res){
							if(res.result.code=='4'){
								gCommon.alert(res.result.message);
								return;
							};
							gCommon.alert('스케일 정보를 수정 요청 하였습니다.',function(){
								$('#zdbServiceTabs').setTabByContent('#tabService');
								fn_getServiceFirst(); 
							});
						}
					});
				}));
			});
			$('#updateScaleOut').on('click',function(){
				if($(this).hasClass('Disabled'))return;
				if(gCommon.confirm('Slave 갯수를 '+$('input[name=clusterSlaveCount]').val()+' 개로 변경하시겠습니까?',function(){
					var data = $.extend({},gParam,{
						clusterSlaveCount:$('input[name=clusterSlaveCount]').val()
					});
					$a.ajax({
						url: '/zdbapi/updateScaleOut',
						data:data,
						success: function(res){
							if(res.result.code=='4'){
								gCommon.alert(res.result.message);
								return;
							};
							gCommon.alert('스케일 정보를 수정 요청 하였습니다.',function(){
								//fn_getService();
							});
						}
					});
				}));
			});
			
			//레디스 경우 최대 노드 카운트를 가져온다
			if(gParam.serviceType == G_SERVICE_TYPE_REDIS){
				$a.ajax({
					url: '/zdbapi/getNodeCount',
					data:data,
					success: function(res){
						$('#clusterSlaveCount').attr('max',res.nodes);
					}
				});				
			};
			
			$('#tabScale').find('input[type=text]').on('input',function(evt){
				setScaleButton();
			});
			$('#clusterSlaveCountSpinner').find('.Up,.Down').on('click',function(evt){
				setScaleButton();
			});
			//스케일 적용 버튼 활성 비활성
			function setScaleButton(){
				var chgData = {};
				var scaleType = $('#tabScale').find('input[name=scaleType]:checked').val();
				if(scaleType == 'custom'){
					chgData.cpu = cloudUtil.parseInt($('#tabScale').find('input[name=scaleCpu]').val());
					chgData.memory = cloudUtil.parseInt($('#tabScale').find('input[name=scaleMemory]').val());
				}else if(scaleType == 'progress'){
					chgData.cpu = gSliderConstants[gParam.serviceType].cpu.value[parseInt(memorySlider.noUiSlider.get())],
					chgData.memory = gSliderConstants[gParam.serviceType].memory.value[parseInt(memorySlider.noUiSlider.get())]
				};
				
				var isChange = gServiceScale.memoryVal != chgData.memory || gServiceScale.cpuVal != chgData.cpu ;
				
				if((scaleType == 'custom' && !$('form[name=scaleForm]').validate()) || !isChange || chgData.memory < 1){
					$('#updateScaleUp').addClass('Disabled');	
				}else{
					$('#updateScaleUp').removeClass('Disabled');
				};
				
				if($('#updateScaleOut').size()>0){
					var orgSlaveCount = gService.clusterSlaveCount;
					var chgSlaveCount = $('input[name=clusterSlaveCount]').val();
					
					if(orgSlaveCount == chgSlaveCount || chgSlaveCount < 1){
						$('#updateScaleOut').addClass('Disabled');	
					}else{
						$('#updateScaleOut').removeClass('Disabled');
					};
				}
			};
			$('#tabScale input:radio[name=scaleType]').on('change',function(){
				setDivScale(this.value);
				setScaleButton();
			});
			$('form[name=scaleForm]').validator({
			    elements :{ 
			        'scaleCpu': {rule:{required:true,min:100,max:20000}},
			        'scaleMemory': {rule:{required:true,min:128,max:32000}}
			    }
			});	
			//스케일 리소스선택or사용자입력
			function setDivScale(scaleType){
				$('#tabScale').find('#divScaleProgress,#divScaleCustom').hide();
				if(scaleType == 'custom'){
					$('#tabScale').find('#divScaleCustom').show();
				}else{
					$('#tabScale').find('#divScaleProgress').show();
				}
			}
			/*tabScale end 스케일*/

			/*tabMonitor start 모니터링*/
			function fn_getMonitoring(){
				fn_getPanels(gService);
			};
			function fn_getPanels(service){
				if(service.serviceType == "mariadb") {
					$('#advancedMonitoring').attr('href', gGrafanaUrl + "/d/zdbmaria1/mariadb-advanced?refresh=1m&orgId=1"
							+ "&var-user=" + gUserId
							+ "&var-namespace=" + service.namespace
							+ "&var-mariadbservice=" + service.serviceName + "-mariadb");
					var iframeSrc = gGrafanaUrl + "/d-solo/zdbmaria2/mariadb-summary?refresh=1m&orgId=1"
						+ "&var-namespace=" + service.namespace 
						+ "&var-service=" + service.serviceName + "-mariadb";
					/* System Resources */
					$('#panelCpu').find('iframe').attr('src',iframeSrc + "&panelId=1");
					$('#panelMemory').find('iframe').attr('src',iframeSrc + "&panelId=2");
					$('#panelNetwork').find('iframe').attr('src',iframeSrc + "&panelId=3");					
					/* Connection & Table */
					$('#panelConnections').find('iframe').attr('src',iframeSrc + "&panelId=4");					
					$('#panelThread').find('iframe').attr('src',iframeSrc + "&panelId=5");					
					$('#panelTablelack').find('iframe').attr('src',iframeSrc + "&panelId=6");					
					/* Query & Replication */
					$('#panelQps').find('iframe').attr('src',iframeSrc + "&panelId=7");
					$('#panelReplicationdelay').find('iframe').attr('src',iframeSrc + "&panelId=8");
					$('#panelSqlthread').find('iframe').attr('src',iframeSrc + "&panelId=9");
					$('#panelIothread').find('iframe').attr('src',iframeSrc + "&panelId=10");
				} else if (service.serviceType == "redis") {
					$('#advancedMonitoring').attr('href', gGrafanaUrl + "/d/zdbredis1/redis-advanced?refresh=1m&orgId=1"
							+ "&var-user=" + gUserId
							+ "&var-namespace=" + service.namespace
							+ "&var-redisservice=" + service.pods[0].spec.containers[0].name + "-master");
					var iframeSrc = gGrafanaUrl + "/d-solo/zdbredis2/redis-summary?refresh=1m&orgId=1"
						+ "&var-namespace=" + service.namespace 
						+ "&var-service=" + service.pods[0].spec.containers[0].name + "-master"
						+ "&var-container=" + service.pods[0].spec.containers[0].name;
					/* System Resources */
					$('#panelCpu').find('iframe').attr('src',iframeSrc + "&panelId=1");
					$('#panelMemory').find('iframe').attr('src',iframeSrc + "&panelId=2");
					$('#panelNetwork').find('iframe').attr('src',iframeSrc + "&panelId=3");
					/* Keys */
					$('#panelItems').find('iframe').attr('src',iframeSrc + "&panelId=4");
					$('#panelExpiringvsnot').find('iframe').attr('src',iframeSrc + "&panelId=5");
					$('#panelExpired').find('iframe').attr('src',iframeSrc + "&panelId=6");
					/* Commands */
					$('#panelExecuted').find('iframe').attr('src',iframeSrc + "&panelId=7");
					$('#panelHits').find('iframe').attr('src',iframeSrc + "&panelId=8");
					$('#panelCalls').find('iframe').attr('src',iframeSrc + "&panelId=9");
				}
				else {
					// TODO
				}
			}
			/*tabMonitor end 모니터링*/
			
			/* tabBackup start backup */
			let backupForm = $('form[name=backupForm]');
			let backupStatus = 'N';//Y 수정가능상태, N 수정불가 상태, I 수정중상태
			backupForm.find('#searchBackup').on('click',function(){
				fn_getBackupInfo();
			});
			backupForm.find('#backupSearchType').on('change',function(e){
				fn_filterBackupInfo();
			});
			backupForm.find('.onoff-wrap > button').click(function(e){
				e.preventDefault();
				if($(this).hasClass('btn-on')) {
					setBackupUseYnEvt('N');
				} else {
					setBackupUseYnEvt('Y');
				}
			});
			function setBackupUseYnEvt(val){
				var msg = val == 'Y'? '백업 설정을 활성화 하시겠습니까?': '백업 설정을 비활성화 하시겠습니까?';
				gCommon.confirm(msg,function(yn){
					if(yn == 'Y'){
						setOnOffButton('useYn',val);
						fn_saveSchedule();				
					};
				});
			}
			function setOnOffButton(name,bOn){
				$('select[name='+name+']').zdbui_setComponent(bOn);	
				if(bOn == 'Y'){
					$('button[data-target='+name+']').removeClass('btn-off').addClass('btn-on').text('ON');
				}else{
					$('button[data-target='+name+']').removeClass('btn-on').addClass('btn-off').text('OFF');
				}
			}
			
			function setBackupBtnEnable(){
				if(backupStatus=='Y'){
					backupForm.find('#saveSchedule').setEnabled(true);
					backupForm.find('#saveSchedule').text('수정');
					setBackupCompEnable('N')
				}else if(backupStatus=='N'){
					backupForm.find('#saveSchedule').setEnabled(false);
					backupForm.find('#saveSchedule').text('수정');
					setBackupCompEnable('N')
				}else if(backupStatus=='I'){
					backupForm.find('#saveSchedule').setEnabled(true);
					backupForm.find('#saveSchedule').text('적용');
					setBackupCompEnable('Y')
				}
			};
			
			function setBackupCompEnable(val){
				if(val=='Y'){
					backupForm.find('#storePeriodSpinner').setEnabled(true);
					backupForm.find('#startTime').setEnabled(true);
					backupForm.find('#incrementPeriod').setEnabled(true);
				}else{
					backupForm.find('#storePeriodSpinner').setEnabled(false);
					backupForm.find('#startTime').setEnabled(false);
					backupForm.find('#incrementPeriod').setEnabled(false);
				}
			};
			$('#gridBackup').alopexGrid({
				autoColumnIndex : true,
				autoResize : true,
				fitTableWidth :true,
				height: 400,
				columnMapping : [
					{ title:'백업종류', key : 'type' , width: '100px', align: 'center',render:function(value,data,render,mapping){						
						let t = '';
						switch(value){
						    case 'INCR':
						    	t = '증분백업';
						    	break;
						    case 'FULL':
						    	t = '전체백업';
						    	break;
						    default :
						    	t = '즉시백업'
						    	break;
						}
						return '<button class="Button gridbtn btn">'+t+'</button>';
					}},
					{ title:'요청시간', key : 'acceptedDatetime' , width: '130px', align: 'center',render:function(value,data,render,mapping){
						return cloudUtil.dtFormat(value);
					}},
					{ title:'시작시간', key : 'startDatetime' , width: '160px', align: 'center',render:function(value,data,render,mapping){
						return cloudUtil.dtFormat(value);
					}},
					{ title:'완료시간', key : 'completeDatetime' , width: '160px', align: 'center',render:function(value,data,render,mapping){
						return cloudUtil.dtFormat(value);
					}},
					{ title:'삭제시간', key : 'deleteDatetime' , width: '160px', align: 'center',render:function(value,data,render,mapping){
						return cloudUtil.dtFormat(value);
					}},
					{ title:'파일사이즈', key : 'fileSize' , width: '80px', align: 'center', render:function(value,data,render,mapping){
						var val = '';
						if(value < 1024 ) {
							val = value +'B';
						} else if(value < 1024*1024 ) {
							val = cloudUtil.truncDecimal((value / 1024),2) +'Ki';
						} else if(value < 1024*1024*1024 ) {
							val = cloudUtil.truncDecimal((value / (1024*1024)),2) +'Mi';
						} else if(value < 1024*1024*1024*1024 ) {
							val = cloudUtil.truncDecimal((value / (1024*1024*1024)),2) +'Gi';
						}
						var st = data.status == 'DELETED'? 'text-decoration: line-through;': '';
						var re = '<span style="font:inherit;'+st+'">'+val+'</span>' 
						return re;
					}},
					{ title:'다운로드', key : 'archiveFileSize' , width: '90px', align: 'center',render:function(value,data,render,mapping){
						let t = cloudUtil.isEmpty(data.type)? '다운로드' : '복원';
						var re = $('<button class="Button btn-download '+(data.status != 'OK'?'Disabled':'')+'">'+t+'</button>').on('click',function(){
							fn_downloadBackupFile(data);
						});
						return re;
					}},
					{ title:'삭제', key : 'delete' , width: '90px', align: 'center',render:function(value,data,render,mapping){
						var re = $('<button class="Button btn-del '+(data.status != 'OK'?'Disabled':'')+'">삭제</button>').on('click',function(){
							fn_deleteBackupFile(data);
						});
						return re;
					}}
				],
				footer: {
					footerMapping: [
						{ columnIndex: 3, title:'백업 파일 사이즈 합계: ', align:'center'},
						{ columnIndex: 5, align:'center',render:function(value,data,render,mapping){
							var rawData = AlopexGrid.trimData(value);
							var validData = [];
							var totalValue = 0;
							for (var i in rawData) {
								if (rawData[i].status == 'OK') {
									totalValue += parseInt(rawData[i].fileSize, 10);
								};
							};
							if(totalValue < 1024 ) {
								return totalValue +'B';
							} else if(totalValue < 1024*1024 ) {
								return cloudUtil.truncDecimal((totalValue / 1024),2) +'Ki';
							} else if(totalValue < 1024*1024*1024 ) {
								return cloudUtil.truncDecimal((totalValue / (1024*1024)),2) +'Mi';
							} else if(totalValue < 1024*1024*1024*1024 ) {
								return cloudUtil.truncDecimal((totalValue / (1024*1024*1024)),2) +'Gi';
							};
						}}
					]},
				message: {
					nodata: gMessage.gridNodata
				}
			});		
			function fn_getBackupScheduleInfo(){
				var param = {
						namespace : gService.namespace,
					    serviceType : gService.serviceType,
					    serviceName : gService.serviceName
					};
				$a.ajax({
					url: '/zdbapi/getSchedule',
					data:param,
					success: function(res){
						var data = {};
						if(!res.schedule){
							data.useYn = 'N';
							data.startTime = '01:00';
							data.storePeriod = '7';
						}else{
							data = res.schedule;
						};
						backupForm.zdbui_setContents(data);
						backupStatus = data.useYn||'N';
						setOnOffButton('useYn',backupStatus);
						setBackupBtnEnable();
						backupForm.find('#startTime').setData({date :data.startTime});
					}
				});					
			};
			$('button#saveSchedule').on('click',function(){
				if(backupStatus=='I'){
					gCommon.confirm('백업 설정을 수정 하시겠습니까?',function(){
						fn_saveSchedule();				
					});
				}else if(backupStatus=='Y'){
					backupStatus = 'I';
					setBackupBtnEnable();
				}
			});
			$('body').on('click','button#updateBackup',function(){
				gCommon.confirm('백업을 실행 하시겠습니까?',function(res){
					$a.ajax({
						url: '/zdbapi/updateBackup',
						data:gParam,
						success: function(res){
							if(res.result.code=='4'){
								gCommon.alert(res.result.message);
								return;
							};
							gCommon.alert('즉시 백업을 요청하였습니다.');
							fn_getBackupInfo();
						}
					});	
				});
			});
			function fn_saveSchedule(){
				var param = $.extend({},gParam,backupForm.serializeObject());
				param.startTime = moment($('#startTime').getData().date.replace(/(AM|PM)/,''),'HH : mm').format('HH:mm');
				
				$a.ajax({
					url: '/zdbapi/updateSchedule',
					data:param,
					success: function(res){
						if(res.result.code=='4'){
							gCommon.alert(res.result.message,function(){
								fn_getBackupScheduleInfo();
							});
							return;
						};
						gCommon.alert('백업 설정이 수정되었습니다.',function(){
							fn_getBackupScheduleInfo();
						});
					}
				});	
			}
			function fn_getBackupInfo(){
				$a.ajax({
					url: '/zdbapi/getBackupList',
					data:gParam,
					success: function(res){
						var list = res.backupList;
						$('#gridBackup').alopexGrid('dataSet',list);
						fn_filterBackupInfo();
					}
				});				
			};	
			function fn_filterBackupInfo(){
				$('#gridBackup').alopexGrid('setFilter', 'backupFilter', function(data){
					if($('#backupSearchType').is(':checked') == true){
						return true;
					}else{
						return data.type != 'INCR';
					}
				});
			}
			function fn_deleteBackupFile(data){
				if(data.status!='OK')return;
				gCommon.confirm('선택한 백업을 삭제 하시겠습니까?',function(){
					var param = $.extend({},gParam,{backupId:data.backupId})
					$a.ajax({
						url: '/zdbapi/deleteBackup',
						data:param,
						success: function(res){
							if(res.result.code=='4'){
								gCommon.alert(res.result.message);
								return;
							};
							gCommon.alert('백업 삭제를 요청하였습니다.');
							fn_getBackupInfo();
						}
					});	
				})
			};
			function fn_downloadBackupFile(data){
				if(data.status!='OK')return;
				let isDownload = cloudUtil.isEmpty(data.type);
				let param = $.extend({},gParam,{backupId:data.backupId})
				if(isDownload){
					gCommon.movePage('/zdbapi/downloadBackup',param);
				}else{
					gCommon.credentialConfirm({
				        data:{credential:$("#credential").val(),
				        	  msg:'서비스를 (' + cloudUtil.dtFormat(data.acceptedDatetime) + ')시점으로 복원 하시려면',
				        	  okBtnMsg:'복원'},
				        width: 550,
				        callback : function(res){
							$a.ajax({
								url: '/zdbapi/restoreFromBackup',
								data:data,
								success: function(res){
									if(res.result.code == '4'){
										gCommon.alert(res.result.message);
									}else{
										gCommon.alert('복원 요청이 완료 되었습니다.');
									}
								}
							})
				        }
				    });					
				}
			};
			/* tabBackup end backup */
			
			/*tabEvent start 이벤트*/
			$('#gridEvent').alopexGrid({
				autoColumnIndex: true,
				autoResize:true,
				fitTableWidth :true,
				height: 400,
				renderMapping : {
					'evtMsgTooltip' : {
						renderer: function(value, data, render, mapping) {
							return '<div id="'+data._index.id+mapping.key+'" class="TooltipEvt">'+value+(data.history?'<span class="ico_title" style="padding-top:33px;"/>':'')+'</div>';
						}
					}
				},
				columnMapping : [  
					{ title:'', key : 'status' , width: '30px', align: 'center',render:function(value){
						var re = '';
						if(value == 0){
							re = '<i class="fa fa-check-circle ft20 color-success" aria-hidden="true"></i>';
						}else if(value == 4){
							re = '<i class="fa fa-times-circle ft20 color-danger" aria-hidden="true"></i>';
						}else{
							re = '<i class="fa fa-info-circle ft20 color-info" aria-hidden="true"></i>';
						}
						return re;
					}},
					{ title:'일시', key : 'endTime' , width: '140px', align: 'left',render:function(value){
						return cloudUtil.dtFormat(value);
					}},
					{ title:'이벤트', key : 'operation' , width: '100px', align: 'left'},
					{ title:'메세지', key : 'resultMessage' , width: '600px', align: 'left',tooltip:false,render: {type: "evtMsgTooltip"}},
					{ title:'User ID', key : 'userId' , width: '250px', align: 'left'}
				],
				message: {
					nodata: gMessage.gridNodata
				}
			}).on('mouseover', '.bodycell .TooltipEvt',function(e){
				var evObj = AlopexGrid.parseEvent(e);
				var data = evObj.data;
				var mapping = evObj.mapping;
				var $tooltip = $('#evtTooltip');

				if (mapping.key === 'resultMessage' && data.history!=null){
					var val = data['history']||'';
					$tooltip.html(val.replaceAll('\n','</br>')); 
					$tooltip.attr('data-base', '#'+data._index.id + mapping.key);  
					$tooltip.open();	
				}else {
					$tooltip.close();
				}
			});			
			
			$('#eventStartDate').val(moment().subtract(3, 'days').format('YYYY-MM-DD'));
			$('#eventEndDate').val(moment().format('YYYY-MM-DD'));
			$('#eventEndTime').setData({date :'23:59'});
			
			function fn_getEventInfo(){
				var param = $('form[name=eventForm]').serializeObject();
				param = $.extend({},gParam,param);
				param.startTime = moment($('#eventStartDate').val()+$('#eventStartTime').getData().date.replace(/(AM|PM)/,''),'YYYY-MM-DDHH : mm').format('YYYY-MM-DD HH:mm:ss');
				param.endTime = moment($('#eventEndDate').val()+$('#eventEndTime').getData().date.replace(/(AM|PM)/,'')+':59','YYYY-MM-DDHH : mm:ss').format('YYYY-MM-DD HH:mm:ss');
				param.keyword = param.keyword||'-';
				
				$a.ajax({
					url: '/zdbapi/getOperationEvents',
					data:param,
					success: function(res){
						var list = res.operationEvents;
						$('#gridEvent').alopexGrid('dataSet',list);
					}
				});				
			};			
			$('#searchEvent').on('click',function(){
				fn_getEventInfo();
			});
			$('input[name=keyword]').pressEnter(function(evt){
				fn_getEventInfo();
			});
			/*tabEvent end 이벤트*/
			
			/*tabSystem start 환경설정 */
			
			/*tabUser start 사용자 */
			$('#gridUser').alopexGrid({
				autoColumnIndex: true,
				autoResize:true,
				fitTableWidth :true,
				height: 400,
				columnMapping : [  
					{ title:'USER', key : 'user' , width: '100px', align: 'left'},
					{ title:'HOST', key : 'host' , width: '100px', align: 'left'},
					{ title:'SELECT', key : 'select' , width: '70px', align: 'center'},
					{ title:'INSERT', key : 'insert' , width: '70px', align: 'center'},
					{ title:'UPDATE', key : 'update' , width: '70px', align: 'center'},
					{ title:'DELETE', key : 'delete' , width: '70px', align: 'center'},
					{ title:'EXECUTE', key : 'execute' , width: '70px', align: 'center'},
					{ title:'CREATE', key : 'create' , width: '70px', align: 'center'},
					{ title:'ALTER', key : 'alter' , width: '70px', align: 'center'},
					{ title:'DROP', key : 'drop' , width: '70px', align: 'center'},
					{ title:'INDEX', key : 'index' , width: '70px', align: 'center', hidden:true},
					{ title:'CREATE VIEW', key : 'createView' , width: '70px', align: 'center'},
					{ title:'TRIGGER', key : 'trigger' , width: '70px', align: 'center'},
					{ title:'GRANT', key : 'grant' , width: '70px', align: 'center'},
					{ title:'CREATE USER', key : 'createUser' , width: '70px', align: 'center'}
				],
				message: {
					nodata: gMessage.gridNodata
				}
			});	
			function fn_getUserGrants(){
				$a.ajax({
					url: '/zdbapi/getUserGrants',
					data: gService,
					success: function(res){
						var list = res.userGrants;
						$('#gridUser').alopexGrid('dataSet',list);
					}
				});				
			};				
			/*tabUser end 사용자*/
			
			var dbConfigForm = $('form[name=dbConfig]');
			
			if(gParam.serviceType == G_SERVICE_TYPE_REDIS){
				dbConfigForm.validator({
				    elements :{ 
				        'timeout': {rule:{required:true,min:0,max:3600}}
				       ,'tcp-keepalive': {rule:{required:true,min:0,max:3600}}
				       ,'maxmemory-samples': {rule:{required:true,min:1,max:10}}
				       ,'slowlog-log-slower-than': {rule:{required:true,min:-1,max:12000}}
				       ,'slowlog-max-len': {rule:{required:true,min:1,max:256}}
				       ,'hash-max-ziplist-entries': {rule:{required:true,min:0,max:65535}}
				       ,'hash-max-ziplist-value': {rule:{required:true,min:0,max:65535}}
				       ,'list-max-ziplist-size': {rule:{required:true,min:-5,max:5}}
				       ,'zset-max-ziplist-entries': {rule:{required:true,min:0,max:65535}}
				       ,'zset-max-ziplist-value': {rule:{required:true,min:0,max:65535}}
				    }
				});				
			};

			$('#saveVariables').on('click',function(){ //시스템 변수 적용
				if(!dbConfigForm.validate()){
					return;
				};
				if(gCommon.confirm('시스템 변수를 변경하시겠습니까?</br> <span class="Color-warning">* 변경된 설정값은 서비스 재기동 후 적용 됩니다.<br>재기동을 원하시면 재시작 버튼을 실행하세요.</span>',function(){
					var param = $.extend({},gParam, dbConfigForm.serializeObject());
					$a.ajax({
						url: '/zdbapi/updateDBVariables',
						data:param,
						success: function(res){
							gCommon.alert(gMessage.saveSuccess,function(){
								$('#zdbServiceTabs').setTabByContent('#tabService');
							});
						},
						loadingMessage:'환경설정 적용중입니다.'
					});
				}));
			});
			function fn_getConfigurationInfo(){
				$a.ajax({
					url: '/zdbapi/getDBVariables',
					data:gParam,
					success: function(res){
						var dbConfigurations = res.dbConfigurations
						if(gParam.serviceType == G_SERVICE_TYPE_MARIA){
							if(dbConfigurations){
								$('#serviceConfigTable tbody').html('');
								var sels = {
									character_set_server:{options:[{key:'utf8'},{key:'euckr'},{key:'utf8mb4'},{key:'utf16'}]},
									'collation-server':{options:[{key:'utf8_general_ci'},{key:'utf8_bin'},{key:'euckr_korean_ci'},{key:'euckr_bin'}
													,{key:'utf8mb4_general_ci'},{key:'utf8mb4_bin'},{key:'utf16_general_ci'},{key:'utf16_bin'}]},
									innodb_buffer_pool_instances:{options:[{key:'1'},{key:'2'},{key:'4'},{key:'8'}]},
									innodb_flush_method:{options:[{key:'fsync'},{key:'O_DSYNC'}, {key:'O_DIRECT'} ,{key:'O_DIRECT_NO_FSYNC'}]},
									query_cache_type:{options:[{key:'0',val:'OFF'},{key:'1',val:'ON'},{key:'2',val:'DEMAND'}]},
									thread_handling:{options:[{key:'no-threads'},{key:'one-thread-per-connection'},{key:'pool-of-threads'}]},
									'transaction-isolation':{options:[{key:'READ-UNCOMMITTED'},{key:'READ-COMMITTED'}
																,{key:'REPEATABLE-READ'},{key:'SERIALIZABLE'}]}
								};
								for(var i = 0 ; i < dbConfigurations.length;i++){
									var ob = dbConfigurations[i];
									var tr = '';
									if(sels[ob.name]){
										tr = '<tr><th>'+ob.name+'</th><td><div class="Divselect" style="min-width:200px;"> <select name="'+ob.name+'" >'
										for(var j = 0 ; j < sels[ob.name].options.length; j++){
											var opts = sels[ob.name].options[j];
											tr +='<option value="'+opts.key+'" '+(ob.value==opts.key?"selected":"")+'>'+(opts.val||opts.key)+'</option>';
										};
										tr += '</select><span></span></div>'+'<span class="info-text"> '+ob.valueRange+'</span></td></tr>';
									}else{
										tr = ' <tr> <th>'+ob.name+'</th> <td>'
									       + '		<input type="text" id="'+ob.name+'" name="'+ob.name+'" class="Textinput" value="'+ob.value+'"/>'
									       + '		<span class="info-text">'+ob.valueRange+'</span> '
									       + '		<p data-for="'+ob.name+'" class="warn-text"></p>'
									       + '	</td> </tr>';
									}
									$('#serviceConfigTable tbody').append(tr);
								};
								$a.convert($('#serviceConfigTable tbody').find('.Divselect'));
								setDbConfigurationFilter();
								$('select[name=character_set_server]').on('change',function(){
									setDbConfigurationFilter();
								});
								var dt = gCommon.findObjectByKeyOb(dbConfigurations,{name:'collation-server'});
								if(dt){
									$('select[name=collation-server]').val(dt.value).parent().refresh();
								};
								function setDbConfigurationFilter(isRefresh){
									$('select[name=collation-server] option').hide().filter(function(){
										return $(this).val().indexOf($('select[name=character_set_server]').val()+'_')>-1;
									}).show().filter(':first').prop('selected',true);
									$('select[name=collation-server]').parent().refresh();
								};
							}
						}else if(gParam.serviceType == G_SERVICE_TYPE_REDIS){
							dbConfigForm.zdbui_setContents(dbConfigurations);							
						}
					}
				});
			};
			$('#popVariables').on('click',function(){
				window.open("/zdb02/zdb0200p05?namespace="+gService.namespace+"&serviceType="+gService.serviceType+"&serviceName="+gService.serviceName);
			});
			/*tabSystem end 환경설정 */
			
			//page Start
			fn_getServiceFirst().done(function(){
				var cookieTabId = $.cookie('selected2010tab')||'tabService';
				$('#zdbServiceTabs').setTabByContent('#'+cookieTabId);
			});
		};
		
	});
	function getM(){
		$a.ajax({
			url: '/zdbapi/getPodMetrics',
			method:'get',
			data:{
				namespace:gParam.namespace,
				podName:'zdb-ha-failover-mariadb-master-0'
			},
			success:function(res){
				console.log(res)
			}
		});		
	}
</script>