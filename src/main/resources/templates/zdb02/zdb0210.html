<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="layout/content_layout">
<th:block layout:fragment="page_head">
    <title>서비스 상세</title>
</th:block>
<th:block layout:fragment="page_css">
	<link rel="stylesheet" href="/styles/css/nouislider.min.css">
	<style type="text/css">
		#restartService{
			width:38px;
			height:38px;
			padding-bottom: 6px;
			border: 1px solid #cccccc;
			background-position: -25px -173px; 
		}
		.TooltipEvt{
		}
	</style>  
</th:block>
<th:block layout:fragment="page_js">
	<script type="text/javascript" th:inline="javascript">
		/*<![CDATA[*/
		var gApiServerUrl = [[${@environment.getProperty('zdb-api-server.url')}]];
		var gGrafanaUrl = [[${@environment.getProperty('grafana.url')}]];
		appMariadb = {};
		/*]]>*/
	</script>
	<script type="text/javascript" src="/script/app/common/cloudzdb-ui-z0200.js?v=20190523"></script>
	<script type="text/javascript" src="/script/libs/etc/nouislider.min.js"></script>
	<script src="/script/libs/sockjs/sockjs.js"></script>
	<script src="/script/libs/sockjs/stomp.js"></script>
	<script src="/script/app/common/cloudzdb-ui-sock.js?v=20190430"></script>	
	<script type="text/javascript" src="/script/libs/etc/download.min.js"></script>
</th:block>
<th:block layout:fragment="content">
<!-- location -->
<div class="locations-area">
	<div class="prj-list">
		<strong>Namespace : </strong>
		<button id="namespaces" class="Dropdownbutton namespace"></button>
		<ul class="dropmenu-list hide">
		</ul>
	</div>
	<div class="back-list" id="backServices">
		<a href="#"><span>목록으로 돌아가기</span></a>
	</div>
</div>
<div class="contents-box info-box">
	<!-- contents-titie-->
	<div class="top-area info-area">
		<!-- service 각 항목에 대한 상세 panel-->
		<div class="Panel service-panel" id="divService">

		</div>
		<div class="Panel service-panel">
			<div class="Panel-content">
				<div style="float: left;word-break:break-all;font-size: 14px;" id="divInfoMsg"></div>
				<div class="config-wrap" th:if="${session.userInfo.zdbAdmin}" >
					<button class="btn-ico btn-refresh" id="restartService" title="재시작">재시작 </button>
					<button class="Button btn-ico__typeb btn-trash" id="deleteService" title="삭제">삭제</button>
				</div>
			</div>
			<div class="Panel-content">
				<ul class="config-info" id="configInfo">
					<li>
						<strong>할당 CPU<span class="ico_title" id="AllocatedCPUTooltip"></span> : </strong>
						<span data="cpu"></span>
						<div class="Tooltip" data-base="#AllocatedCPUTooltip" id="AllocatedCPUTooltipMsg" data-position="bottom" data-animation="fade"></div>
					</li>
					<li>
						<strong>할당 메모리<span class="ico_title" id="AllocatedMemoryTooltip"></span> : </strong>
						<span data="memory"></span>
						<div class="Tooltip" data-base="#AllocatedMemoryTooltip" id="AllocatedMemoryTooltipMsg" data-position="bottom" data-animation="fade"></div>
					</li>
					<li>
						<strong>스토리지<span class="ico_title" id="StorageTooltip"></span> : </strong>
						<span data="disk"></span>
						<div class="Tooltip" data-base="#StorageTooltip" id="StorageTooltipMsg" data-position="bottom" data-animation="fade"></div>
					</li>
					<li th:if="${#request.getParameter('serviceType')=='mariadb'}">
						<strong>스토리지 QoS<span class="ico_title" id="StorageQoSTooltip"></span> : 	</strong>
						<span data="storageClass"></span>
						<div class="Tooltip" data-base="#StorageQoSTooltip" id="StorageQoSTooltipMsg" data-position="bottom" data-animation="fade"></div>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<!-- tab wrap -->
	<div class="Tabs db-tabs" id="zdbServiceTabs">
		<ul>
			<li data-content="#tabService">서비스 정보</li>
			<li data-content="#tabScale" th:if="${session.userInfo.clusterRole=='cluster-admin' || session.userInfo.zdbAdmin == true}">스케일</li>
			<li data-content="#tabMonitor">모니터링</li>
			<li data-content="#tabBackup" th:if="${session.userInfo.clusterRole=='cluster-admin' || session.userInfo.zdbAdmin == true}">백업</li>
			<li data-content="#tabEvent">이벤트</li>
<!-- 			<li data-content="#tabUser">사용자</li> -->
<!-- 			<li data-content="#tabDatabase" th:if="${#request.getParameter('serviceType')=='mariadb'}" >Database</li> -->
 			<li data-content="#tabSystem" th:if="${#request.getParameter('serviceType')!='mariadb'}" >환경설정</li>
			<li data-content="#tabLog" th:if="${#request.getParameter('serviceType')=='mariadb'}" >로그</li>
<!-- 			<li data-content="#tabProcess">프로세스</li> -->
 			<li data-content="#tabMariadb" th:if="${#request.getParameter('serviceType')=='mariadb'}">관리</li> 
		</ul>
		<!-- 서비스 정보 PageID: ZDB-02-10R -->
		<div id="tabService">
			<!-- accordion wrap-->
			<ul class="cp-accordion">
				<li>
					<h3 class="form-title">Connection</h3>
					<div class="Tooltip hide" data-base="#failoverTooltip">Master DB가 장애로 서비스가 불가능한 상태가 되면,<br/> failover를 수행하여 slave DB를 master DB로 승격시켜<br/> 서비스 다운타임을 최소화 합니다.</div>
					<div class="accor-contents__wrap">
						<form name="formService">
						<table id="connectionInfoTable" class="Table Form-type">
							<colgroup>
								<col style="width: 200px;"> </col>
								<col></col>
							</colgroup>
							<tbody>
								<tr>
									<th>Credential</th>
									<td>
										<input id="credential" name="credential" class="Textinput" type="password" autocomplete="off"/>
										<span class="input-pw"></span>
										<button class="Button line-btn" th:if="${session.userInfo.zdbAdmin}" id="togglePwd">보기</button>
										<button class="Button line-btn" th:if="${session.userInfo.zdbAdmin}" id="credentialCopy">복사</button>
										<button class="Button line-btn" th:if="${session.userInfo.zdbAdmin}" id="credentialUpdate">변경</button>
										<span class="Color-warning hide connectionInfoCopyed">복사되었습니다.</span>
									</td>	
								</tr>
								<tr>
									<th> 접속포트</th>
									<td data="port" th:if="${#request.getParameter('serviceType')} == 'redis'"> </td>
									<td th:if="${#request.getParameter('serviceType')} != 'redis'">
										<input type="text" class="Textinput" name="port" id="port">
										<button class="Button line-btn" th:if="${session.userInfo.zdbAdmin}" id="portUpdate">변경</button>
										<p data-for="port" class="warn-text"></p>
									</td>
								</tr>
								<tr>                                                                                                 
					               	<th rowspan="2">Private Network</th>      
					               	<td>                                                                 
										<span class="info-cnt__title">Master</span>
										<div class="info-radio__wrap">
											<label class="ImageRadio"> <input class="Radio" name="con1" value="connectionString" checked="checked">Connection String </label>
											<label class="ImageRadio"> <input class="Radio" name="con1" value="connectionLine">Command Line </label>
										</div>
										<div class="info-input__wrap connectionString">	
						               		<input class="Textinput" name="privatemasterConnectionString" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>
						               	</div>
						               	<div class="info-input__wrap connectionLine hide">	
						               		<input type="text" class="Textinput" name="privatemasterConnectionLine" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>                         
						               	</div>
						               	<div class="fl hide" id="divFailoverArea">
            				           		<div id="divFailoverBtn" class="hide">
							               		<button class="Button btn" id="failoverTooltip">Failover</button>
						               		</div>
						               		<div id="divFailbackBtn" class="hide">
						               			<button class="Button btn">Failback</button>
						               			<span class="Tooltip hide">서비스 L/B를 Master DB 로 복원합니다.</span>
						               		</div>
						               	</div>	
						               	<span class="Color-warning hide connectionInfoCopyed">복사되었습니다.</span>
					               	</td>                                                                                         
				                </tr>
				                <tr class="slaveConnection">
					               	<td>
					               		<span class="info-cnt__title">Slave</span>
										<div class="info-radio__wrap">
											<label class="ImageRadio"> <input class="Radio" name="con2" value="connectionString" checked="checked">Connection String </label>
											<label class="ImageRadio"> <input class="Radio" name="con2" value="connectionLine">Command Line </label>
										</div>					               		
					               		<div class="info-input__wrap connectionString">                                                                                                  
						               		<input class="Textinput" name="privateslaveConnectionString" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>                          
						               	</div>
						               	<div class="info-input__wrap connectionLine hide">
						               		<input type="text" class="Textinput" name="privateslaveConnectionLine" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>                          
						               	</div>	
					               		<span class="Color-warning hide connectionInfoCopyed">복사되었습니다.</span>                                                                                      
					               	</td>                  
				                </tr>
			                </tbody>
			                <tbody class="publicConnectionInfo publicNetworkTbody hide">
								<tr>                                                                                                 
					               	<th rowspan="2">Public Network</th>                                                                       
					               	<td>       
					               	    <span class="info-cnt__title">Master</span>
										<div class="info-radio__wrap">
											<label class="ImageRadio"> <input class="Radio" name="con3" value="connectionString" checked="checked">Connection String </label>
											<label class="ImageRadio"> <input class="Radio" name="con3" value="connectionLine">Command Line </label>
										</div>
        						   		<div class="info-input__wrap connectionString">                                                                                                  
						               		<input class="Textinput" name="publicmasterConnectionString" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>                          
						               	</div>
						               	<div class="info-input__wrap connectionLine hide">                                                                   
						               		<input type="text" class="Textinput" name="publicmasterConnectionLine" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>                         
						               	</div>	
						               	<button class="Button btn-ico__typeb btn-trash" id="publicNetworkDelete"  th:if="${session.userInfo.zdbAdmin}"  title="Public Network 삭제">삭제</button>
					               		<span class="Color-warning hide connectionInfoCopyed">복사되었습니다.</span>                                                                                      
					               	</td>                                                                                         
				                </tr>
				                <tr class="slaveConnection">
					               	<td>
					               	    <span class="info-cnt__title">Slave</span>
										<div class="info-radio__wrap">
											<label class="ImageRadio"> <input class="Radio" name="con4" value="connectionString" checked="checked">Connection String </label>
											<label class="ImageRadio"> <input class="Radio" name="con4" value="connectionLine">Command Line </label>
										</div>					               	
		               	           		<div class="info-input__wrap connectionString">                                                                                                  
						               		<input class="Textinput" name="publicslaveConnectionString" readonly="readonly"></input>      
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>                          
						               	</div> 
						               	<div class="info-input__wrap connectionLine hide">                                                                                              
						               		<input type="text" class="Textinput" name="publicslaveConnectionLine" readonly="readonly"></input>     
						               		<button class="Button btn-ico__typeb btn-clipboard connectionStringCopy" title="clipboard복사"></button>
						               	</div>	                          
					               		<span class="Color-warning hide connectionInfoCopyed">복사되었습니다.</span>                                                                                      
					               	</td>                  
				                </tr>
			                </tbody>
			                <tbody class="publicConnectionInfoNone publicNetworkTbody hide" th:if="${session.userInfo.zdbAdmin}" >
								<tr>                                                                                                 
					               	<th>Public Network</th>                                                                       
					               	<td>       
					               	    <button class="Button btn" id="publicNetworkCreate">Public Network생성</button>                                                                                 
					               	</td>                                                                                         
				                </tr>
			                </tbody>
						</table>
						</form>
					</div>
				</li>
				<li id="divFailover" class="hide">
					<h3 class="form-title">Failover</h3>
					<div class="accor-contents__wrap">
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 200px;"> </col>
								<col></col>
							</colgroup>
							<tbody>
								<tr>
									<th>Auto Failover</th>
									<td width="120">
										<div id="divFailoverRunning" class="fl mr30">
											<img src="/styles/images/rotation_ani.gif" style="width: 20px;height: 20px;">
										</div>
										<div id="divFailoverOnOff" class="onoff-wrap fl mr30"><button class="Button btn-off" data-target="failOverEnable">OFF</button></div>
										<div class="hide">
											<select name="failOverEnable"> 
												<option value="Y">Y</option> 
												<option value="N">N</option> 
											</select>
										</div> 
									</td>
									<td width="20">
    									<span class="Icon ico-cloudz alarm" data-type="icon" data-classinit="true" style="display: inline-block;" data-converted="true"></span>
									</td>    
									<td>
										<div class="fl">
											<b>※ Master 노드 장애발생시 임계 시간동안 서비스가 복구되지 않을 경우 자동으로 Slave 노드로 서비스를 전환합니다.</b><br>
											<b>※ 실행조건 : 5초 주기 5회 실패시</b><br>
	                                        <b>※ 최초 설정 변경시 서비스가 재시작 됩니다.</b>
										</div>                                       
									</td> 									
								</tr>
							</tbody>
						</table>										
					</div>
				</li>
				<li>
					<h3 class="form-title">Resource</h3>
					<div class="accor-contents__wrap">
						<div id="gridResource" class="grid"></div>
						<!-- <div class="Tooltip" id="replicationTooltip" data-position="bottom|left"></div> -->
					</div>
				</li>
			</ul>
			<div class="Tooltip" data-base="#replicationTooltip" id="replicationTooltipMsg" data-position="right" style="z-index:99999999999"></div>
					
		</div>
		<!--스케일 PageID: ZDB-02-20R -->
		<div id="tabScale"  style="display:none;">
			<!-- accordion wrap-->
			<ul>
				<li>
					<h3 class="form-title">Scale Up/Down</h3>
					<div class="accor-contents__wrap">
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 200px;">
								<col>
							</colgroup>
							<tbody>
								<tr>
									<th class="Valign-top">리소스</th>
									<td class="overflow-hidden">
										<div class="info-wrap">
											<div class="info-radio__wrap">
												<label class="ImageRadio"> <input class="Radio" name="scaleType" value="progress" checked="checked">리소스선택</label>
												<label class="ImageRadio"> <input class="Radio" name="scaleType" value="custom">사용자입력</label>
											</div>
											<p class="memory-title">&nbsp;</p>
											<div class="info-wrap ht60">
												<div id="divScaleProgress">
													<div class="memory-info" id="memoryInfo">1GB</div>
													<div class="progress-wrap">
														<div class="memory-bar" id="memorySlider"></div>
													</div>
												</div>
												<div id="divScaleCustom" class="hide">
													<form id="scaleForm" name="scaleForm">
													<div class="wd200 fl">
														CPU : <input type="text" class="Textinput wd100" id="scaleCpu" name="scaleCpu"/> m
														<p data-for="scaleCpu" class="warn-text"></p>
													</div>
													<div>
														Memory : <input type="text" class="Textinput wd100" id="scaleMemory" name="scaleMemory"/> Mi
														<p data-for="scaleMemory" class="warn-text"></p>
													</div>
													</form>
												</div>
											</div>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="btn-wrap__right">
							<button class="Button btn bg-red" id="updateScaleUp">적용하기</button>
						</div>
					</div>
				</li>
				<li th:if="${#request.getParameter('serviceType')} == 'redis'" id="divScaleOut">
					<h3 class="form-title">Scale In/Out</h3>
					<div class="accor-contents__wrap">
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 200px;">
								<col>
							</colgroup>
							<tbody>
								<tr>
									<th class="Valign-top" >Read-Only Slave 수</th>
									<td>
										<div id="clusterSlaveCountSpinner" class="Spinner" data-min="1" data-max="1" data-step="1">
										    <input id="clusterSlaveCount" name="clusterSlaveCount" value="1">
										    <a class="Up"></a>
										    <a class="Down"></a>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="btn-wrap__right">
							<button class="Button btn bg-red" id="updateScaleOut">적용하기</button>
						</div>	
					</div>		
				</li>
			</ul>
		</div>
		
		<!--모니터링 PageID: ZDB-02-40R -->
		<div id="tabMonitor"  style="display:none;">
			<ul>
				<li th:if="${#request.getParameter('serviceType')=='mariadb'}">
					<div align="right">
						<a id="advancedMonitoring" target="_sub">
							<button class="Button btn" style="margin-top: 1px;margin-bottom: 1px;">Advanced Monitoring</button>
						</a>
					</div>
					<h3 class="form-title" style="margin-top: 0px;">System Resources</h3>
					<div class="tabs-contents">
                         <table class="Table Monitoring">
							  <tbody>
								  <tr>
								      <td> <div class="panel-cpu" id="panelCpu"><iframe id="monitoringPanel"></iframe></div> </td>
									  <td> <div class="panel-memory" id="panelMemory"><iframe id="monitoringPanel"></iframe></div> </td>
									  <td> <div class="panel-network" id="panelNetwork"><iframe id="monitoringPanel"></iframe></div> </td>
								  </tr>
							  </tbody>
						</table>
		            </div>
					<h3 class="form-title">Connections & Table</h3>
					<div class="tabs-contents">
                         <table class="Table Monitoring">
							<tbody>
								<tr>
									<td> <div class="panel-connections" id="panelConnections"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-thread" id="panelThread"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-tablelack" id="panelTablelack"><iframe id="monitoringPanel"></iframe></div> </td>
								</tr>
							</tbody>
						</table>
		            </div>
		            <div id="areaMonitorReplication" class="hide">
					<h3 class="form-title">Query & Replication</h3>
					<div class="tabs-contents">
                         <table class="Table Monitoring">
							<tbody>
								<tr>
									<td> <div class="panel-qps" id="panelQps"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-replicationdelay" id="panelReplicationdelay"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-sqlthread" id="panelSqlthread"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-iothread" id="panelIothread"><iframe id="monitoringPanel"></iframe></div> </td>
								</tr>
							</tbody>
						</table>
		            </div>
		            </div>
				</li>
			</ul>
			<ul>
				<li th:if="${#request.getParameter('serviceType')=='redis'}">
					<div align="right">
						<a id="advancedMonitoring" target="_sub">
							<button class="Button btn" style="margin-top: 1px;margin-bottom: 1px;">Advanced Monitoring</button>
						</a>
					</div>
					<h3 class="form-title" style="margin-top: 0px;">System Resources</h3>
					<div class="tabs-contents">
                         <table class="Table Monitoring">
							<tbody>
								<tr>
									<td> <div class="panel-cpu" id="panelCpu"> <iframe id="monitoringPanel"></iframe> </div> </td>
									<td> <div class="panel-memory" id="panelMemory"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-network" id="panelNetwork"><iframe id="monitoringPanel"></iframe></div> </td>
								</tr>
							</tbody>
						</table>
		            </div>
					<h3 class="form-title">Keys</h3>
					<div class="tabs-contents">
                         <table class="Table Monitoring">
							<tbody>
								<tr>
									<td> <div class="panel-items" id="panelItems"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-expiringvsnot" id="panelExpiringvsnot"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-expired" id="panelExpired"><iframe id="monitoringPanel"></iframe></div> </td>
								</tr>
							</tbody>
						</table>
		            </div>
					<h3 class="form-title">Commands</h3>
					<div class="tabs-contents">
                         <table class="Table Monitoring">
							<tbody>
								<tr>
									<td> <div class="panel-executed" id="panelExecuted"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-hits" id="panelHits"><iframe id="monitoringPanel"></iframe></div> </td>
									<td> <div class="panel-calls" id="panelCalls"><iframe id="monitoringPanel"></iframe></div> </td>
								</tr>
							</tbody>
						</table>
		            </div>
				</li>
			</ul>
		</div>
		<div id="tabBackup"  style="display:none;">
			<h3 class="form-title">백업</h3>
           	<!-- tab contents info detail-->
         	<form name="backupForm" method="post">
           	<div class="ctn-info__wrap" style="border-bottom:0px;">
         		<div class="mr30 wd300 fl info-list">
         			<span class="config-title">백업설정 :</span>
					<div class="onoff-wrap"><button class="Button btn-off" data-target="useYn">OFF</button></div>
					<div class="hide">
						<select name="useYn"> <option value="Y">Y</option> <option value="N">N</option> </select>
					</div>									
				</div>	           	
				<div class="mr30 wd300 fl info-list"><span class="config-title">보관기간:</span> 
					<div class="Spinner" data-min="0" data-max="60" data-step="1" id="storePeriodSpinner">
					    <input id="storePeriod" name="storePeriod" value="1" style="width:40px;text-align:left;">일&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					    <a class="Up"></a>
					    <a class="Down"></a>
					</div>
					
				</div>
				<div class="mr30 fl info-list">
					<div class="hide fl" data-show-service-type="mariadb">
						<span class="config-title">전체백업 수행주기: </span>
						<div class="Divselect" id="scheduleDay" name="scheduleDay">
							<select>
								<option value="0">매일 수행</option>
								<option value="2">매주 월요일</option>
								<option value="3">매주 화요일</option>
								<option value="4">매주 수요일</option>
								<option value="5">매주 목요일</option>
								<option value="6">매주 금요일</option>
								<option value="7">매주 토요일</option>
								<option value="1">매주 일요일</option>
							</select>
							<span></span>
						</div>
					</div>
				</div>
          	</div>	
			<div class="ctn-info__wrap" style="border-top:0px;">
				<div class="mr30 wd300 fl info-list">
					<span class="config-title">전체 백업 시간:</span>
					<div class="Spinner Time" data-locale="en" id="startTime" data-hours="24H" data-bind="time:date">
					    <input data-hour>
					    <span data-seperator>:</span>
					    <input data-minute>
					    <input data-ampm>
					    <a class="Up"></a>
					    <a class="Down"></a>
					</div>
				</div>
				<div class="mr30 wd300 fl info-list">
					<div class="hide fl" data-show-service-type="mariadb">
						<span class="config-title">증분 백업:</span>
						<div class="Divselect" id="incrementPeriod" name="incrementPeriod">
							<select>
								<option value="0">미사용</option>
								<option value="1">1시간</option>
								<option value="2">2시간</option>
								<option value="6">6시간</option>
								<option value="12">12시간</option>
								<option value="24">24시간</option>								
							</select>
							<span></span>
						</div>
					</div>
				</div>
				<div class="mr30 wd300 fl info-list">
					<div class="hide fl mr30" data-show-service-type="mariadb">
						<span class="config-title">수행모드 <span class="ico_question" id="throttleYnTooltip"></span> : </span>
						<span data="disk"></span>
						<div class="Tooltip" data-base="#throttleYnTooltip" id="throttleYnTooltipMsg" style="color:#ffffff;" data-position="bottom" data-animation="fade"></div>	
						<div class="Divselect" id="throttleYn" name="throttleYn">
							<select>
								<option value="N">정상모드</option>
								<option value="Y">저속모드</option>
							</select>
							<span></span>
						</div>
					</div>
				</div>	
				<div class="fr info-list">	
					<button class="Button btn bg-red Disabled fr" id="saveSchedule">수정</button>	
				</div>				
			</div>          	
          	<div class="mt10" style="height:40px;">
				<div class="info-list__select fr">
					<div class="fl" id="divAddBackup" style="margin-right:4px;">	
						<button class="Button btn hide" id="addBackupDisk">백업디스크 추가</button>
						<button class="Button btn hide" id="removeBackupDisk">백업디스크 제거</button>
					</div>
					<button class="Button btn ml1" id="deleteBackup">삭제</button>
					<button class="Button btn ml1" id="abortedBackup">백업 수행 중지</button>
					<button class="Button btn ml1" id="updateBackup">지금 백업하기</button>
					<button class="Button btn ml1" id="searchBackup">조회</button>	
				</div>	          	
          	</div>
           	<div class="info-list__select mt10 hide" data-show-service-type="mariadb">
           		<input class="Checkbox" type="checkbox" id="backupSearchType" checked="checked"/>증분백업포함
				<!-- button class="Button btn-search" id="searchBackup">검색</button-->
           	</div>
          	</form>
           	<!-- grid -->
            <div id="gridBackup" class="grid grid-line__wrap dash"></div>
            <div class="Tooltip" id="backupTooltip" data-position="bottom"></div>
		</div>
		<div id="tabEvent"  style="display:none;">
			<h3 class="form-title">이벤트</h3>
           		<form name="eventForm" method="post">
           		<div class="ctn-info__wrap">
					<div class="info-list select-date Daterange" data-selectyear="true" data-selectmonth="true">
						<div class="Startdate Dateinput">
						    <input id="eventStartDate" name="eventStartDate" type="text" readonly="readonly">
						    <div class="Calendar" id="eventStartDate"></div>
						</div>
						<div class="Spinner Time" data-locale="en" id="eventStartTime" name="eventStartTime" data-hours="24H" data-bind="time:date">
						    <input data-hour>
						    <span data-seperator>:</span>
						    <input data-minute>
						    <input data-ampm>
						    <a class="Up"></a>
						    <a class="Down"></a>
						</div>
						<span class="date-line">~</span>
						<div class="Enddate Dateinput">
						    <input id="eventEndDate" name="eventEndDate" type="text" readonly="readonly">
						    <div class="Calendar" id="eventEndDate"></div>
						</div>
						<div class="Spinner Time" data-locale="en" id="eventEndTime" name="eventEndTime" data-hours="24H" data-bind="time:date">
						    <input data-hour>
						    <span data-seperator>:</span>
						    <input data-minute>
						    <input data-ampm>
						    <a class="Up"></a>
						    <a class="Down"></a>
						</div>
					</div>
					<div class="info-list__select">
					<!-- 20190822 -->
						<div class="Divselect" style="width: 250px" id="type" name="type">
							<select>
								<option value="-">전 체</option>
								<option value="BACKUP">	Backup	</option>
								<option value="BACKUPSCHEDULE">	Backup Management	</option>
								<option value="BACKUPDISK">	Backup Storage	</option>
								<option value="WORKERPOOL">	Cluster Admin(Worker Pool)	</option>
								<option value="AUTOFAILOVER">	DB Failover Config	</option>
								<option value="LOG">	DB Log	</option>
								<option value="NETWORK">	DB Network Access	</option>
								<option value="CONFIG">	DBA Action(config)	</option>
								<option value="DATABASE">	DBA Action(Database)	</option>
								<option value="PROCESS">	DBA Action(Process)	</option>
								<option value="USER">	DBA Action(User)	</option>
								<option value="GLOBALCONFIG">	Global Config	</option>
								<option value="RESTORE">	Recovery	</option>
								<option value="SCALE">	Scaling	</option>
								<option value="CHANGEOVER">	Service Availability	</option>
								<option value="SERVICE">	Service Life Cycle	</option>
								<option value="CREADENTIAL">	Service Management	</option>
								<option value="PVC">	Storage	</option>
								<option value="TAG">	Tag	</option>
							</select>
							<span></span>
						</div>
						<input name="keyword" class="Textinput srcinput" placeholder="검색어를 입력하세요."/><button class="Button btn-search" id="searchEvent">검색</button>
					</div>
           		</div>
	           	<div class="info-list__select mt10 hide" data-show-service-type="mariadb">
	           		<input class="Checkbox" type="checkbox" id="backupEventExceptYn" name="backupEventExceptYn" />백업 이벤트 포함
					<!-- button class="Button btn-search" id="searchBackup">검색</button-->
	           	</div>           		
           		</form>
           	<!-- grid -->
            <div id="gridEvent" class="grid grid-line__wrap dash"></div>
            <div class="Tooltip" id="evtTooltip" data-position="bottom|left"></div>
		</div>
		<div id="tabUser" style="display:none;">
			<h3 class="form-title">사용자 목록 및 권한</h3>
			<ul class="ml5">
				<li> ※ 전체 Database에 관한 권한입니다.  </li>
				<li> ※ 상세한 권한 설정이 필요시에는 해당 Database에 접속하셔서 설정하셔야 합니다.</li>
			</ul>
			<div class="tabs-contents">
				<div class="btn-wrap">
					<div class="btn-right">
						<button class="Button btn" id="btnSearchUser" style="margin-bottom: 3px;">조회</button>
						<button class="Button btn" id="btnAddUser" style="margin-bottom: 3px;">추가</button>
						<button class="Button btn" id="btnDeleteUser" style="margin-bottom: 3px;">삭제</button>
						<button class="Button btn bg-red" id="btnSaveUser" style="margin-bottom: 3px;">저장</button>
					</div>
				</div>			
   				<div id="gridUser" class="grid grid-line__wrap"></div>
   			</div>
		</div>
<!-- 		<div id="tabDatabase" style="display:none;">		
			<h3 class="form-title">Database 목록</h3>
			<div class="tabs-contents">
				<div style="width: 500px;">
					<div class="btn-wrap">
						<div class="btn-right">
							<button class="Button btn" id="btnSearchDatabase" style="margin-bottom: 3px;">조회</button>
							<button class="Button btn" id="btnAddDatabase" style="margin-bottom: 3px;">추가</button>
							<button class="Button btn" id="btnDeleteDatabase" style="margin-bottom: 3px;">삭제</button>
							<button class="Button btn bg-red" id="btnSaveDatabase" style="margin-bottom: 3px;">저장</button>
						</div>
					</div>
					<div id="gridDatabase" class="grid grid-line__wrap"></div>
				</div>
			</div>		
		</div>	 -->	
		<div id="tabSystem" style="display:none;" >
			<form name="dbConfig" method="post">
			<ul>
				<li th:if="${#request.getParameter('serviceType')=='redis'}">
					<div class="accor-contents__wrap">
					<h3 class="form-title">Network  <span class="fr"><button class="Button btn" style="margin-top:-4px;" id="popVariables">설정 보기</button></span></h3>
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 250px;"> </col>
								<col> </col>
							</colgroup>
							<tbody>
								<tr>
									<th>timeout <span class="ico_title" id="iconTimeout"></span></th>
									<td> 
										<input type="text" id="timeout" name="timeout" class="Textinput"/>
										<span class="info-text">범위 : 0 ~ 3,600</span>
										<p data-for="timeout" class="warn-text"></p>
									</td>
								</tr>
								<tr>
									<th>tcp-keepalive<span class="ico_title" id="iconTcpKeepalive"></span></th>
									<td> 
										<input type="text" id="tcp-keepalive" name="tcp-keepalive" class="Textinput"/>
										<span class="info-text">범위 : 0 ~ 3,600</span>
										<p data-for="tcp-keepalive" class="warn-text"></p>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="Tooltip" data-base="#iconTimeout" data-position="right" data-animation="fade">
							Redis 서버에 연결된 Client가 timeout 시간(초) 동안 아무 명령이 없으면 접속을 끊습니다.
							<br>timeout 값이 0인 경우, 아무 명령이 없어도 접속을 끊지 않습니다.
						</div>
						<div class="Tooltip" data-base="#iconTcpKeepalive" data-position="right" data-animation="fade">
							Redis 서버가 tcp-keepalive 시간(초)마다 Client의 상태를 확인하여 아무 응답이 없으면 접속을 끊습니다.
							<br>tcp-keepalive 값이 0인 경우, 아무 응답이 없어도 접속을 끊지 않습니다.
						</div>
						<h3 class="form-title">Memory Management</h3>
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 250px;"> </col>
								<col> </col>
							</colgroup>
							<tbody>
								<tr>
									<th>maxmemory-policy<span class="ico_title" id="iconMaxmemoryPolicy"></span></th>
									<td> 
										<div class="Divselect" style="width: 200px" id="maxmemory-policy" name="maxmemory-policy">
										<select>
											<option value="noeviction">noeviction</option>
											<option value="allkeys-lru">allkeys-lru</option>
											<option value="volatile-lru">volatile-lru</option>
											<option value="allkeys-random">allkeys-random</option>
											<option value="volatile-random">volatile-random</option>
											<option value="volatile-ttl">volatile-ttl</option>
										</select>
										<span></span>
										</div>
									</td>
								</tr>
								<tr>
									<th>maxmemory-samples<span class="ico_title" id="iconMaxmemorySamples"></span></th>
									<td>
										<input type="text" id="maxmemory-samples" name="maxmemory-samples" class="Textinput"/>
										<span class="info-text">범위 : 1 ~ 10</span>
										<p data-for="maxmemory-samples" class="warn-text"></p>
									</td>
								</tr>	
							</tbody>
						</table>
						<div class="Tooltip" data-base="#iconMaxmemoryPolicy" data-position="right" data-animation="fade">
							메모리 관리에 대한 정책을 선택합니다.
							<br>‣ noeviction: 기존 데이터를 삭제하지 않습니다. 메모리 한계에 도달하면 OOM 오류 반환하며, 새 데이터가 저장되지 않습니다.
							<br>‣ allkeys-lru: 전체 키에 대하여 LRU 알고리즘으로 데이터를 삭제하여 공간을 확보하고, 새 데이터를 저장합니다.
							<br>‣ volatile-lru: expire set을 가진 키에 대하여 LRU 알고리즘으로 데이터를 삭제하여 공간을 확보하고, 새 데이터를 저장합니다.
							<br>‣ allkeys-random: 전체 키에 대하여 랜덤으로 데이터를 삭제하여 공간을 확보하고, 새 데이터를 저장합니다.
							<br>‣ volatile-random: expire set을 가진 키에 대하여 랜덤으로 데이터를 삭제하여 공간을 확보하고, 새 데이터를 저장합니다.
							<br>‣ volatile-ttl: expire set을 가진 키에 대하여 TTL이 짧은 것부터 데이터를 삭제하여 공간을 확보하고, 새 데이터를 저장합니다.
						</div>
						<div class="Tooltip" data-base="#iconMaxmemorySamples" data-position="right" data-animation="fade">
							메모리를 절약하기 위해서, LRU 알고리즘 수행 시 검사를 위한 샘플의 크기를 선택합니다.
							<br>낮을 수록 메모리를 절약 할 수 있습니다.
						</div>
					    <h3 class="form-title">Slow Log</h3>
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 250px;"> </col>
								<col> </col>
							</colgroup>
							<tbody>	
								<tr>
									<th>slowlog-log-slower-than<span class="ico_title" id="iconSlowlogLST"></span></th>
									<td>
										<input type="text" id="slowlog-log-slower-than" name="slowlog-log-slower-than" class="Textinput"/>
										<span class="info-text">범위 : -1 ~ 12000</span>
										<p data-for="slowlog-log-slower-than" class="warn-text"></p>
									</td>
								</tr>
								<tr>
									<th>slowlog-max-len<span class="ico_title" id="iconSlowlogMaxLen"></span></th>
									<td>
										<input type="text" id="slowlog-max-len" name="slowlog-max-len" class="Textinput"/>
										<span class="info-text">범위 : 1 ~ 256</span>
										<p data-for="slowlog-max-len" class="warn-text"></p>
									</td>
								</tr>	
							</tbody>
						</table>
						<div class="Tooltip" data-base="#iconSlowlogLST" data-position="right" data-animation="fade">
							slowlog-log-slower-than 값으로 설정된 시간(밀리초) 이상 소요되는 명령을 Slowlog로 기록합니다.
							<br>값이 0인 경우 모든 명령을 기록합니다.
							<br>값이 음수인 경우 아무런 명령을 기록하지 않습니다.
						</div>
						<div class="Tooltip" data-base="#iconSlowlogMaxLen" data-position="right" data-animation="fade">
							slowlog의 최대 개수를 지정합니다.
						</div>
					    <h3 class="form-title">Event Notification</h3>
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 250px;"> </col>
								<col> </col>
							</colgroup>
							<tbody>									
								<tr>
									<th>notify-keyspace-events<span class="ico_title" id="iconNotifyKeyspaceEvents"></span></th>
									<td>
										<input type="text" id="notify-keyspace-events" name="notify-keyspace-events" class="Textinput"/>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="Tooltip" data-base="#iconNotifyKeyspaceEvents" data-position="right" data-animation="fade">
							Redis의 Keyspace Event에 대한 Notification 기능을 설정합니다.
							<br>‣ " ": notification 비활성화
							<br>‣ K: Keyspace 이벤트, published with __keyspace@__ prefix.
							<br>‣ E: Keyevent 이벤트, published with __keyevent@__ prefix.
							<br>‣ g: 데이터 타입이 지정돼 있지 않은 일반 명령어(예: DEL, EXPIRE, RENAME 등)
							<br>‣ $: String 명령어
							<br>‣ l: List 명령어
							<br>‣ s: Set 명령어
							<br>‣ h: Hash 명령어
							<br>‣ z: Sorted set 명령어
							<br>‣ x: Expired 이벤트 (events generated every time a key expires)
							<br>‣ e: Evicted 이벤트 (events generated when a key is evicted for maxmemory)
							<br>‣ A: 혼합 옵션 (예: "AKE"는 모든 이벤트를 의미함)
						</div>
						<div id="divAdvancedConfig">
							<h3 class="form-title">Advanced Config</h3>
							<table class="Table Form-type">
								<colgroup>
									<col style="width: 250px;"> </col>
									<col> </col>
								</colgroup>
								<tbody>		
									<tr>
										<th>hash-max-ziplist-entries<span class="ico_title" id="iconHashMZE"></span></th>
										<td>	
											<input type="text" id="hash-max-ziplist-entries" name="hash-max-ziplist-entries" class="Textinput"/>
											<span class="info-text">범위 : 0 ~ 65535</span>
											<p data-for="hash-max-ziplist-entries" class="warn-text"></p>
										</td>
									</tr>
									<tr>	
										<th>hash-max-ziplist-value<span class="ico_title" id="iconHashMZV"></span></th>
										<td>
											<input type="text" id="hash-max-ziplist-value" name="hash-max-ziplist-value" class="Textinput"/>
											<span class="info-text">범위 : 0 ~ 65535</span>
											<p data-for="hash-max-ziplist-value" class="warn-text"></p>
										</td>
									</tr>	
									<tr>	
										<th>list-max-ziplist-size<span class="ico_title" id="iconListMZS"></span></th>
										<td>
											<input type="text" id="list-max-ziplist-size" name="list-max-ziplist-size" class="Textinput"/>
											<span class="info-text">범위 : -5 ~ 5</span>
											<p data-for="list-max-ziplist-size" class="warn-text"></p>
										</td>
									</tr>	
									<tr>	
										<th>zset-max-ziplist-entries<span class="ico_title" id="iconZsetMZE"></span></th>
										<td>
											<input type="text" id="zset-max-ziplist-entries" name="zset-max-ziplist-entries" class="Textinput"/>
											<span class="info-text">범위 : 0 ~ 65535</span>
											<p data-for="zset-max-ziplist-entries" class="warn-text"></p>
										</td>
									</tr>	
									<tr>	
										<th>zset-max-ziplist-value<span class="ico_title" id="iconZsetMZV"></span></th>
										<td>
											<input type="text" id="zset-max-ziplist-value" name="zset-max-ziplist-value" class="Textinput"/>
											<span class="info-text">범위 : 0 ~ 65535</span>
											<p data-for="zset-max-ziplist-value" class="warn-text"></p>
										</td>
									</tr>	
								</tbody>
							</table>
							<div class="Tooltip" data-base="#iconHashMZE" data-position="right" data-animation="fade">
								Hash의 Field 개수를 설정합니다. 값이 512일 때, Filed 수가 512개 이하이면 Zip list로 저장됩니다.
							</div>
							<div class="Tooltip" data-base="#iconHashMZV" data-position="right" data-animation="fade">
								값(String)의 크기를 설정합니다. 값이 64일 때, 값의 크기가 64Byte 이하이면 Zip list로 저장됩니다.
							</div>
							<div class="Tooltip" data-base="#iconListMZS" data-position="right" data-animation="fade">
								Zip list의 크기를 설정합니다.
								<br>‣ -5 : max size 64 kb
								<br>‣ -4 : max size 32 kb
								<br>‣ -3 : max size 16 kb
								<br>‣ -2 : max size  8 kb (default)
								<br>‣ -1 : max size  4 kb
								<br>‣ 1 : entry 1
								<br>‣ 2 : entries 2
								<br>‣ n : entries n
							</div>
							<div class="Tooltip" data-base="#iconZsetMZE" data-position="right" data-animation="fade">
								Sorted Set에 포함된 멤버의 개수 기준을 설정합니다.
								<br>값이 128일 때, Sorted Set에 포함된 멤버의 개수가 128보다 크면 Skip list로,
								<br>아니면 Zip list로 인코딩 됩니다.
							</div>
							<div class="Tooltip" data-base="#iconZsetMZV" data-position="right" data-animation="fade">
								Sorted Set의 사이즈의 기준을 설정합니다.
								<br>값이 64일 때, Sorted Set에 포함된 요소 중 가장 긴 요소의 길이가 이 값보다 크면 Skip list로, 
								<br>아니면 Zip list로 인코딩 됩니다.
							</div>
						</div>
			            <div class="btn-wrap__right">
				        	<button class="Button btn bg-red" id="saveVariables">적용하기</button>
				        </div>
					</div>
				</li>
				
				<li th:if="${#request.getParameter('serviceType')=='mariadb'}">
					<h3 class="form-title">Parameter <span class="fr"><button class="Button btn" style="margin-top:-4px;" id="popVariables">설정 보기</button></span></h3>
					<div class="accor-contents__wrap">	
						<table id="serviceConfigTable" class="Table Form-type">
							<colgroup>
								<col style="width: 280px;"> </col>
								<col> </col>
							</colgroup>							
							<tbody> </tbody>
						</table>
			            <div class="btn-wrap__right">
				        	<button class="Button btn bg-red" id="saveVariables">적용하기</button>
				        </div>						
					</div>
				</li>
			</ul>
			</form>
		</div>
		<div id="tabLog" style="display:none;">
			<h3 class="form-title">로그</h3>
			<div class="tabs-contents">
				<div class="mt10">
					<div class="info-list select-date Daterange" data-selectyear="true" data-selectmonth="true">
						<div class="Startdate Dateinput">
							<input id="logStartDate" name="logStartDate" type="text" readonly="readonly">
							<div class="Calendar" id="logStartDate"></div>
						</div>
						<span class="date-line">~</span>
						<div class="Enddate Dateinput">
							<input id="logEndDate" name="logEndDate" type="text" readonly="readonly">
							<div class="Calendar" id="logEndDate"></div>
						</div>
					</div>
					<label class="ImageRadio af-radio-text"><input class="Radio" name="logType" checked="checked" value="error">에러로그</label>
					<label class="ImageRadio af-radio-text"><input class="Radio" name="logType" value="query">Slow Query</label>
					<span class="ml20"></span>
					<button class="Button btn" id="btnSearchLog">조회</button>
					<button class="Button btn" id="btnDownloadLog">다운로드</button>
				</div>
				<div>
					<div style="width:100%;overflow: scroll" class="mt10">
						<textarea class="Textarea" id="divLog" style="background: black;color: white;height:680px;width:100%;overflow: scroll;"></textarea>
					</div>
				</div>				
			</div>
		</div>		
		
		<div id="tabProcess" style="display:none;" >
			<h3 class="form-title">프로세스</h3>
			<div class="tabs-contents">
				<div id="gridProcess"></div>
			</div>		
		</div>
	 	<th:block th:id="tabMariadb" th:if="${#request.getParameter('serviceType')=='mariadb'}" th:include="zdb02/zdb0210_tabMariadb"></th:block> 
	</div>
</div>
<script type="text/javascript">
	'use strict'
	let app = {};
	var gCurrentNamespace = '';
	var gNamespaces = null;
	var gService = null;
	var gTagList = [];
	var gServiceScale = {};//scaleUp value
	var gConfigData = null;
	var gEventType = { "SERVICE":"Service Life Cycle","PVC":"Storage","CHANGEOVER":"Service Availability","PROCESS":"DBA Action(Process)"
				,"DATABASE":"DBA Action(Database)","NETWORK":"DB Network Access","AUTOFAILOVER":"DB Failover Config","BACKUPDISK":"Backup Storage"
				,"BACKUP":"Backup","BACKUPSCHEDULE":"Backup Management","RESTORE":"Recovery","USER":"DBA Action(User)","TAG":"Tag","SCALE":"Scaling"
				,"WORKERPOOL":"Cluster Admin(Worker Pool)","LOG":"DB Log","GLOBALCONFIG":"Global Config","CONFIG":"DBA Action(config)"
				,"CREADENTIAL":"Service Management"};
	$a.page(function() {
		this.init = function() {
			$('[data-show-service-type*='+gParam.serviceType+']').show();
			//namespace 변경시 이벤트
			gCommon.getConfigData().done(function(re){
				gConfigData = re;
				gCommon.getNamespaceCombo($('#namespaces')).done(function(selector){
					gNamespaces = selector.select({id:gSelectedNamespace})
										 .addHandler(function(e) {
											  gCommon.setSelectedNamespace(e.currentTarget.id);
											  gCommon.movePage('/zdb02/zdb0200',{selectedNamespace:gSelectedNamespace});
				   						  });
					
				});
			});
			$('.Accordion').expandAll();
			var data = {
					namespace:gParam.namespace,
					serviceType:gParam.serviceType,
					serviceName:gParam.serviceName
				};

			//탭 변경 시 조회
			$('#zdbServiceTabs').on('tabchange', function(e, index, index2){
				fn_displayTabs(index);
			});
		
			function fn_displayTabs(index){
				var tabId = $('#zdbServiceTabs').getTabContentByIndex(index).id;
				fn_setSelected2010Tab(tabId);
				//탭 모니터내의 스크립트 실행이 많아서 iframe들을 초기화
				$('#tabMonitor').find('iframe').attr('src','');
				
				switch(tabId){
					case "tabService": $("#gridResource").alopexGrid( "viewUpdate" ); fn_getConnectionInfo(); break;
					case "tabScale": break;
					case "tabMonitor": fn_getMonitoring(); break;
					case "tabBackup": $("#gridBackup").alopexGrid( "viewUpdate" ); fn_getBackupScheduleInfo(); fn_getBackupInfo(); break;
					case "tabEvent": $("#gridEvent").alopexGrid( "viewUpdate" ); fn_getEventInfo(); break;
					case "tabUser": $("#gridUser").alopexGrid( "viewUpdate" ); fn_getUserGrants(); break;
					case "tabDatabase": $("#gridDatabase").alopexGrid( "viewUpdate" ); fn_getDatabases(); break;
					case "tabSystem": fn_getConfigurationInfo(); break;
					case "tabProcess": $("#gridProcess").alopexGrid( "viewUpdate" ); fn_getProcesses(); break;
 					case "tabMariadb": appMariadb.initMenu(appMariadb.selectedMenu);break; 
				}
			}
			$('#backServices').on('click',function(){
				gCommon.movePage('/zdb02/zdb0200',{selectedNamespace:gSelectedNamespace});
			});			

			$('#deleteService').on('click',function(){
 				gCommon.credentialConfirm({
			        data:{credential:$("#credential").val(),msg:'서비스를 삭제하시려면',okBtnMsg:'삭제'},
			        callback : function(res){
			        	let data = $.extend({},gParam);
			        	let alertRules = [];
			        	data.alertRules = JSON.stringify(alertRules);
			        	
						$a.ajax({
							url: '/zdbapi/deleteServiceInstance',
							data:data,
							success: function(res){
								gCommon.alert('삭제 요청이 완료 되었습니다.');
								gCommon.movePage('/zdb02/zdb0200',{selectedNamespace:gSelectedNamespace});
							}
						}) 
			        }
			    });
			});
			$('#restartService').on('click',function(){
				gCommon.credentialConfirm({
			        data:{credential:$("#credential").val(),msg:'서비스를 재시작 하시려면',okBtnMsg:'재시작'},
			        callback : function(res){
						$a.ajax({
							url: '/zdbapi/restartService',
							data:data,
							success: function(res){
								gCommon.alert(res.result.message);
							}
						})
			        }
			    });		
			});
			//서비스 목록내 태그 삭제
			$('body').on('click','button.tagDel',function(){
				var ob = $(this).prev();
				gCommon.confirm('선택한 태그를 삭제하시겠습니까?',function(){
					var data = gCommon.findObjectByKeyOb(gTagList,{id:ob.data('id')});
					data = $.extend({},data,{serviceName:data.releaseName});
					$a.ajax({
						url: '/zdbapi/deleteTag',
						data: data, 
						success: function(res){
							fn_getServiceFirst();
						}
					});
				})
			});		
			//서비스 목록내 태그 추가
			$('body').on('click','button.tagAdd',function(e){
				e.preventDefault();
				$(this).next().show().find('input').focus();
			});
			$('body').on('keypress','input.tagAddInput',function(evt){
				if(evt.which == '13'){
		    		var data = {namespace:gService.namespace,serviceName:gService.serviceName,releaseName:gService.serviceName,tagName:$(this).val()};
					$a.ajax({
						url: '/zdbapi/createTag',
						data: data, 
						success: function(res){
							if(res.result.code == '0'){
								fn_getServiceFirst();								
							}
						}
					});
				};
			}).on('focusout','input.tagAddInput',function(){
				$(this).val('').parent().hide();
			});			
			/* tabService start */
			let tabService = $('#tabService');
			let formService = $('form[name=formService]');
			let isSlowLogHidden = gParam.serviceType != cServiceType.mariadb;
			
			Validator.addMethod('checkPort', function(element, value) {
				let n = cloudUtil.parseInt(value);
			    return (n == 3306 || (n <= 39999 && n >= 10000));
			});	
			formService.validator({
			    elements :{ 
			         port: { rule:{required:true,checkPort:''} , message:{checkPort:'포트는 3306, 10000~39999 허용'} }
			    }
			});						
			$('#togglePwd').on('click',function(){
				setConnectionString(true)
			});
			function setConnectionString(isSwitch){
				let isShowCredential = $('#credential').attr('type')=='text';
				if(isSwitch){
					$('#credential').attr('type',isShowCredential?'password':'text');
					isShowCredential = !isShowCredential;
				}				
				if(isShowCredential){
					$('#connectionInfoTable').find('input[data-origin]').each(function(){
						var ob = $(this);
						ob.val(ob.val().replace('[password]',$('#credential').val()));
					});
				}else{
					$('#connectionInfoTable').find('input[data-origin]').each(function(){
						var ob = $(this);
						ob.val(ob.data('origin'));
					});
				}
			}
			$('#credentialUpdate').on('click',function(){
				var param = $.extend({},gParam);
				param.credential  = $('#credential').val();
				
			    $a.popup({
			        url: "/zdb02/zdb0200p01",
			        data:param,
			        iframe: false,
			        width: 500,
			        height: 400,
			        title : '',
			        callback : function(res){
			        	if(res == "Y"){
			        		$('#zdbServiceTabs').setTabByContent('#tabService');
			        	};
			        }
			    });
			});
			$('#portUpdate').on('click',function(){
				if(!formService.validate())return;
				gCommon.credentialConfirm({
			        data:{credential:$("#credential").val(),msg:'서비스 포트를 변경 하시려면',okBtnMsg:'변경'},
			        callback : function(res){
						$a.ajax({
							url: '/zdbapi/changePort',
							method:'PUT',
							data:$.extend({},gParam,{port:$('#port').val()}),
							success: function(res){
								gCommon.alert(res.result.message,function(){
									fn_getConnectionInfo();				
								});
							}
						})
			        }
			    });	
			});
			
			let getGridContextButton = function(){
				return $('<button class="Button btn-ico__typeb btn-listview buttonMenu"></button>').on('click',function(e){
					$(this).parent().trigger('contextmenu');
 					let d = $('.alopexgrid-contextmenu-wrapper');
					d.css({left:e.pageX,top:e.pageY});
				});
			}
			let gridResource = $('#gridResource').alopexGrid({
				enableDefaultContextMenu:false,
				enableContextMenu:true,
				autoColumnIndex: true,
				autoResize:true,
				height: 400,
				contextMenu : [
					{   title: 'Restart',
						processor:function(data,$cell,grid){
							gCommon.credentialConfirm({
								data:{credential:$("#credential").val(),msg:'재시작 하시려면',okBtnMsg:'재시작'},
						        callback : function(res){
						        	if(res == "Y"){
										var param = {
												serviceType:gService.serviceType,
												namespace:gService.namespace,
												serviceName:gService.serviceName,
												podName:data.name
										}
										$a.ajax({
											url: '/zdbapi/restartPod',
											data:param,
											success: function(res){
												if(res.result.code!='4'){
													gCommon.alert(res.result.message);
												};
											}
										});
						        	};
						        }
						    });								
						},
						use: function(data,$cell,grid){
							return $cell.data('alopexgrid-key')=="restart" && data.status == 'green';
						}
					},
					{   title: "Start" ,
						processor: function(data, $cell, grid) {
							gCommon.credentialConfirm({
						        data:{credential:$("#credential").val(), msg:'서비스 시작 하시려면', okBtnMsg:'서비스 시작'},
						        callback : function(res){
									$a.ajax({
										url: '/zdbapi/serviceOn',
										method:'PUT', data:($.extend({},gParam,{stsName:data.name})),
										success: function(res){
											if(res.result.code!='4'){
												gCommon.alert(res.result.message);
											}
										}
									})
						        }
						    });
						},
						use: function(data, $cell, grid) {
							return $cell.data('alopexgrid-key')=="restart" && data.status == 'red';
						}
					},
					{   title: "Shutdown" ,
						processor: function(data, $cell, grid) {
							gCommon.credentialConfirm({
						        data:{credential:$("#credential").val(), msg:'서비스를 종료 하시려면', okBtnMsg:'서비스 종료'},
						        callback : function(res){
									$a.ajax({
										url: '/zdbapi/serviceOff',
										method:'PUT', data:($.extend({},gParam,{stsName:data.stName})),
										success: function(res){
											if(res.result.code!='4'){
												gCommon.alert(res.result.message);
											}
										}
									})
						        }
						    });
						},
						use: function(data, $cell, grid) {
							return $cell.data('alopexgrid-key')=="restart" && data.status == 'green';
						}
					},
					{
						title: 'Error Log',
						processor: function(data,$cell,grid){
							if(data.condition && data.condition.status == 'True'){
								window.open("/zdb02/zdb0200p02?namespace="+gService.namespace+"&serviceName="+gService.serviceName+"&podName="+data.name);
							}else{
								gCommon.alert('서비스 이용이 가능할 때 조회할 수 있습니다');
							}
						},
						use: function(data,$cell,grid){
							return ($cell.data('alopexgrid-key')=="log" && data.isPod) && data.serviceType == 'mariadb';	
						}
					},
					{
						title: 'Server Log',
						processor: function(data,$cell,grid){
							if(data.condition && data.condition.status == 'True'){
								window.open("/zdb02/zdb0200p02?namespace="+gService.namespace+"&serviceName="+gService.serviceName+"&podName="+data.name);
							}else{
								gCommon.alert('서비스 이용이 가능할 때 조회할 수 있습니다');
							}
						},
						use: function(data,$cell,grid){
							return ($cell.data('alopexgrid-key')=="log" && data.isPod) && data.serviceType == 'redis';	
						}
					},
					{
						title: 'Slow Log',
						processor: function(data,$cell,grid){
							if(data.condition && data.condition.status == 'True'){
								window.open("/zdb02/zdb0200p04?namespace="+gService.namespace+"&serviceName="+gService.serviceName+"&podName="+data.name);
							}else{
								gCommon.alert('서비스 이용이 가능할 때 조회할 수 있습니다');
							}
						},
						use: function(data,$cell,grid){
							return $cell.data('alopexgrid-key')=="log" && data.isPod && !isSlowLogHidden;	
						}
					}
				],
				renderMapping : {
					'replicationStatus' : {
						renderer: function(value, data, render, mapping) {
							var replicationStatus = '-';
							if (gService.slaveStatus != null) {
								replicationStatus = gService.slaveStatus.replicationStatus;
							} else {
								replicationStatus = '-';
							}
							
							if(data.serviceType == 'redis') {
								return null;
							} else {
								if(gParam.serviceType=='mariadb' && data.role == 'master') {
									return '-';
								} else if (gParam.serviceType=='mariadb' && data.role == 'slave') {
									if(data.status == 'red') {
										return '<div id="replicationTooltip" class="state red"></div>';
									}
									if(gService.slaveStatus != null) {
										if(replicationStatus == 'ok') {
											return '<div id="replicationTooltip" class="state green"></div>';
										} else if(replicationStatus == 'warning') {
											return '<div id="replicationTooltip" class="state yellow"></div>';
										} else if (replicationStatus == 'error') {
											return '<div id="replicationTooltip" class="state red"></div>';
										} else if(replicationStatus == 'over') {
											return '<div id="replicationTooltip">조회 실패</div>';
										} 
									}
								} 
							}
						}
					},
					'setBackupStorage' : {
						renderer: function(value, data, render, mapping) {
							let re = "-";
							switch(gParam.serviceType){
								case cServiceType.mariadb:
									if(data.isPod && data.role == 'master'){
										if(gService.clusterEnabled){
											re = "-";
										} else {
											var dl = gService.diskUsageOfPodMap;
											if(dl[data.name].length > 1) {
												for(var i = 0; i < dl[data.name].length; i++){
													var path = dl[data.name][i].path;
													if(path.startsWith('/backup')) {
														re = cloudUtil.convertSize(dl[data.name][i].size);
													} 
												}
											} else {
												re = "-";
											}
										}
									}else if(data.isPod && data.role == 'slave'){
										var dl = gService.diskUsageOfPodMap;
										if(dl[data.name].length > 1) {
											for(var i = 0; i < dl[data.name].length; i++){
												var path = dl[data.name][i].path;
												if(path.startsWith('/backup')) {
													re = cloudUtil.convertSize(dl[data.name][i].size);
												} 
											}
										} else {
											re = "-";
										}
									}else {
										re = "-";
									}
									break;
								case cServiceType.redis:
									if(data.role == 'master'){
										re = "-";
									}else if(data.role == 'slave'){
										re = "-";
									}
									break;
							}	
							return re;
						}
					},
					'setTerm' : {
						renderer: function(value, data, render, mapping) {
							var lt = data.condition? data.condition.lastTransitionTime : '';
							if(lt){
								var d = new Date();
								var isValid = moment(lt).isValid();
								var ltDate = new Date(lt);
								
								var different = d.getTime() - ltDate.getTime();
								
								var secondsInMilli = 1000;
								var minutesInMilli = secondsInMilli * 60;
								var hoursInMilli = minutesInMilli * 60;
								var daysInMilli = hoursInMilli * 24;
								
								var elapsedDays = different / daysInMilli;
								different = different % daysInMilli;
								
								var elapsedHours = different / hoursInMilli;
								different = different % hoursInMilli;
								
								var elapsedMinutes = different / minutesInMilli;
								different = different % minutesInMilli;
								
								var elapsedSeconds = different / secondsInMilli;
								
								if (elapsedDays > 0) {
									return Math.floor(elapsedDays) + "일";
								} else if (elapsedHours > 0) {
									return Math.floor(elapsedHours) + "시간";
								} else if (elapsedMinutes > 0) {
									return Math.floor(elapsedMinutes) + "분";
								} else if (elapsedSeconds > 0) {
									return Math.floor(elapsedSeconds) + "초";
								} else {
									return "-";
								}
							}
						}
					}
				},
				columnMapping : [
					{ title:'', key : 'status' , width: '40px', align: 'center',render : function( value, data, render, mapping) {
						var re = '';
						if(data.status == 'green'){
							re = '<button class="Button btn-ico btn-config__save" title=""></button>';
						}else if(data.status == 'red'){
							re = '<button class="btn-ico del" title=""></button>';
						}
						return re;
					}},
					//{ title:'Name', key : 'name', width : '300px', align: 'left', colspanTo : function(value, data, mapping) {
					{ title:'이름', key : 'name', width : '300px', align: 'left', colspanTo : function(value, data, mapping) {
						if(data.colspanCol){
							return isSlowLogHidden ? 'log' : 'slowLog';
						};
					},render: function(value,data){
						var re = '';
						if (data.colspanCol == true) {
							re = '<span class="warn-text"> Message : '+data.condition.reason+":"+data.condition.message+'</span>';
						}else{
							re = (data.isPod?'':'')+value;
						};
						return re;
					}},
					//{ title:'Replicas', key : 'replicas' , width: '70px', align: 'center'},
					{ title:'인스턴스 수', key : 'replicas' , width: '100px', align: 'center'},
					//{ title:'Replication', key : 'replication' , width:(gParam.serviceType=='redis'?'0':'90px'), align: 'center', tooltip: false, render : {type: "replicationStatus"
					{ title:'복제', key : 'replication' , width:(gParam.serviceType=='redis'?'0':'90px'), align: 'center', tooltip: false, render : {type: "replicationStatus"
					}},
					//{ title:'Role', key : 'role' , width: '90px', align: 'center', render : function(value, data){
					{ title:'역할', key : 'role' , width: '90px', align: 'center', render : function(value, data){
						
						let re = '';
						let roleIcon = {
							master : '<img src="/styles/images/master.png" style="width: 16px;height: 16px;">',
							slave : '<img src="/styles/images/slave.png" style="width: 16px;height: 16px;">'
						}
						let masterPod = gridResource.alopexGrid('dataGet')[0]
						switch(gParam.serviceType){
							case cServiceType.mariadb:
								if(data.role == 'master'){
									if(data.svc &&  data.svc.spec.selector.component == 'master'){
										re = roleIcon.master
									}
								}else if(data.role == 'slave'){
									if(data.svc){
										if(masterPod.svc.spec.selector.component == 'slave'){
											re = roleIcon.master
										}else{
											re = roleIcon.slave
										} 
									}
								}
								break;
							case cServiceType.redis:
								if(data.role == 'master'){
									if(data.svc && data.svc.spec.selector.role == 'master'){
										re = roleIcon.master
									}
								}else if(data.role == 'slave'){
									if(data.svc){
										if(masterPod.svc.spec.selector.role == 'slave'){
											re = roleIcon.master
										}else{
											re = roleIcon.slave
										}
									}
								}
								break;
						}
						
						return re;
					}},
					//{ title:'Node', key : 'node' , width: '130px', align: 'center'},
					{ title:'노드', key : 'node' , width: '130px', align: 'center'},
					//{ title:'Disk(Gi)', key : 'disk' , width: '140px', align: 'center',tooltip : function(value, data, mapping){
					{ title:'데이터 Disk', key : 'disk' , width: '140px', align: 'center', tooltip : function(value, data, mapping){
						if(data.diskUpdateTime){
							var isValid = moment(data.diskUpdateTime,'YYYYMMDDHHmmss').isValid();
							if(isValid) {
								var d = moment(data.diskUpdateTime,'YYYYMMDDHHmmss').format('YYYY-MM-DD HH:mm:ss');
								var ut = new Date(d);
								ut.setHours(ut.getHours()+9);
								var dUT = getTimeStamp(ut);
								return 'Update Time : '+dUT;
							} else {
								var ut = new Date(data.diskUpdateTime);
								var dUT = getTimeStamp(ut);
								return 'Update Time : '+dUT;
							}
						};
					}},
					{ title:'백업 Disk', key : 'backupStorage' , width: '120px', align: 'center', hidden: true, render : {type: "setBackupStorage"
					}},
					{ title:'CPU(m)', key : 'cpu' , width: '120px', align: 'center'},
					{ title:'Memory(Mi)', key : 'memory' , width: '180px', align: 'center'},
					//{ title:'Last Uptime', key : 'lastTransitionTime' , width: '150px', align: 'center', render: function(value,data){
					{ title:'기간', key : 'lastTransitionTime' , width: '150px', align: 'center', render : {type: "setTerm"}, tooltip : function(value, data, mapping){
						var lTT = data.condition? data.condition.lastTransitionTime : '';
						if(lTT){
							var d = moment(lTT,'YYYYMMDDHHmmss').format('YYYY-MM-DD HH:mm:ss');
							var lt = new Date(d);
							lt.setHours(lt.getHours()+9);
							var dLT = getTimeStamp(lt);
							return 'Last Transition Time : '+dLT;
						}
					}},
					{ title:'Action',key:'restart',width:'60px', align: 'center',hidden:(!gIsClusterAdmin&&!gIsZdbAdmin),render: function( value, data, render, mapping,cell){
						return getGridContextButton();
					}},
					//{ title:'Log',key:'log',width:'50px', align: 'center',render: function( value, data, render, mapping){
					{ title:'로그',key:'log',width:'50px', align: 'center',render: function( value, data, render, mapping){
						if(!data.isPod)return'';
						return getGridContextButton();
					}}
				],
			});
			//서비스 정보 조회
			function fn_getServiceFirst(){
				var deferred = $.Deferred();
				$a.ajax({
					url: '/zdbapi/getServiceoverview',
					data:gParam,
					success: function(res){
						if(!res.serviceoverview){
							console.log('no data'); return;
						};
						var service = gfn_convertServiceData(res.serviceoverview);
						gCurrentNamespace = service.namespace;
						gService = service;
						gTagList = service.tags;
						fn_displayService();
						fn_getServiceCallback();
						
						if(gService.backupDiskUsed){
							$("#gridResource").alopexGrid('showCol', 'backupStorage');
						} else {
							$("#gridResource").alopexGrid('hideCol', 'backupStorage'); // 백업Disk hide Test
						}
					},complete:function(res){
						deferred.resolve(res.responseJSON);
					}
				});
				return deferred.promise();
			};
			//서비스 정보 조회
			var gClient = null;
			function fn_getService(){
				if(gClient!= null)return;
				try{
					var gClient = gZdbsocket.getConnect();
					gClient.connect({}, function(frame){
						gClient.subscribe('/service/'+gService.serviceName, function(res) {
							var re = JSON.parse(res.body);
							var service = gfn_convertServiceData(re.result.serviceoverview);
							gCurrentNamespace = service.namespace;
							gService = service;
							gTagList = service.tags;
							fn_displayService();
							fn_getServiceCallback();
							
							if(gService.backupDiskUsed){
								$("#gridResource").alopexGrid('showCol', 'backupStorage');
							} else {
								$("#gridResource").alopexGrid('hideCol', 'backupStorage'); // 백업Disk hide Test
							}
						});
						//gClient.subscribe('/service/'+gService.serviceName+'/refresh', function(res) {
						//	fn_getServiceFirst();
						//});
					});
				}catch(e){
					console.log('socket connect error')
					console.log(e);
				}
			}
			function fn_getConnectionInfo(){
				$a.ajax({
					url: '/zdbapi/getConnectionInfo',
					data:gParam,
					success: function(res){
						let connectionInfo = res.connectionInfo || {};
						connectionInfo.credential = atob(connectionInfo.credetial);
						let connectionList = connectionInfo.connectionList;
						
						$('#connectionInfoTable').zdbui_setContents(connectionInfo);
						if(connectionList && connectionList.length>0){
							for(var i=0; i < connectionList.length ;i++){
								var ob = connectionList[i];
								$('input[name='+ob.connectionType+ob.role+'ConnectionString]').val(ob.connectionString).attr('data-origin',ob.connectionString);
								$('input[name='+ob.connectionType+ob.role+'ConnectionLine]').val(ob.connectionLine).attr('data-origin',ob.connectionLine);
							};
						};

						if(gConfigData.public_network_enabled == 'false'){
							$('tbody.publicNetworkTbody').hide();
						}else if(gService.publicEnabled != true){
							$('.publicConnectionInfo').hide();
							$('.publicConnectionInfoNone').show();
						}else{
							$('.publicConnectionInfo').show();
							$('.publicConnectionInfoNone').hide();
						};
						
						if(gService.clusterEnabled != true){
							$('#connectionInfoTable').find('tr.slaveConnection').hide();
							$('#connectionInfoTable').find('th[rowspan]').attr('rowspan',1);
						}else{
							$('#connectionInfoTable').find('th[rowspan]').attr('rowspan',2);
						};
						setConnectionString();
					}
				});
			};

			function fn_getServiceCallback(){
				//안내 메세지 출력
				let infoMsg = $('#divInfoMsg');
				let msg = gService.statusMessage||'';
				/* msg가 없는 경우에 대한 조건 처리 추가 (2019-07-11) */
				if(msg != '' ){
					//let t = $('<div class="Tooltip"></div>').html(msg);
					//infoMsg.after(t);
					//$a.convert(t);
					let m = msg.split('</br>');
					if(m && m.length > 1){
						msg = m[0]+'</br>'+m[1];
					}
				}
				infoMsg.html(msg);
				//service 상태가 GREEN이 아니면 탭이동 불가(스케일, 백업, 사용자, 환경설정, 프로세스)설정 
				// 백업은 대상에서 제외 (2019-08-01)
				var tabDisList = ['tabUser','tabDatabase','tabSystem','tabProcess']; 
				if(gService.serviceType == cServiceType.mariadb){ //mariadb 면 tabSystem 이동되도록
					tabDisList.splice(tabDisList.indexOf('tabSystem'),1);
				};
				var isStatusGreen = gService.status == 'green'; 
				for(var ti = 0; ti < $('#zdbServiceTabs').getLength(); ti++ ){
					if(isStatusGreen || tabDisList.indexOf($('#zdbServiceTabs').getTabContentByIndex(ti).id) < 0){
						$('#zdbServiceTabs').setEnabled(true,ti);
					}else{
						$('#zdbServiceTabs').setEnabled(false,ti);
					}
				};
				//service 상태가 green이 아니고 현재 탭이 disable탭에 속하면 서비스 탭으로 이동
				if(!isStatusGreen && tabDisList.indexOf($.cookie('selected2010tab')) > -1){  
					$('#zdbServiceTabs').setTabByContent('#tabService');
				};
				 //redis - user,database탭 삭제, purpose - data가 아니면 백업탭 삭제, 환경설정의 AdvancedConfig 숨김
				if(gService.serviceType == cServiceType.redis){
				let delTab = ['tabUser','tabDatabase','tabLog','tabProcess','tabMariadb'];
					if(gCommon.findObjectByKeyOb(gService.tags,{tagName:'data'})==null){
						$('#tabSystem #divAdvancedConfig').hide();
						delTab.push('tabBackup');
					};
					for(var ti = $('#zdbServiceTabs').getLength()-1; ti > -1; ti-- ){
						if(delTab.indexOf($('#zdbServiceTabs').getTabContentByIndex(ti).id) > -1){
							$('#zdbServiceTabs').removeTab(ti);
						};
					};
					if(gService.clusterEnabled != true){
						$('li#divScaleOut').hide();
					};
				}else{
					let delTab = ['tabUser','tabSystem','tabProcess'];
					for(var ti = $('#zdbServiceTabs').getLength()-1; ti > -1; ti-- ){
						if(delTab.indexOf($('#zdbServiceTabs').getTabContentByIndex(ti).id) > -1){
							$('#zdbServiceTabs').removeTab(ti);
						};
					};
				};
				
				var StorageQoSTooltipMsg = "";
				var dataIops = "";
				var backupIops = "";
				
				var rsSpec = gCommon.getObjectByIdx(gService.resourceSpecOfPodMap,0)||{};
				var psSpec = gCommon.getObjectByIdx(gService.persistenceSpecOfPodMap,0)||{};
				var pvSpec = gService.persistentVolumeClaims;
				
				gServiceScale.cpu = rsSpec.cpu;
				gServiceScale.memory = rsSpec.memory;
				gServiceScale.cpuVal = cloudUtil.parseInt(gServiceScale.cpu);
				gServiceScale.memoryVal = cloudUtil.parseInt(gServiceScale.memory);
				gServiceScale.disk = psSpec.size;
				gServiceScale.storageClass = '';
				let resorceSpec = gService.resourceSpec||{};
				let persistenceSpec = gService.persistenceSpec||{};
				
				var totalStorage = 0;
				
				var podData = (function(){
					var list = [];					
					var pods = gService.pods;
					for(var i = 0 ; i < pods.length; i++){
						var pod = pods[i];
						var condition = gfn_getReadyCondition(pod);
						var role = ""; 
						if(gService.serviceType == 'redis'){
							if(pod.metadata.labels.role == "metrics")continue;
							else if(pod.metadata.labels.role == 'slave'){
								role = 'slave(readOnly)'; 
							}else{
								role = pod.metadata.labels.role;
							}
						}else{
							role = pod.metadata.labels.component;
						};
						list.push({
							isPod:true,
							name: pod.metadata.name,
							condition: condition,
							node: pod.spec.nodeName,
							colspanCol: false,
							stName: pod.metadata.name.replace(/(\-[\d]+)$/g,''),
							role: role
						});	
					}
					return list; 
				}());
				
				var StorageTooltipMsg = "";
				
				//cpu,memory,disk resource 셋팅 -test0806  
				podData = (function(data){
					var list = [];
					var hasUseRateBackup = false;
					var backupStorage = null;
					for(var i = 0 ; i < data.length;i++){
						var ob = data[i];
						try{
							var cl = gService.cpuUsageOfPodMap;
							var ml = gService.memoryUsageOfPodMap;
							var dl = gService.diskUsageOfPodMap;
							
							
							//console.log(cl);console.log(ml);console.log(cl);console.log(gService);
							
							if(cl && cl[ob.name]){
								var cpuUsage = cl[ob.name];
								var cpuUsageVal = cloudUtil.truncDecimal(cpuUsage.length ?(cloudUtil.parseInt(cpuUsage[cpuUsage.length-1].value) / cloudUtil.parseInt(gService.resourceSpecOfPodMap[ob.name].cpu))*100 :''); //usage 추가 (2019-08-07)

								//ob.cpu = (cpuUsage.length ? cpuUsage[cpuUsage.length-1].value:'') / 1000 + ' / ' + gService.resourceSpecOfPodMap[ob.name].cpu;
								ob.cpu = (cpuUsage.length ? cpuUsage[cpuUsage.length-1].value:'') + 'm / ' + gService.resourceSpecOfPodMap[ob.name].cpu + ' ('+cpuUsageVal+'%)'; //단위를 맞추기 위해 /1000 삭제적용 (2019-08-07)
							} else {
								ob.cpu = gService.resourceSpecOfPodMap[ob.name].cpu; 
								//ob.cpu = resorceSpec.cpu;  // 상단 수치와 일치 작업 수정 (2019-08-06) - 재수정
							}
							if(ml && ml[ob.name]){
								var memUsage = ml[ob.name];
								var memUsageVal = cloudUtil.truncDecimal(memUsage.length ?(cloudUtil.parseInt(memUsage[memUsage.length-1].value) / cloudUtil.parseInt(gService.resourceSpecOfPodMap[ob.name].memory))*100 :'');

								ob.memory = cloudUtil.truncDecimal(((memUsage.length? memUsage[memUsage.length-1].value:'')),2) + 'Mi / ' + gService.resourceSpecOfPodMap[ob.name].memory + ' ('+memUsageVal+'%)'; //usage 추가 (2019-08-07)
							} else {
								ob.memory = gService.resourceSpecOfPodMap[ob.name].memory; 
								//ob.memory = resorceSpec.memory;		// 상단 수치와 일치 작업 수정 (2019-08-06)	-재수정					
							}
							var dataStorage = null;
							
							if(gService.serviceType == 'redis' && gService.purpose != 'DATA' && gService.persistentVolumeClaims.length == 0){
								ob.disk = '사용안함';
							} else if(dl && dl[ob.name]){
								if(dl[ob.name].length == 1) {
									dataStorage = dl[ob.name][0];
								} else if(dl[ob.name].length > 1) {
									for(var ii = 0 ; ii < dl[ob.name].length;ii++){
										var path = dl[ob.name][ii].path;
										if(path.startsWith('/bitnami')) {
											dataStorage = dl[ob.name][ii];
										} else if(path.startsWith('/backup')) {
											backupStorage = dl[ob.name][ii];
										}
									}
								} else if(dl[ob.name].length == 0) {
									ob.disk = '사용안함';
								}
								
								if(dataStorage != null) {
									dataIops = dataStorage.storageIops.toUpperCase();
									
									var hasUseRateData = dataStorage.useRate?true:false;
									if(backupStorage != null) {
										hasUseRateBackup = backupStorage.useRate?true:false;
									}
									totalStorage += dataStorage.size;
									
									ob.disk = cloudUtil.truncDecimal((dataStorage.used / (1024*1024)),2) + ' / ' + (hasUseRateData? cloudUtil.convertDiskSize(dataStorage.size) :(gServiceScale.disk||'N/A')) 
									        + (hasUseRateData? ' ('+dataStorage.useRate+')' : '' ) ;
									ob.diskUpdateTime = dataStorage.updateTime;
									
									var storageSize = hasUseRateData? cloudUtil.convertDiskSize(dataStorage.size) :(gServiceScale.disk||'N/A');
									StorageTooltipMsg += ob.role + "(Data): " + storageSize + "<br>";
									
									if(dataIops != "") {
										if(dataStorage.storageClass.indexOf("custom") == -1) {
											var enduranceIops = cStorageClassConstants[dataStorage.storageClass];
											StorageQoSTooltipMsg += ob.role + "("+enduranceIops+" IOPS/GB): " + dataIops + " IOPS<br>";
										} else {
											StorageQoSTooltipMsg += ob.role + "("+dataIops+" IOPS/GB): " + dataIops + " IOPS<br>";
										}
										
										if(ob.role == "master"){
											gServiceScale.storageClass = dataIops + " IOPS<br>";
										}
									}
								}
							};
						}catch(e){ 
							
						}
					
						list.push(ob);
					};
					

					if(backupStorage != null) {
						backupIops = backupStorage.storageIops.toUpperCase();;
						
						var backupStorageSize = hasUseRateBackup? cloudUtil.convertDiskSize(backupStorage.size) :(gServiceScale.disk||'N/A');
						StorageTooltipMsg += "Backup: " + backupStorageSize  + "<br>";
						
						if(backupIops != "") {
							StorageQoSTooltipMsg += "Backup(2 IOPS/GB): " + backupIops + " IOPS<br>"; // BackupDisk iops는 항상 2 IOPS/GB (2019-08-06)
						}
						totalStorage += backupStorage.size;
					}

					$('#configInfo').zdbui_setContents(
							{ cpu:resorceSpec.cpu||''
							 ,memory:resorceSpec.memory||''
							 ,disk:totalStorage==0?'사용안함':cloudUtil.convertDiskSize(totalStorage)||''
							 ,storageClass:gServiceScale.storageClass
							}
						);
					return list;
				}(podData));
				//error row 임의 생성
				var tList = [];
				
				var services = gService.services;
				var isMasterRed = false;
				var isSlaveGreen = false;
				var statefulSets = gService.statefulSets;
				var deployments = gService.deployments;
				
				var AllocatedCPUTooltipMsg = "";
				var AllocatedMemoryTooltipMsg = "";

				addResourceList('statefulSets',statefulSets);
				addResourceList('deployments',deployments);
				function addResourceList(tp,li){
					for(let i=0;i<li.length;i++){
						let t = li[i];
						var replicas = t.spec.replicas;
						var role = ""; 
						var svc = "";
						if(gService.serviceType == 'redis'){
							if(t.metadata.labels.role == "metrics")continue;
							else if(t.metadata.labels.role == 'slave'){
								role = 'slave(readOnly)'; 
							}else{
								role = t.spec.selector.matchLabels.role;
							}
						}else{
							role = t.metadata.labels.component;
						};		

						for(var j = 0 ; j < services.length; j++){
							var service = services[j];
							var svc_role = '';
							if(gService.serviceType == 'redis'){
								if( service.metadata.name.endsWith('master') ) {
									svc_role = 'master';
								} else if( service.metadata.name.endsWith('slave') ) {
									svc_role = 'slave';
								}
							} else if(gService.serviceType == 'mariadb'){
								svc_role = service.metadata.labels.component
							}
							
							if(role == svc_role) {
								svc = service;
								break;
							}
						}
						
						var pod = null;
						var dt = {  //메세지용 임의 row 데이터
								isPod:false,
								status: (replicas > 0 && replicas == t.status.readyReplicas ? 'green' : 'red'),
								name:t.metadata.name, replicas:replicas, role: role, svc: svc,
								serviceType: gService.serviceType,
								cpu:gServiceScale.cpu,
								memory:gServiceScale.memory,
								colspanCol:false
							};
						
						if(dt.status == 'green') {
							if(tp=='statefulSets'){
								pod = gCommon.findObjectByKeyOb(podData,{stName:dt.name});
							}else if(tp=='deployments'){
								if(podData != null) {
									for(var k = 0 ; k < podData.length; k++){
										var p = podData[k];
										if(p.name.startsWith(dt.name)) {
											pod = p;
											break;
										}
									}								
								}
							}
							if(dt.role == 'slave'){
								isSlaveGreen = true;
							}
						}else{
							if(dt.status == 'red' && dt.role == 'master'){
								isMasterRed = true;
							}						
						}
						
						if(pod != null){
							pod.status = dt.status;
							pod.role = dt.role;
							pod.svc = dt.svc;
							pod.replicas=dt.replicas;
							pod.serviceType = gService.serviceType;
							pod.stName = dt.name;
							tList.push(pod);
							if(pod.condition && pod.condition.status != 'True'){ 
								var tPod = $.extend({},pod,{colspanCol:true})
								tList.push(tPod);
							};
						} else {
							tList.push(dt);
						}
						var tempMsg = "";
						
						tempMsg = dt.role+"(DB): "+dt.cpu+"<br>"+dt.role+"(Monitoring): 100m<br>";
						AllocatedCPUTooltipMsg += tempMsg;
						
						tempMsg = dt.role+"(DB): "+dt.memory+"<br>"+dt.role+"(Monitoring): 64Mi<br>";
						AllocatedMemoryTooltipMsg += tempMsg;
						
					}
				};
				$('#gridResource').alopexGrid('dataSet',tList);//dataset
				if (gService.slaveStatus != null) {
					$('#replicationTooltipMsg').html(gService.slaveStatus.message).tooltip();
				}
				$('#AllocatedCPUTooltipMsg').html(AllocatedCPUTooltipMsg).tooltip();
				$('#AllocatedMemoryTooltipMsg').html(AllocatedMemoryTooltipMsg).tooltip();
				$('#StorageTooltipMsg').html(StorageTooltipMsg).tooltip();
				$('#StorageQoSTooltipMsg').html(StorageQoSTooltipMsg).tooltip();
				
				//failover 설정
				//mariadb는 statefulSets이 2개일경우, redis는 deployments가 존재 할 경우 활성화
				let bFailoverEnable = false;
				if((gParam.serviceType == cServiceType.mariadb && gService.statefulSets.length > 1) || 
				   (gParam.serviceType == cServiceType.redis && gService.deployments.length > 0)){
					bFailoverEnable = true;
				}
				if(bFailoverEnable == true && (gIsClusterAdmin || gIsZdbAdmin)){
					//auto_failover 는 현재 mariadb만 제공
					if(gParam.serviceType == cServiceType.mariadb && gConfigData.auto_failover_enabled=='true'){
						if(gService.failoverEnabled == 'running'){
							$('#divFailoverRunning').show();
							$('#divFailoverOnOff').hide();
						}else{
							$('#divFailoverRunning').hide();
							$('#divFailoverOnOff').show();
							setOnOffButton('failOverEnable',(gService.failoverEnabled=='on'?'Y':'N'));
						}
						$('#divFailover').show();
					}else{
						$('#divFailover').hide();
					}
					
					if((isMasterRed && isSlaveGreen)|| gService.serviceFailOverStatus == 'MasterToSlave'){
						$('#divFailoverArea').show();
					}else{
						$('#divFailoverArea').hide();
					}
					if(gService.serviceFailOverStatus == 'MasterToSlave'){
						$('#divFailoverBtn').hide();
						$('#divFailbackBtn').show();
					}else{
						$('#divFailoverBtn').show();
						$('#divFailbackBtn').hide();
					}
				}else{
					$('#divFailover').hide();
				}
				//tabService end
				
				//tabScale 스케일
				if($('#zdbServiceTabs').getCurrentTabContent()!= '#tabScale'){
					fn_setSlider('memory',gServiceScale.memoryVal);
					$('#tabScale').find('input[name="scaleCpu"]').val(gServiceScale.cpuVal);
					$('#tabScale').find('input[name="scaleMemory"]').val(gServiceScale.memoryVal);
					$('#clusterSlaveCount').val(gService.clusterSlaveCount);
					//todo temp
					var isCustom = gSliderConstants[gParam.serviceType].cpu.value.indexOf(gServiceScale.cpuVal) < 0
								 ||gSliderConstants[gParam.serviceType].memory.value.indexOf(gServiceScale.memoryVal) < 0;
					if(isCustom){
						$('#tabScale input[name=scaleType][value=custom]').trigger('click');
					}else{
						$('#tabScale input[name=scaleType][value=progress]').trigger('click');
					};
					
					//setScaleButton();
				}
				//tabMonitor  mariadb replication은 single모드가 아닐경우만 show				
				if(gParam.serviceType == cServiceType.mariadb && gService.statefulSets.length > 1){
					$('#tabMonitor #areaMonitorReplication').show();
				}
				
				//tabBackup 
				$('#divAddBackup').find('button').hide();
				if(gService.serviceType != cServiceType.redis){
					if(gService.ondiskFlag == true){
						$('#divAddBackup').find('#removeBackupDisk').show();
						$("#gridBackup").alopexGrid('showCol', 'ondisk');
					}else{
						$('#divAddBackup').find('#addBackupDisk').show();
						$("#gridBackup").alopexGrid('hideCol', 'ondisk');
					}
				}
			}
			//서비스 display
			function fn_displayService(){
				var ob = gService;
				var serviceDiv = $('#divService');
				
				serviceDiv.html('');
				serviceDiv.html(gfn_getServiceDetailTemplate({
					namespace:ob.namespace,
					serviceType:ob.serviceType,
					serviceName:ob.serviceName,
					status:ob.status.toLowerCase(),
					statusMessage:ob.statusMessage||'',
					version:ob.version,
					crtTime:ob.crtTime,
					elapsedTime:ob.elapsedTime,
					tagList:ob.tags
				}));
			};
			
			$('#connectionInfoTable').find(':radio[name^=con]').on('change',function(){
				$(this).parent().parent().parent().find('div.info-input__wrap').hide().filter('div.'+$(this).val()).show();
			});
			$(document).on('click','.connectionStringCopy,.connectionLineCopy,#credentialCopy',function(e){
				var target = e.target.id == "credentialCopy" ? $('#credential') : $(this).prev();
				var msg = '';
				if(target.val() == ''){
					msg = '복사할 내용이 없습니다.';	
				}else{
					gCommon.copyToClipboard(target);
					if(target.get(0).id == 'credential'){
						msg = 'Credential이 복사되었습니다';
					}else if(target.get(0).name.indexOf('ConnectionString')>-1){
					    msg = 'Connection String이 복사되었습니다.';
					}else{
					    msg = 'Connection Line이 복사되었습니다.';
					}
				}
				var ob = $(this).parent().parent().find(".connectionInfoCopyed").html(msg).show();
				setTimeout(function(){
					ob.hide(1000);
				},1000);
			})			
			tabService.find('#publicNetworkDelete').on('click',function(){
				if(gCommon.confirm('Public Network 서비스 삭제시 </br> 외부연동이 단절됩니다. <br/> 삭제하시겠습니까?',function(){
					$a.ajax({
						url: '/zdbapi/deletePublicService',
						data:gParam,
						success: function(res){
							fn_getServiceFirst().done(function(){
								fn_getConnectionInfo(); 
							});
						}
					});
				},{okBtnMsg:"삭제"}));
			});
			tabService.find('#publicNetworkCreate').on('click',function(){
				if(gCommon.confirm('Public Network를 추가 하시겠습니까?',function(){
					$a.ajax({
						url: '/zdbapi/createPublicService',
						data:gParam,
						method:'post',
						success: function(res){
							fn_getServiceFirst().done(function(){
								fn_getConnectionInfo(); 
							}); 
						}
					});
				},{okBtnMsg:"추가"}));
			});
			tabService.find('.onoff-wrap > button').click(function(e){
				e.preventDefault();
				let isEnable = 'Y';
				if($(this).hasClass('btn-on')) {
					isEnable = 'N';
				};				
			
				let param = $.extend({},gParam,{enable:isEnable == 'Y'});
				let msg = "Auto Failover 기능을 적용합니다.<br>처음적용시 서비스가 재시작 됩니다." ;
				gCommon.confirm(msg,function(yn){
					gCommon.credentialConfirm({
				        data:{credential:$("#credential").val(), msg:'설정을 변경하시려면', okBtnMsg:'변경'},
				        callback : function(res){
							$a.ajax({
								url: '/zdbapi/updateAutoFailoverEnable',
								method:'PUT',
								data:param,
								success: function(res){
									if(res.result.code!='4'){
										if(res.result.code!='0'){
											gCommon.alert(res.result.message);
										}
										fn_getServiceFirst();
										gCommon.getConfigData(gParam.namespace).done(function(re){
											gConfigData = re;
										});		
									}
								}
							})
				        }
				    });	
				}); 
			});
			tabService.find('#divFailoverBtn button').on('click',function(e){
				e.preventDefault();
				gCommon.credentialConfirm({
					data:{credential:$("#credential").val(), msg:'failover 수행을 하시려면', okBtnMsg:'변경'},
					callback : function(res){
						$a.ajax({
							url: '/zdbapi/serviceChangeMasterToSlave',
							method:'PUT',
							data:gParam,
							success: function(res){
								gCommon.alert(res.result.message);
								fn_getServiceFirst()
							}
						})	
					}
				});
			})
			tabService.find('#divFailbackBtn button').on('click',function(e){
				e.preventDefault();
				gCommon.credentialConfirm({
					data:{credential:$("#credential").val(), msg:'failback 수행을 하시려면', okBtnMsg:'변경'},
					callback : function(res){
						$a.ajax({
							url: '/zdbapi/serviceChangeSlaveToMaster',
							method:'PUT',
							data:gParam,
							success: function(res){
								gCommon.alert(res.result.message);
								fn_getServiceFirst()
							}
						})	
					}
				});
			})
			/*tabService end*/
			
			/*tabScale start 스케일 */
			var memorySlider = document.getElementById('memorySlider');
			var sliderConstants = gSliderConstants[gParam.serviceType];
			noUiSlider.create(memorySlider, {
				start:[1],
				snap: true,
				connect: [true,false],
				range: sliderConstants.memory.range,
				pips: {
					mode: 'steps',
					density: 100,
					format: {
					  to: function ( value ) {
					      return sliderConstants.memory.getValue(value);
					  },
					  from: function ( value ) {
					      return value;
					  }
					}
				}
			}).on('slide', function ( values, handle ) {
				fn_setSliderText('memory',parseInt(values[handle]));
			});
			//set슬라이더 값 
			function fn_setSlider(type,value){
				var slider = $('#'+type+'Slider')[0];
				var idx = sliderConstants[type].getIndex(value);
				
				slider.noUiSlider.set(idx);
				fn_setSliderText(type,idx)
			};
			//set슬라이더 값 텍스트
			function fn_setSliderText(type,idx){
				$('#'+type+'Info').html(sliderConstants[type].getValue(idx));
				setScaleButton();
			};
			
			$('#updateScaleUp').on('click',function(){
				if($(this).hasClass('Disabled'))return;
				
				if(gCommon.confirm('Scale Up/Down이 수행되면 서비스가 재시작됩니다. 계속 진행하시겠습니까?',function(){
					var data = $.extend({},gParam,{});
					var scaleType = $('#tabScale').find('input[name=scaleType]:checked').val();
					if(scaleType == 'custom'){
						data.cpu = cloudUtil.parseInt($('#tabScale').find('input[name=scaleCpu]').val());
						data.memory = cloudUtil.parseInt($('#tabScale').find('input[name=scaleMemory]').val());
					}else if(scaleType == 'progress'){
						data.cpu = gSliderConstants[gParam.serviceType].cpu.value[parseInt(memorySlider.noUiSlider.get())],
						data.memory = gSliderConstants[gParam.serviceType].memory.value[parseInt(memorySlider.noUiSlider.get())]
					};
					$a.ajax({
						url: '/zdbapi/updateScaleUp',
						data:data,
						success: function(res){
							if(res.result.code!='4'){
								gCommon.alert(res.result.message,function(){
									$('#zdbServiceTabs').setTabByContent('#tabService');
									fn_getServiceFirst(); 
								});
							};
						}
					});
				}));
			});
			$('#updateScaleOut').on('click',function(){
				if($(this).hasClass('Disabled'))return;
				if(gCommon.confirm('Slave 갯수를 '+$('input[name=clusterSlaveCount]').val()+' 개로 변경하시겠습니까?',function(){
					var data = $.extend({},gParam,{
						clusterSlaveCount:$('input[name=clusterSlaveCount]').val()
					});
					$a.ajax({
						url: '/zdbapi/updateScaleOut',
						data:data,
						success: function(res){
							if(res.result.code!='4'){
								gCommon.alert('스케일 정보를 수정 요청 하였습니다.');
							};
						}
					});
				}));
			});
			
			//레디스 경우 최대 노드 카운트를 가져온다
			if(gParam.serviceType == cServiceType.redis){
				$a.ajax({
					url: '/zdbapi/getNodeCount',
					data:data,
					success: function(res){
						$('#clusterSlaveCount').attr('max',res.nodes);
					}
				});				
			};
			
			$('#tabScale').find('input[type=text]').on('input',function(evt){
				setScaleButton();
			});
			$('#clusterSlaveCountSpinner').find('.Up,.Down').on('click',function(evt){
				setScaleButton();
			});
			//스케일 적용 버튼 활성 비활성
			function setScaleButton(){
				var chgData = {};
				var scaleType = $('#tabScale').find('input[name=scaleType]:checked').val();
				if(scaleType == 'custom'){
					chgData.cpu = cloudUtil.parseInt($('#tabScale').find('input[name=scaleCpu]').val());
					chgData.memory = cloudUtil.parseInt($('#tabScale').find('input[name=scaleMemory]').val());
				}else if(scaleType == 'progress'){
					chgData.cpu = gSliderConstants[gParam.serviceType].cpu.value[parseInt(memorySlider.noUiSlider.get())],
					chgData.memory = gSliderConstants[gParam.serviceType].memory.value[parseInt(memorySlider.noUiSlider.get())]
				};
				
				var isChange = gServiceScale.memoryVal != chgData.memory || gServiceScale.cpuVal != chgData.cpu ;
				
				if((scaleType == 'custom' && !$('form[name=scaleForm]').validate()) || !isChange || chgData.memory < 1){
					$('#updateScaleUp').addClass('Disabled');	
				}else{
					$('#updateScaleUp').removeClass('Disabled');
				};
				
				if($('#updateScaleOut').size()>0){
					var orgSlaveCount = gService.clusterSlaveCount;
					var chgSlaveCount = $('input[name=clusterSlaveCount]').val();
					
					if(orgSlaveCount == chgSlaveCount || chgSlaveCount < 1){
						$('#updateScaleOut').addClass('Disabled');	
					}else{
						$('#updateScaleOut').removeClass('Disabled');
					};
				}
			};
			$('#tabScale input:radio[name=scaleType]').on('change',function(){
				setDivScale(this.value);
				setScaleButton();
			});
			$('form[name=scaleForm]').validator({
			    elements :{ 
			        'scaleCpu': {rule:{required:true,min:100,max:20000}},
			        'scaleMemory': {rule:{required:true,min:128,max:32000}}
			    }
			});	
			//스케일 리소스선택or사용자입력
			function setDivScale(scaleType){
				$('#tabScale').find('#divScaleProgress,#divScaleCustom').hide();
				if(scaleType == 'custom'){
					$('#tabScale').find('#divScaleCustom').show();
				}else{
					$('#tabScale').find('#divScaleProgress').show();
				}
			}
			/*tabScale end 스케일*/

			/*tabMonitor start 모니터링*/
			function fn_getMonitoring(){
				fn_getPanels(gService);
			};
			function fn_getPanels(service){
				if(service.serviceType == "mariadb") {
					$('#advancedMonitoring').attr('href', gGrafanaUrl + "/d/zdbmaria1/mariadb-advanced?refresh=1m&orgId=1"
							+ "&var-user=" + gUserId
							+ "&var-namespace=" + service.namespace
							+ "&var-mariadbservice=" + service.serviceName + "-mariadb");
					var iframeSrc = gGrafanaUrl + "/d-solo/zdbmaria2/mariadb-summary?refresh=1m&orgId=1"
						+ "&var-namespace=" + service.namespace 
						+ "&var-service=" + service.serviceName + "-mariadb";
					/* System Resources */
					$('#panelCpu').find('iframe').attr('src',iframeSrc + "&panelId=1");
					$('#panelMemory').find('iframe').attr('src',iframeSrc + "&panelId=2");
					$('#panelNetwork').find('iframe').attr('src',iframeSrc + "&panelId=3");					
					/* Connection & Table */
					$('#panelConnections').find('iframe').attr('src',iframeSrc + "&panelId=4");					
					$('#panelThread').find('iframe').attr('src',iframeSrc + "&panelId=5");					
					$('#panelTablelack').find('iframe').attr('src',iframeSrc + "&panelId=6");					
					/* Query & Replication */
					$('#panelQps').find('iframe').attr('src',iframeSrc + "&panelId=7");
					$('#panelReplicationdelay').find('iframe').attr('src',iframeSrc + "&panelId=8");
					$('#panelSqlthread').find('iframe').attr('src',iframeSrc + "&panelId=9");
					$('#panelIothread').find('iframe').attr('src',iframeSrc + "&panelId=10");
				} else if (service.serviceType == "redis") {
					$('#advancedMonitoring').attr('href', gGrafanaUrl + "/d/zdbredis1/redis-advanced?refresh=1m&orgId=1"
							+ "&var-user=" + gUserId
							+ "&var-namespace=" + service.namespace
							+ "&var-redisservice=" + service.pods[0].spec.containers[0].name + "-master");
					var iframeSrc = gGrafanaUrl + "/d-solo/zdbredis2/redis-summary?refresh=1m&orgId=1"
						+ "&var-namespace=" + service.namespace 
						+ "&var-service=" + service.pods[0].spec.containers[0].name + "-master"
						+ "&var-container=" + service.pods[0].spec.containers[0].name;
					/* System Resources */
					$('#panelCpu').find('iframe').attr('src',iframeSrc + "&panelId=1");
					$('#panelMemory').find('iframe').attr('src',iframeSrc + "&panelId=2");
					$('#panelNetwork').find('iframe').attr('src',iframeSrc + "&panelId=3");
					/* Keys */
					$('#panelItems').find('iframe').attr('src',iframeSrc + "&panelId=4");
					$('#panelExpiringvsnot').find('iframe').attr('src',iframeSrc + "&panelId=5");
					$('#panelExpired').find('iframe').attr('src',iframeSrc + "&panelId=6");
					/* Commands */
					$('#panelExecuted').find('iframe').attr('src',iframeSrc + "&panelId=7");
					$('#panelHits').find('iframe').attr('src',iframeSrc + "&panelId=8");
					$('#panelCalls').find('iframe').attr('src',iframeSrc + "&panelId=9");
				}
				else {
					// TODO
				}
			}
			/*tabMonitor end 모니터링*/
			
			/* tabBackup start backup */
			let backupForm = $('form[name=backupForm]');
			let backupStatus = 'N';//Y 수정가능상태, N 수정불가 상태, I 수정중상태
			backupForm.find('#searchBackup').on('click',function(){
				fn_getBackupInfo();
			});
			backupForm.find('#backupSearchType').on('change',function(e){
				fn_filterBackupInfo();
			});
			backupForm.find('.onoff-wrap > button').click(function(e){
				e.preventDefault();
				if($(this).hasClass('btn-on')) {
					setBackupUseYnEvt('N');
				} else {
					setBackupUseYnEvt('Y');
				}
			});
			
			let throttleYnTooltipMsg = "백업 수행되는 속도를 저속으로 제어하는 모드 입니다.<br>백업 수행되는 중에 데이터베이스 서비스의 영향을 최소화 합니다." ; 
			$('#throttleYnTooltipMsg').html(throttleYnTooltipMsg).tooltip();
			
			$('button#saveSchedule').on('click',function(){
				if(backupStatus=='I'){
					gCommon.confirm('백업 설정을 수정 하시겠습니까?',function(){
						fn_saveSchedule();				
					});
				}else if(backupStatus=='Y'){
					backupStatus = 'I';
					setBackupBtnEnable();
				}
			});
			$('button#deleteBackup').on('click',function(){
				let dt = AlopexGrid.trimData(gridBackup.alopexGrid('dataGet',{_state:{selected:true}}));
				if(dt.length == 0){
					gCommon.alert('선택된 백업 데이터가 없습니다.');
					return;
				}
				gCommon.confirm('선택한 백업을 삭제 하시겠습니까?',function(){
					$a.ajax({
						url: '/zdbapi/deleteBackup',
						method:'put',
						data:{data:JSON.stringify(dt)},
						success: function(res){
							if(res.result.code!='4'){
								gCommon.alert('백업 삭제를 요청하였습니다.');
								fn_getBackupInfo();
							};
						}
					});	
				})
			});
			$('button#updateBackup').on('click',function(){
				$a.popup({
			        url: "/zdb02/zdb0200p06",
			        data:gParam,
			        iframe: false,
			        width: 500,
			        height: 300,
			        title : '',
			        callback : function(res){
			        	if(res.result == 'Y'){
			        		$a.ajax({
								url: '/zdbapi/updateBackup',
								data:$.extend({},gParam,{type:res.backupType}),
								success: function(res){
									if(res.result.code!='4'){
										gCommon.alert('즉시 백업을 요청하였습니다.');
										fn_getBackupInfo();
									};
								}
							});				        		
			        	}
			        }
			    });
			});
			$('button#abortedBackup').on('click',function(){
				let guid = gCommon.getUid();
				gCommon.credentialConfirm({
			        data:{credential:$("#credential").val(),msg:'백업을 중지하시려면',okBtnMsg:'중지'},
			        callback : function(res){
						$a.ajax({
							url:'/zdbapi/abortBackup',
							method:'put',
							data:$.extend({},gParam,{txId:guid}),
							success:function(res){
								console.log(res);
							}
						});	
			        }
			    });
			});		
			$('button#addBackupDisk').on('click',function(){
				/*backupdisk-test*/
				let vPodName = gService.podName ;  
				let diskSize = gService.diskUsageOfPodMap[vPodName][0].size; // gService.persistenceSpec.size; 수정 (2019-07-25)
				
				diskSize = cloudUtil.convertDiskSize(diskSize) ;
/* 				if(gService.statefulSets.length > 1){
					diskSize = cloudUtil.parseInt(diskSize) / 2 ;
				} */  // 주석처리 ; 수정 (2019-08-05)
				$a.popup({
				        data:$.extend({},gParam,{credential:$("#credential").val(),diskSize:diskSize}),
				        url: '/zdb02/zdb0200p08',
				        iframe: false,
				        width: 500,
				        height: 320,
				        title : '',
				        callback : function(res){
				        	if(res.result.code=='0'){
				        		fn_getServiceFirst(); 	        		
				        	}
				        }
				    });
			})			
			$('button#removeBackupDisk').on('click',function(){
				
				gCommon.credentialConfirm({
			        data:{credential:$("#credential").val(),msg:'백업 디스크를 제거하시려면',okBtnMsg:'제거'},
			        callback : function(res){
						$a.ajax({
							url:'/zdbapi/removeBackupDisk',
							method:'put',
							data:gParam,
							success:function(res){
								if(res.result.code=='0'){
									fn_getServiceFirst();
								}
							}
						});
			        }
			    });	
			})			
			let downloadTitle = '복원/다운로드';
			let bakcupLogShow = true;
			if(gParam.serviceType == cServiceType.redis){
				downloadTitle = '다운로드';
				// backup log  버튼 활성화 여부  bakcupLogShow = false; -> true 로 변경 (2019-07-04)
				bakcupLogShow = true;
			}
			let gridBackup = $('#gridBackup').alopexGrid({
				enableDefaultContextMenu:false,
				enableContextMenu:true,
				autoColumnIndex: true,
				autoResize:true,
				contextMenu : [
					{   title: '결과',
						processor:function(data,$cell,grid){
						$a.ajax({
								url:'/zdbapi/getBackupResult',
								data:{backupId:data.backupId},
								success:function(res){
									let ob = res.backupResult;
									let r = '<table><colgroup><col class="wd150"></col><col width="*"></col></colgroup>'
										if(!cloudUtil.isEmpty(ob.backupScope)) r+= '<tr><th class="tl">백업범위(LSN)</th><td class="tl">' + ob.backupScope + '</td></tr>' 
									 	if(!cloudUtil.isEmpty(ob.fromBackup)) r+='<tr><th class="tl">기준이 되는 백업</th><td class="tl">' + ob.fromBackup + '</td></tr>' 
										if(!cloudUtil.isEmpty(ob.archiveFileSize)) r+='<tr><th class="tl">압축파일크기</th><td class="tl">' + ob.archiveFileSize  +'</td></tr>' 
										if(!cloudUtil.isEmpty(ob.backupTime)) r+='<tr><th class="tl">백업 소요시간</th><td class="tl">' + ob.backupTime  + '</td></tr>' 
										if(!cloudUtil.isEmpty(ob.archiveTime)) r+='<tr><th class="tl">압축 소요시간</th><td class="tl">' + ob.archiveTime  + '</td></tr>' 
										if(!cloudUtil.isEmpty(ob.uploadTime)) r+='<tr><th class="tl">업로드 소요시간</th><td class="tl">' + ob.uploadTime  + '</td></tr>' 
										r+= '</table>';  							
									gCommon.backupAlert(r,null,{width:500,height:350});
								}
							}); 
						},
						use: function(data,$cell,grid){
							return bakcupLogShow && $cell.data('alopexgrid-key')=="log"
						}
					},
					{   title: '로그',
						processor:function(data,$cell,grid){
							
							//console.log('로그');	
							window.open("/zdb02/zdb0200p07?namespace="+gService.namespace+"&serviceName="+gService.serviceName+"&backupId="+data.backupId+'&time='+cloudUtil.dtFormat(data.startDatetime));
						},
						use: function(data,$cell,grid){
							return bakcupLogShow && $cell.data('alopexgrid-key')=="log"
						}
					}					
				],				
				height: 400,
				columnMapping : [
					{ key:'check',width:'30px',selectorColumn : true},
					{ title:'백업유형', key : 'type' , width: '100px', align: 'center',tooltip:false ,render:function(value,data,render,mapping){						
						let t = '';
						switch(value){
						    case 'INCR': t = '증분백업'; break;
						    case 'DUMP': t= '덤프백업'; break;
						    case 'FULL': t = '전체백업'; break;
						    default : t = '즉시백업'; break;
						}
						let reBtn = '<button class="Button gridbtn btn TooltipEvt">'+t+'</button>';
						if(data.scheduleYn == "N"){
							reBtn = '<a id="'+data._index.id+mapping.key+'" class="TooltipEvt"><button class="Button gridbtn btn bg-gray TooltipEvt">'+t+'</button></a>' ;
						}
						return reBtn ;
					}},
					{ title:'시작시간', key : 'startDatetime' , width: '160px', align: 'center',tooltip:false ,render:cloudUtil.dtFormat},
					{ title:'완료시간', key : 'completeDatetime' , width: '160px', align: 'center',tooltip:false ,render:cloudUtil.dtFormat},
					{ title:'상태', key : 'status' , width: '160px', align: 'center' , tooltip:false , render:function(value,data,render,mapping){
						let re = "수행중"; 
						if(value ==  "OK"){
							re = "성공"; 
						}else if(value ==  "DOING"){
							re = "수행중"; 
						}else if(value ==  "FAILED"){
							re = '<a id="'+data._index.id+mapping.key+'" class="TooltipEvt"> 실패 <span class="ico_title" style="padding-top:33px;"/></a>' ;
						}else if(value ==  "ABORTED"){
							re = "수행중지"; 
						}
						return re
					}},
					{ title:'백업범위(LSN)', key : '' , width: '160px', align: 'center',tooltip:false ,render:cloudUtil.dtFormat,render:function(value,data){
						let  re = data.fromLsn +' ~ '+data.toLsn ; 
				  		if(data.type == "DUMP" || data.status == "ABORTED"|| data.status == "DOING"){
				  			re = ' - ' ;
				  		}
						return re;
					}},
					{ title:'파일사이즈', key : 'fileSize' , width: '80px', align: 'center',tooltip:false , render:function(value,data,render,mapping){
						var val = '';
						if(value < 1024 ) {
							val = value +'B';
						} else if(value < 1024*1024 ) {
							val = cloudUtil.truncDecimal((value / 1024),2) +'Ki';
						} else if(value < 1024*1024*1024 ) {
							val = cloudUtil.truncDecimal((value / (1024*1024)),2) +'Mi';
						} else if(value < 1024*1024*1024*1024 ) {
							val = cloudUtil.truncDecimal((value / (1024*1024*1024)),2) +'Gi';
						}
						var st = data.status == 'DELETED'? 'text-decoration: line-through;': '';
						var re = '<span style="font:inherit;'+st+'">'+val+'</span>' ;
						
				  		if(data.status == "ABORTED"){
				  			re = ' - ' ;
				  		}
						return re;
					}},
					{ title:'On-Disk', key : 'ondisk' , width: '160px', align: 'center',hidden:true, render:function(value,data){
						let  re = value; 
						
						if(data.status == "ABORTED"){
				  			re = ' - ' ;
				  		}
						return re;
					}},
					{ title:downloadTitle, key : 'archiveFileSize' , width: '100px', align: 'center',excludeFitWidth:true,tooltip:false ,render:function(value,data,render,mapping){
						let t = '다운로드';
						//console.log(data.type);
						if(['FULL','INCR'].indexOf(data.type) > -1){
							t = '복원';
						}
						var re = $('<button class="Button btn-download '+(data.status != 'OK'?'Disabled':'')+'">'+t+'</button>').on('click',function(){
							fn_downloadBackupFile(data);
						});
						return re;
					},tooltip:null},
					{ title:'Log', key : 'log' , width: '60px',width:'70px',excludeFitWidth:true, align: 'center',tooltip:false ,render:function(value,data,render,mapping){
						return getGridContextButton();
					}}
				],
				footer: {
					footerMapping: [
						{ columnIndex: "deleteDatetime", title:'백업 파일 사이즈 합계: ', align:'center'},
						{ columnIndex: "fileSize", align:'center',render:function(value,data,render,mapping){
							let rawData = AlopexGrid.trimData(value);
							let totalValue = new BigNumber(0);
							for (var i in rawData) {
								if (rawData[i].status == 'OK') {
									totalValue = totalValue.plus(rawData[i].fileSize);
								};
							};
							if(totalValue.lte(1024)) {
								return totalValue.toFixed() +'B';
							}else if(totalValue.lte(1024*1024) ) {
								return totalValue.div(1024).decimalPlaces(2).toFixed() +'Ki';
							}else if(totalValue.lte(1024*1024*1024)) {
								return totalValue.div(1024*1024).decimalPlaces(2).toFixed() +'Mi';
							}else{
								return totalValue.div(1024*1024*1024).decimalPlaces(2).toFixed() +'Gi';
							}
						}}
					]},
				message: {
					nodata: gMessage.gridNodata
				}
			}).on('mouseover', '.bodycell .TooltipEvt',function(e){
				// grid backup 상태(status) 컬럼 실패시 tooltip추가 (2019-07-10)
				var evObj = AlopexGrid.parseEvent(e);
				var data = evObj.data;
				var mapping = evObj.mapping;

				var $tooltip = $('#backupTooltip');

				if (mapping.key === 'status' ){ // && data.reason != null
					var val = data['reason']||'';
					
					$tooltip.html(val.replaceAll('\n','</br>')); 
					$tooltip.attr('data-base', '#'+data._index.id + mapping.key);  
					$tooltip.open();	
				}else if(mapping.key === 'type'  ) { //&& data.scheduleYn == "N"
					
					var val = '사용자 백업'||'';
					$tooltip.html(val.replaceAll('\n','</br>')); 
					$tooltip.attr('data-base', '#'+data._index.id + mapping.key);  
					$tooltip.open();	
				} else{
					$tooltip.close();
				}
				
			});			
			function setBackupUseYnEvt(val){
				var msg = val == 'Y'? '백업 설정을 활성화 하시겠습니까?': '백업 설정을 비활성화 하시겠습니까?';
				gCommon.confirm(msg,function(yn){
					if(yn == 'Y'){
						setOnOffButton('useYn',val);
						fn_saveSchedule();				
					};
				});
			}
			function setOnOffButton(name,bOn){
				$('select[name='+name+']').zdbui_setComponent(bOn);	
				if(bOn == 'Y'){
					$('button[data-target='+name+']').removeClass('btn-off').addClass('btn-on').text('ON');
				}else{
					$('button[data-target='+name+']').removeClass('btn-on').addClass('btn-off').text('OFF');
				}
			}
			
			function setBackupBtnEnable(){
				if(backupStatus=='Y'){
					backupForm.find('#saveSchedule').setEnabled(true);
					backupForm.find('#saveSchedule').text('수정');
					setBackupCompEnable('N')
				}else if(backupStatus=='N'){
					backupForm.find('#saveSchedule').setEnabled(false);
					backupForm.find('#saveSchedule').text('수정');
					setBackupCompEnable('N')
				}else if(backupStatus=='I'){
					backupForm.find('#saveSchedule').setEnabled(true);
					backupForm.find('#saveSchedule').text('적용');
					setBackupCompEnable('Y')
				}
			};
			
			function setBackupCompEnable(val){
				if(val=='Y'){
					backupForm.find('#storePeriodSpinner').setEnabled(true);
					backupForm.find('#startTime').setEnabled(true);
					backupForm.find('#incrementPeriod').setEnabled(true);
					backupForm.find('#scheduleDay').setEnabled(true);
					backupForm.find('#throttleYn').setEnabled(true);
				}else{
					backupForm.find('#storePeriodSpinner').setEnabled(false);
					backupForm.find('#startTime').setEnabled(false);
					backupForm.find('#incrementPeriod').setEnabled(false);
					backupForm.find('#scheduleDay').setEnabled(false);
					backupForm.find('#throttleYn').setEnabled(false);
				}
			};			
			function fn_getBackupScheduleInfo(){
				var param = {
						namespace : gService.namespace,
					    serviceType : gService.serviceType,
					    serviceName : gService.serviceName
					};
				$a.ajax({
					url: '/zdbapi/getSchedule',
					data:param,
					success: function(res){
						var isStatusGreen = gService.status == 'green'; 
						
						if(isStatusGreen){
							$('#addBackupDisk').setEnabled(true);
							$('#updateBackup').setEnabled(true);
						}else{
							$('#addBackupDisk').setEnabled(false);
							$('#updateBackup').setEnabled(false);
						}
						
						var data = {};
						if(!res.schedule){
							data.useYn = 'N';
							data.startTime = '01:00';
							data.storePeriod = '7';
						}else{
							data = res.schedule;
						};
						backupStatus = data.useYn||'N';
						if(data.incrementYn != 'Y'){
							data.incrementPeriod = '0';
						}
						backupForm.zdbui_setContents(data);
						setOnOffButton('useYn',backupStatus);
						setBackupBtnEnable();
						backupForm.find('#startTime').setData({date :data.startTime});
					}
				});					
			};
			function fn_saveSchedule(){
				var param = $.extend({},gParam,backupForm.serializeObject());
				param.startTime = moment($('#startTime').getData().date.replace(/(AM|PM)/,''),'HH : mm').format('HH:mm');
				param.incrementYn = backupForm.find('#incrementPeriod select').val() == '0' ? 'N' : 'Y';
		
				//console.log(param);
				
				$a.ajax({
					url: '/zdbapi/updateSchedule',
					data:param,
					success: function(res){
						gCommon.alert('백업 설정이 수정되었습니다.',function(){
							fn_getBackupScheduleInfo();
						});
					}
				});	
			}
			function fn_getBackupInfo(){
				$a.ajax({
					url: '/zdbapi/getBackupList',
					data:gParam,
					success: function(res){
						var list = res.backupList;
						
						if(gParam.serviceType != cServiceType.redis){
							$("#gridBackup").alopexGrid('showCol', 4);
						}else{
							$("#gridBackup").alopexGrid('hideCol', 4);
						}
						$('#gridBackup').alopexGrid('dataSet',list);
						
						fn_filterBackupInfo();
					}
				});				
			};	
			function fn_filterBackupInfo(){
				$('#gridBackup').alopexGrid('setFilter', 'backupFilter', function(data){
					if($('#backupSearchType').is(':checked') == true){
						return true;
					}else{
						return data.type != 'INCR';
					}
				});
			}
			
			function fn_downloadBackupFile(data){
				if(data.status!='OK')return;
				let isDownload = true;
				if(['FULL','INCR'].indexOf(data.type) > -1){
					isDownload = false;
				}
				let param = $.extend({},gParam,{backupId:data.backupId})
				if(isDownload){
					gCommon.movePage('/zdbapi/downloadBackup',param);
				}else{
					gCommon.credentialConfirm({
				        data:{credential:$("#credential").val(),
				        	  msg:'서비스를 (' + cloudUtil.dtFormat(data.acceptedDatetime) + ')시점으로 복원 하시려면',
				        	  okBtnMsg:'복원'},
				        width: 550,
				        callback : function(res){
							$a.ajax({
								url: '/zdbapi/restoreFromBackup',
								data:data,
								success: function(res){
									if(res.result.code!='4'){
										gCommon.alert('복원 요청이 완료 되었습니다.');
									}
								}
							})
				        }
				    });					
				}
			};
			/* tabBackup end backup */
			
			/*tabEvent start 이벤트*/
			$('#gridEvent').alopexGrid({
				autoColumnIndex: true,
				autoResize:true,
				height: 400,
				renderMapping : {
					'evtMsgTooltip' : {
						renderer: function(value, data, render, mapping) {
							return '<a id="'+data._index.id+mapping.key+'" class="TooltipEvt">'+value+(data.history?'<span class="ico_title" style="padding-top:33px;"/>':'')+'</a>';
						}
					}
				},
				columnMapping : [  
					{ title:'', key : 'status' , width: '30px', align: 'center',render:function(value){
						var re = '';
						if(value == 0){
							re = '<i class="fa fa-check-circle ft20 color-success" aria-hidden="true"></i>';
						}else if(value == 4){
							re = '<i class="fa fa-times-circle ft20 color-danger" aria-hidden="true"></i>';
						}else{
							re = '<i class="fa fa-info-circle ft20 color-info" aria-hidden="true"></i>';
						}
						return re;
					},excludeFitWidth:true},
					{ title:'일시', key : 'endTime' , width: '170px', align: 'left',render:function(value){
						return cloudUtil.dtFormat(value);
					},excludeFitWidth:true},
					{ title:'범주', key : 'type' , width: '170px', align: 'left',render:function(value){
						var result = "" ;
					
 						for(var iType in gEventType){
							if(iType ==  value) result =  gEventType[iType] ;
						} 
						return result;
					},excludeFitWidth:true},					
					{ title:'이벤트', key : 'operation' , width: '180px', align: 'left'},
					{ title:'메세지', key : 'resultMessage' , width: '600px', align: 'left',inlineStyle: {'padding-left':'10px','padding-right':'10px'},tooltip:false,render: {type: "evtMsgTooltip"}},
					{ title:'UserName', key : 'userId' , width: '250px', align: 'left'}
				],
				message: {
					nodata: gMessage.gridNodata
				}
			}).on('mouseover', '.bodycell .TooltipEvt',function(e){
				var evObj = AlopexGrid.parseEvent(e);
				var data = evObj.data;
				var mapping = evObj.mapping;
				var $tooltip = $('#evtTooltip');

				if (mapping.key === 'resultMessage' && data.history!=null){
					var val = data['history']||'';
					$tooltip.html(val.replaceAll('\n','</br>')); 
					$tooltip.attr('data-base', '#'+data._index.id + mapping.key);  
					$tooltip.open();	
				}else {
					$tooltip.close();
				}
			});			
			
			$('#eventStartDate').val(moment().subtract(3, 'days').format('YYYY-MM-DD'));
			$('#eventEndDate').val(moment().format('YYYY-MM-DD'));
			$('#eventEndTime').setData({date :'23:59'});
			
			function fn_getEventInfo(){
				var param = $('form[name=eventForm]').serializeObject();
				param = $.extend({},gParam,param);
				param.startTime = moment($('#eventStartDate').val()+$('#eventStartTime').getData().date.replace(/(AM|PM)/,''),'YYYY-MM-DDHH : mm').format('YYYY-MM-DD HH:mm:ss');
				param.endTime = moment($('#eventEndDate').val()+$('#eventEndTime').getData().date.replace(/(AM|PM)/,'')+':59','YYYY-MM-DDHH : mm:ss').format('YYYY-MM-DD HH:mm:ss');
				param.kbackupEventExceptYnord||'-';
				//backupEventExceptYn
				if($('#backupEventExceptYn').is(':checked') == true){
					param.backupEventExceptYn = "N" ;
				}else{
					param.backupEventExceptYn = "Y";
				}
				
				$a.ajax({
					url: '/zdbapi/getOperationEvents',
					data:param,
					success: function(res){
						var list = res.operationEvents;
						//console.log(list);
						$('#gridEvent').alopexGrid('dataSet',list);
					}
				});				
			};			
			$('#searchEvent').on('click',function(){
				fn_getEventInfo();
			});

			$('#backupEventExceptYn').on('change',function(e){
				fn_getEventInfo();
			});
			$('input[name=keyword]').pressEnter(function(evt){
				fn_getEventInfo();
			});
			/*tabEvent end 이벤트*/
			/*tabUser start 사용자 */
			let tabUser = $('#tabUser');
			let renderCheckbox = function(value){
				if(value == 'Y')return $('<img src="/styles/images/ico-checkmark.png" style="float:initial;width:20px"></img>');
			};
			let allowEditCheck = function(value,data){
				return data.state == 'A' || (data.user != 'admin');
			}
			let editTypeYn = {type:"checkbox",rule:[{value:"Y", checked:true},{value:"N", checked:false}]};
			let gridUser = $('#gridUser').alopexGrid({
				autoColumnIndex: true,
				autoResize:true,
				rowInlineEdit:true,
				rowSelectOption:{
					clickSelect : true,
					singleSelect : true
				},
				cellSelectable:true,
				restoreFocusOnInvalidInlineEdit :true,
				leaveDeleted:true,
				height: 400,
				columnMapping : [  
					{ title:'state',key:'state',width:'50px',align:'center',editable:false,hidden:false,excludeFitWidth:true,render:function(value,data){
						if (data._state.added){data.state = 'A'}
						else if (data._state.deleted){data.state='D'}
						else if (data._state.edited){data.state='E'}
						else {data.state=''}
						return data.state;
					}},
					{ title:'USER', key : 'user' , width: '100px', align: 'left' ,editable:true	,allowEdit:function(value,data){
						return data._state.added == true;
					},editable: function(value, data) {
						return '<div><input type="text" class="alopexgrid-default-renderer" maxlength="15" value="'+value+'"/></div>'; 
					},editedValue: function(cell, data, render, mapping, grid) {
						return $(cell).find('input').val();
					},valid : function(value, data) {
						if(value=='') {
							return false;
						}
						return true;
					}},
					{ title:'PASSWORD', key : 'password' , width: '100px', align: 'left' ,editable:{type:'text'},valid : function(value, data) {
						if(value=='' && data.state == 'A') {
							return false;
						}
						return true;
						},editable: function(value, data) {
							return '<div><input type="password" class="alopexgrid-default-renderer" value="'+ (value||'') +'" maxlength="15"/></div>'; 
						},editedValue: function(cell, data, render, mapping, grid) {
							return $(cell).find('input').val();
						},render:function(value,data){
							return (value||'').replace(/./g,'*');
						}
					},
					{ title:'HOST', key : 'host' , width: '120px', align: 'left' ,editable:true,allowEdit:function(value,data){
						return data._state.added == true;
					}},
					{ title:'SELECT', key : 'select' , width: '90px', align: 'center',editable:editTypeYn,render:renderCheckbox,allowEdit:allowEditCheck},
					{ title:'INSERT', key : 'insert' , width: '90px', align: 'center',editable:editTypeYn,render:renderCheckbox,allowEdit:allowEditCheck},
					{ title:'UPDATE', key : 'update' , width: '90px', align: 'center',editable:editTypeYn,render:renderCheckbox,allowEdit:allowEditCheck},
					{ title:'DELETE', key : 'delete' , width: '90px', align: 'center',editable:editTypeYn,render:renderCheckbox,allowEdit:allowEditCheck},
					{ title:'EXECUTE', key : 'execute' , width: '90px', align: 'center',editable:editTypeYn,render:renderCheckbox,allowEdit:allowEditCheck},
					{ title:'CREATE', key : 'create' , width: '90px', align: 'center',editable:editTypeYn,render:renderCheckbox,allowEdit:allowEditCheck},
					{ title:'ALTER', key : 'alter' , width: '90px', align: 'center',editable:editTypeYn,render:renderCheckbox,allowEdit:allowEditCheck},
					{ title:'DROP', key : 'drop' , width: '90px', align: 'center',editable:editTypeYn,render:renderCheckbox,allowEdit:allowEditCheck},
					{ title:'CREATE VIEW', key : 'createView' , width: '100px', align: 'center',editable:editTypeYn,render:renderCheckbox,allowEdit:allowEditCheck},
					{ title:'TRIGGER', key : 'trigger' , width: '90px', align: 'center',editable:editTypeYn,render:renderCheckbox,allowEdit:allowEditCheck},
					{ title:'GRANT', key : 'grant' , width: '90px', align: 'center',editable:editTypeYn,render:renderCheckbox,allowEdit:allowEditCheck},
					{ title:'CREATE USER', key : 'createUser' , width: '130px', align: 'center',editable:editTypeYn,render:renderCheckbox,allowEdit:allowEditCheck}
				], message: { nodata: gMessage.gridNodata }
			}).on('cellEditInvalid ', function(e){
					setTimeout(function(evt){
						var evObj = AlopexGrid.parseEvent(e);
						var opt = evObj.data;
						var mapping = evObj.mapping;
						var col = mapping.columnIndex;
						var invalidValue = evObj.value;
						
						if(opt._state.deleted == true){
							return;
						}
						if(col == 1){
							alert('User를 입력하세요');
						}else if(col == 2){
							alert('Password를 입력하세요');
						}
						gridUser.alopexGrid('focusCell', opt);
						setTimeout(function(){
							gridUser.alopexGrid('rowSelect', opt, true)
							gridUser.find('.bodycell[data-alopexgrid-rowindex='+(opt._index.row)+'][data-alopexgrid-columnindex='+(opt._index.column)+'] input').focus();
						},100)
					},100)
			}).on('dataChanged',function(e){
					let isEnalbed = AlopexGrid.trimData(gridUser.alopexGrid('dataGet',{state:'E'},{state:'A'},{state:'D'})).length > 0;
					tabUser.find('#btnSaveUser').setEnabled(isEnalbed);
			});
			tabUser.find('#btnAddUser').on('click', function(e){
				gridUser.alopexGrid('endRowInlineEdit');
				let dt = gridUser.alopexGrid('dataGet');
				
				if(dt[0] && dt[0]._state.added == true && dt[0]._state.editing != false){
					return;
				}
				
				let opt = {_index :{row:0,column:1,data:0,target:0}};
				let defUserDt = {
					select:'N', insert:'N',update:'N',delete:'N',execute:'N',create:'N',alter:'N',drop:'N',index:'N',createView:'N',trigger:'N',
					grant:'N',createUser:'N'
				};
				gridUser.alopexGrid('dataAdd', defUserDt, opt);
				gridUser.alopexGrid('startRowInlineEdit',opt);
				setTimeout(function(){
					gridUser.alopexGrid('rowSelect', opt, true)
					gridUser.find('.bodycell[data-alopexgrid-rowindex=0][data-alopexgrid-columnindex=1] input').focus();
				},100)
			});
			tabUser.find('#btnDeleteUser').on('click',function(e){
				gridUser.alopexGrid('endRowInlineEdit');
				let dg = gridUser.alopexGrid( 'dataGet' , {_state:{selected:true}});
				if(dg.length == 0){
					gCommon.alert('선택된 행이 없습니다.');return;
				};
				let dt = dg[0];
				if(dt.user == 'admin' && dt.host == '%'){
					gCommon.alert('admin 계정은 삭제 할 수 없습니다.');return;
				}
				let d = dt._state.deleted ? 'dataUndelete' : 'dataDelete'; 
				gridUser.alopexGrid(d,{_state: {selected:true}}); 
			})
			tabUser.find('#btnSearchUser').on('click',function(e){
				fn_getUserGrants(); 
			})
			tabUser.find('#btnSaveUser').on('click',function(e){
				fn_saveUser();
			})
			function fn_getUserGrants(){
				$a.ajax({
					url: '/zdbapi/getUserGrants',
					method:'get',
					data: gParam,
					success: function(res){
						let list = res.userGrants;
						$('#gridUser').alopexGrid('dataSet',list);
					}
				});				
			};			
			function fn_saveUser(){
				gridUser.alopexGrid('endRowInlineEdit');
				gCommon.credentialConfirm({
			        data:{credential:$("#credential").val(),msg:'사용자 정보를 변경/추가 하시려면',okBtnMsg:'저장'},
			        callback : function(res){
			        	let data = AlopexGrid.trimData(gridUser.alopexGrid('dataGet',{state:'E'},{state:'A'},{state:'D'}));
						if(data.length > 0){
							for(let i in data){
								let d = $.extend(data[i],gParam);
								d.accountId = d.user;
								d.password = d.password == null ? '' : d.password;
							};
						};	
						$a.ajax({
							url: '/zdbapi/saveDBUser',
							method:'put',
							data: {data:JSON.stringify(data)},
							success: function(res){
								fn_getUserGrants();
							}
						});	
			        }
			    });
			};
			/*tabUser end 사용자*/
			/*tabDatabase start Database*/
/* 			let tabDatabase = $('#tabDatabase');
			let gridDatabase = $('#gridDatabase').alopexGrid({
				autoColumnIndex: true,
				autoResize:true,
				rowInlineEdit:true,
				rowSelectOption:{
					clickSelect : true,
					singleSelect : true
				},
				cellSelectable:true,
				restoreFocusOnInvalidInlineEdit :true,
				leaveDeleted:true,
				height: 400,
				columnMapping : [  
					{ title:'state',key:'state',width:'0px',editable:false,hidden:false,render:function(value,data){
						if (data._state.added){data.state = 'A'}
						else if (data._state.deleted){data.state='D'}
						else if (data._state.edited){data.state='E'}
						else {data.state=''}
						return data.state;
					}},
					{ title:'NAME', key : 'name' , width: '400px', align: 'left' ,editable:true	,allowEdit:function(value,data){
						return data._state.added == true;
					},editable: function(value, data) {
						return '<div><input type="text" class="alopexgrid-default-renderer" maxlength="15" value="'+value+'"/></div>'; 
					},editedValue: function(cell) {
						return $(cell).find('input').val();
					},valid : function(value, data) {
						if(value=='') {
							return false;
						}
						return true;
					}}
				], message: { nodata: gMessage.gridNodata }
			}).on('cellEditInvalid ', function(e){
				setTimeout(function(evt){
					let evObj = AlopexGrid.parseEvent(e);
					let opt = evObj.data;
					let mapping = evObj.mapping;
					let col = mapping.columnIndex;
					let invalidValue = evObj.value;
					
					if(opt._state.deleted == true){
						return;
					}
					if(col == 1){
						alert('DATABASE명을 입력하세요');
					}
					gridDatabase.alopexGrid('focusCell', opt);
					setTimeout(function(){
						gridDatabase.alopexGrid('rowSelect', opt, true)
						gridDatabase.find('.bodycell[data-alopexgrid-rowindex='+(opt._index.row)+'][data-alopexgrid-columnindex='+(opt._index.column)+'] input').focus();
					},100)
				},100)
			}).on('dataChanged',function(e){
				let isEnalbed = AlopexGrid.trimData(gridDatabase.alopexGrid('dataGet',{state:'E'},{state:'A'},{state:'D'})).length > 0;
				tabDatabase.find('#btnSaveDatabase').setEnabled(isEnalbed);
			});
			tabDatabase.find('#btnAddDatabase').on('click', function(e){
				gridDatabase.alopexGrid('endRowInlineEdit');
				let dt = gridDatabase.alopexGrid('dataGet');
				
				if(dt[0]._state.added == true && dt[0]._state.editing != false){ return; } 
				let opt = {_index :{row:0,column:1,data:0,target:0}};
				gridDatabase.alopexGrid('dataAdd', {}, opt);
				gridDatabase.alopexGrid('startRowInlineEdit',opt);
				setTimeout(function(){
					gridDatabase.alopexGrid('rowSelect', opt, true)
					gridDatabase.find('.bodycell[data-alopexgrid-rowindex=0][data-alopexgrid-columnindex=1] input').focus();
				},100)
			});
			tabDatabase.find('#btnDeleteDatabase').on('click',function(e){
				gridDatabase.alopexGrid('endRowInlineEdit');
				let dg = gridDatabase.alopexGrid( 'dataGet' , {_state:{selected:true}});
				if(dg.length == 0){
					gCommon.alert('선택된 행이 없습니다.');return;
				};
				let dt = dg[0];
				if(false){
					gCommon.alert('삭제 할 수 없습니다.');return;
				}
				let d = dt._state.deleted ? 'dataUndelete' : 'dataDelete'; 
				gridDatabase.alopexGrid(d,{_state: {selected:true}}); 
			})
			tabDatabase.find('#btnSearchDatabase').on('click',function(e){
				fn_getDatabases(); 
			})
			tabDatabase.find('#btnSaveDatabase').on('click',function(e){
				fn_saveDatabase();
			})
			function fn_getDatabases(){
				$a.ajax({
					url: '/zdbapi/getDatabases',
					method:'get',
					data: gParam,
					success: function(res){
						let bl = ['information_schema','mysql','performance_schema'];
						let list = res.databases||[];
						let filterList = list.filter(function(ob){
							return bl.indexOf(ob.name)==-1
						});
						
						gridDatabase.alopexGrid('dataSet',filterList);
					}
				});				
			};			
			function fn_saveDatabase(){
				gridDatabase.alopexGrid('endRowInlineEdit');
				gCommon.confirm('변경된 정보를 저장하시겠습니까?',function(){
					let data = AlopexGrid.trimData(gridDatabase.alopexGrid('dataGet',{state:'E'},{state:'A'},{state:'D'}));
					if(data.length > 0){
						for(let i in data){
							let d = $.extend(data[i],gParam);
							d.databaseName = d.name;
						};
						$a.ajax({
							url: '/zdbapi/saveDatabase',
							method:'put',
							data: {data:JSON.stringify(data)},
							success: function(res){
								fn_getDatabases();
							}
						});	
					};						
				})
			}; */
			/*tabDatabase end*/						
			/*tabSystem start 환경설정 */
			var dbConfigForm = $('form[name=dbConfig]');
			
			if(gParam.serviceType == cServiceType.redis){
				dbConfigForm.validator({
				    elements :{ 
				        'timeout': {rule:{required:true,min:0,max:3600}}
				       ,'tcp-keepalive': {rule:{required:true,min:0,max:3600}}
				       ,'maxmemory-samples': {rule:{required:true,min:1,max:10}}
				       ,'slowlog-log-slower-than': {rule:{required:true,min:-1,max:12000}}
				       ,'slowlog-max-len': {rule:{required:true,min:1,max:256}}
				       ,'hash-max-ziplist-entries': {rule:{required:true,min:0,max:65535}}
				       ,'hash-max-ziplist-value': {rule:{required:true,min:0,max:65535}}
				       ,'list-max-ziplist-size': {rule:{required:true,min:-5,max:5}}
				       ,'zset-max-ziplist-entries': {rule:{required:true,min:0,max:65535}}
				       ,'zset-max-ziplist-value': {rule:{required:true,min:0,max:65535}}
				    }
				});				
			};
			
			$('#saveVariables').on('click',function(){ //시스템 변수 적용
				if(dbConfigForm.find('[data-for]:visible.invalid').length > 0){
					return;
				};
				let msg = '시스템 변수를 변경하시겠습니까?';
				if(gParam.serviceType != cServiceType.redis){
					msg +='</br> <span class="Color-warning">* 변경된 설정값은 서비스 재기동 후 적용 됩니다.<br>재기동을 원하시면 재시작 버튼을 실행하세요.</span>';
				};
				if(gCommon.confirm(msg,function(){
					var param = $.extend({},gParam, dbConfigForm.serializeObject());
					$a.ajax({
						url: '/zdbapi/updateDBVariables',
						data:param,
						success: function(res){
							gCommon.alert(gMessage.saveSuccess,function(){
								$('#zdbServiceTabs').setTabByContent('#tabService');
							});
						},
						loadingMessage:'환경설정 적용중입니다.'
					});
				}));
			});
			function fn_getConfigurationInfo(){
				$a.ajax({
					url: '/zdbapi/getDBVariables',
					data:gParam,
					success: function(res){
						var dbConfigurations = res.dbConfigurations
						if(gParam.serviceType == cServiceType.mariadb){
							if(dbConfigurations){
								let tbody = $('#serviceConfigTable tbody').html(''); 
								var sels = {
									character_set_server:{options:[{key:'utf8'},{key:'euckr'},{key:'utf8mb4'},{key:'utf16'}]},
									'collation-server':{options:[{key:'utf8_general_ci'},{key:'utf8_bin'},{key:'euckr_korean_ci'},{key:'euckr_bin'}
													,{key:'utf8mb4_general_ci'},{key:'utf8mb4_bin'},{key:'utf16_general_ci'},{key:'utf16_bin'}]},
									innodb_buffer_pool_instances:{options:[{key:'1'},{key:'2'},{key:'4'},{key:'8'}]},
									innodb_flush_method:{options:[{key:'fsync'},{key:'O_DSYNC'}, {key:'O_DIRECT'} ,{key:'O_DIRECT_NO_FSYNC'}]},
									query_cache_type:{options:[{key:'0',val:'OFF'},{key:'1',val:'ON'},{key:'2',val:'DEMAND'}]},
									thread_handling:{options:[{key:'no-threads'},{key:'one-thread-per-connection'},{key:'pool-of-threads'}]},
									'transaction-isolation':{options:[{key:'READ-UNCOMMITTED'},{key:'READ-COMMITTED'} ,{key:'REPEATABLE-READ'},{key:'SERIALIZABLE'}]},
									autocommit:{options:[{key:'0',val:'OFF'},{key:'1',val:'ON'}]},event_scheduler:{options:[{key:'0',val:'OFF'},{key:'1',val:'ON'}]},
									local_infile:{options:[{key:'0',val:'OFF'},{key:'1',val:'ON'}]},lower_case_table_names:{options:[{key:'0',val:'OFF'},{key:'1',val:'ON'}]}
								};
								let opt = {
									tmpdir:{css:{width:'300px'}},
									plugin_dir:{css:{width:'300px'}}
								}
								for(var i = 0 ; i < dbConfigurations.length;i++){
									var ob = dbConfigurations[i];
									var tr = '';
									if(sels[ob.name]){
										tr = '<tr><th>'+ob.name+'</th><td><div class="Divselect" style="min-width:200px;"> <select name="'+ob.name+'" >'
										for(var j = 0 ; j < sels[ob.name].options.length; j++){
											var opts = sels[ob.name].options[j];
											tr +='<option value="'+opts.key+'" '+(ob.value==opts.key?"selected":"")+'>'+(opts.val||opts.key)+'</option>';
										};
										tr += '</select><span></span></div>'+'<span class="info-text"> '+ob.valueRange+'</span></td></tr>';
									}else{
										tr = ' <tr> <th>'+ob.name+'</th> <td>'
									       + '		<input type="text" id="'+ob.name+'" name="'+ob.name+'" class="Textinput" value="'+ob.value+'"/>'
									       + '		<span class="info-text">'+ob.valueRange+'</span> '
									       + '		<p data-for="'+ob.name+'" class="warn-text"></p>'
									       + '	</td> </tr>';
									}
									tbody.append(tr);
									if(opt[ob.name]){
										let o = opt[ob.name];
										let obj = tbody.find('#'+ob.name); 
										if(o.css){
											obj.css(o.css);
										}
									}
								};
								function getCheckUnitTemple(val){
									return {rule:{required:true,checkUnitSize:val},message:{checkUnitSize:gValid.checkUnitSize.message}}
								}
								dbConfigForm.validator({
								    elements :{ 
								    	binlog_cache_size:getCheckUnitTemple('4096:18446744073709547520'),
								    	bulk_insert_buffer_size:getCheckUnitTemple('0:18446744073709547520'),
								    	innodb_buffer_pool_size:getCheckUnitTemple('5242880:8192000000000000000'),
								    	innodb_log_buffer_size:getCheckUnitTemple('262144:4294967295'),
								    	innodb_log_file_size:getCheckUnitTemple('1048576:549755813888'),
								    	max_allowed_packet:getCheckUnitTemple('1024:1073741824'),
								    	max_binlog_size:getCheckUnitTemple('4096:1073741824'),
								    	max_heap_table_size:getCheckUnitTemple('16384:4294966272'),
								    	myisam_sort_buffer_size:getCheckUnitTemple('4096:18446744073709547520'), 
								    	read_buffer_size:getCheckUnitTemple('8200:2147479552'), 
								    	read_rnd_buffer_size:getCheckUnitTemple('8200:2147483647'), 
								    	tmp_table_size:getCheckUnitTemple('1024:428867584') 
								    }
								});
								$a.convert(tbody.find('.Divselect'));
								setDbConfigurationFilter();
								tbody.find('select[name=character_set_server]').on('change',function(){
									setDbConfigurationFilter();
								});
								var dt = gCommon.findObjectByKeyOb(dbConfigurations,{name:'collation-server'});
								if(dt){
									$('select[name=collation-server]').val(dt.value).parent().refresh();
								};
								function setDbConfigurationFilter(isRefresh){
									$('select[name=collation-server] option').hide().filter(function(){
										return $(this).val().indexOf($('select[name=character_set_server]').val()+'_')>-1;
									}).show().filter(':first').prop('selected',true);
									$('select[name=collation-server]').parent().refresh();
								};
							}
						}else if(gParam.serviceType == cServiceType.redis){
							dbConfigForm.zdbui_setContents(dbConfigurations);							
						}
					}
				});
			};
			$('#popVariables').on('click',function(){
				window.open("/zdb02/zdb0200p05?namespace="+gService.namespace+"&serviceType="+gService.serviceType+"&serviceName="+gService.serviceName);
			});
			/*tabSystem end 환경설정 */
			/*tabLog start 사용자 */
			let tabLog = $('#tabLog');
			let lastLogData = {
					logType:null, //마지막 조회 타입	
					startDate:null,//조회 시작날짜
					endDate:null//조회 종료날짜
				} 			
			tabLog.find('#logStartDate').val(moment().subtract(1, 'days').format('YYYY-MM-DD'));
			tabLog.find('#logEndDate').val(moment().subtract(1, 'days').format('YYYY-MM-DD'));
			tabLog.find('#btnSearchLog').on('click',function(){
				fn_getLogData();
			});
			tabLog.find('#btnDownloadLog').on('click',function(){
				if(lastLogData.logType==null){
					gCommon.alert('조회된 데이터가 없습니다.');
				}
				let fileName = lastLogData.logType+'Log-'+moment().format("YYYYMMDDHHmmss")+'.txt';
				download($('#divLog').html(), fileName, "text/plain");
			});
			tabLog.find('input[name=logType]:first').prop('checked',true);
			function fn_getLogData(){
				let startDate = tabLog.find('#logStartDate').val().replaceAll('-','');
				let endDate = tabLog.find('#logEndDate').val().replaceAll('-','');
				
				let param = $.extend({},gParam,{logType:tabLog.find('input[name=logType]:checked').val(),startDate:startDate,endDate:endDate});
				$a.ajax({
					url: '/zdbapi/getFileLog',
					data:param,
					success:function(res){
						let re = res.fileLog||'데이터가 없습니다.'
						$('#divLog').html(re);
						lastLogData.logType = param.logType; 
						lastLogData.startDate = param.startDate;						
						lastLogData.endDate = param.endDate;						
					}
				})
			}
			/*tabLog end */		
			/*tabProcess start */
			//기본 시스템 계정 여부
			function fn_isSystemProcess(data){
				let exIds = ['system user','replicator']; 
				return exIds.indexOf(data.User) > -1; 
			}			
			let gridProcess = $('#gridProcess').alopexGrid({
				rowOption : { 
					styleclass : function(data, rowOption){
						let re = '';
						let state = (data.State||'').toLowerCase();
						let time = (data.Time || 0);
						if(!fn_isSystemProcess(data)){
							if( state.indexOf('waiting for') > -1 || 
									   (state.indexOf('sending data') > -1 && time >= 10) ||
									   (state.indexOf('updating') > -1 && time >= 10) ||
									   (state == 'copying to tmp table on disk')){
								re = 'warning-color';
							}
						}
						
						return re;
					}
				},				
				message: { nodata: gMessage.gridNodata },
				autoColumnIndex : true,
				columnMapping : [
						{ key : 'Id', title : '프로세스ID', width : '70px', align : 'center'},
						{ key : 'User', title : '사용자', width : '80px', align : 'left' },
						{ key : 'Host', title : '호스트', width : '80px', align : 'center' },
						{ key : 'db', title : 'DB', width : '100px', align : 'center' },
						{ key : 'Command', title : '커맨드', width : '100px', align : 'center' },
						{ key : 'Time', title : 'Time', width : '100px', align : 'center'},
						{ key : 'State', title : '상태', width : '130px', align : 'center'},
						{ key : 'Info', title : '정보', width : '250px', align : 'left'},
						{ key : '', title : '종료', width : '80px', align : 'center',render:function(value,data){
							let disabled = '';
							if(fn_isSystemProcess(data) == true){
								disabled = 'Disabled';
							}
							return $('<button class="Button sm '+disabled+'">종료</button>').on('click',function(){
								if($(this).hasClass('Disabled')){
									return;
								}
								gCommon.credentialConfirm({
							        data:{credential:$("#credential").val(),msg:'프로세스를 종료하시려면',okBtnMsg:'종료'},
							        callback : function(res){
										$a.ajax({
											url: '/zdbapi/killProcess',
											data:$.extend({},gParam,{pid:data.Id,podName:gService.podName}),
											success: function(res){
												if(res.result.code == '0'){
													fn_getProcesses();
												}
											}
										})
							        }
							    });
							});
						}}
						],
				});
			function fn_getProcesses(){
				$a.ajax({
					url:'/zdbapi/getProcesses',
					data:$.extend({},gParam,{podName:gService.podName}),
					success:function(res){
						let list = res.processes;
						gridProcess.alopexGrid('dataSet',list);
					}
				});
			}
			/*tabProcess end */		
			
			//page Start
			fn_getServiceFirst().done(function(){
				var cookieTabId = $.cookie('selected2010tab')||'tabService';
				if(appMariadb.init)appMariadb.init();				
				$('#zdbServiceTabs').setTabByContent('#'+cookieTabId);
				fn_getService();
			});
		};
		
	});
	function getTimeStamp(d) {
		var s =
			leadingZeros(d.getFullYear(), 4) + '-' +
		    leadingZeros(d.getMonth() + 1, 2) + '-' +
		    leadingZeros(d.getDate(), 2) + ' ' +

		    leadingZeros(d.getHours(), 2) + ':' +
		    leadingZeros(d.getMinutes(), 2) + ':' +
		    leadingZeros(d.getSeconds(), 2);

		return s;
	}

	function leadingZeros(n, digits) {
		var zero = '';
		n = n.toString();

		if (n.length < digits) {
			for(var i = 0; i < digits - n.length; i++)
				zero += '0';
		}
		
		return zero + n;
	}

</script>